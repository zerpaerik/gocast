import{a as W,b as g}from"./chunk-P4PAYY2C.js";import{A as K,B as Q,C as U,c as X,e as R,g as j,h as G,n as q,r as z,t as B,u as A,v as $,x as J}from"./chunk-LWEV5N6L.js";import{o as D}from"./chunk-6SH7557L.js";import{Ba as I,Ca as T,Hc as a,Ic as S,Jc as F,Ma as H,Na as M,Oc as N,Pc as P,Qb as f,Qd as k,Rd as L,Vb as l,ce as O,hc as o,ic as i,jc as u,nc as V,q as E,qa as y,ra as w,tc as _,vc as v,yb as c,zb as b}from"./chunk-XJ56SYHS.js";import"./chunk-DW7GCGLI.js";import"./chunk-BI7C37SH.js";var x=(()=>{class t{serviciosCalificados=[{id:1,numeroServicio:"SRV-001",fechaServicio:new Date("2025-03-01"),tipoServicio:"Gr\xFAa",cliente:"Juan P\xE9rez",calificacion:5,comentario:"Excelente servicio, muy r\xE1pido"},{id:2,numeroServicio:"SRV-002",fechaServicio:new Date("2025-03-02"),tipoServicio:"Gr\xFAa",cliente:"Mar\xEDa Gonz\xE1lez",calificacion:4,comentario:"Buen servicio, un poco demorado"},{id:3,numeroServicio:"SRV-003",fechaServicio:new Date("2025-03-03"),tipoServicio:"Mec\xE1nica",cliente:"Carlos Rodr\xEDguez",calificacion:5,comentario:"Muy profesionales"},{id:4,numeroServicio:"SRV-004",fechaServicio:new Date("2025-03-04"),tipoServicio:"Bater\xEDa",cliente:"Ana Torres",calificacion:3,comentario:"Servicio regular, mucho tiempo de espera"},{id:5,numeroServicio:"SRV-005",fechaServicio:new Date("2025-03-05"),tipoServicio:"Mec\xE1nica",cliente:"Pedro Ram\xEDrez",calificacion:4,comentario:"Buen servicio t\xE9cnico"}];getTiposServicio(){return[...new Set(this.serviciosCalificados.map(e=>e.tipoServicio))]}getReporteSatisfaccion(e){let n=this.serviciosCalificados.filter(p=>{let d=new Date(p.fechaServicio),h=d>=new Date(e.fechaDesde)&&d<=new Date(e.fechaHasta),C=!e.tipoServicio||p.tipoServicio===e.tipoServicio;return h&&C}).reduce((p,d)=>(p[d.tipoServicio]||(p[d.tipoServicio]=[]),p[d.tipoServicio].push(d),p),{}),m=Object.entries(n).map(([p,d])=>{let h=d.map(C=>C.calificacion);return{tipoServicio:p,calificacionPromedio:this.calcularPromedio(h),calificacionMinima:Math.min(...h),calificacionMaxima:Math.max(...h),totalServicios:d.length,periodoDesde:e.fechaDesde,periodoHasta:e.fechaHasta}});return E(m)}calcularPromedio(e){return e.reduce((r,n)=>r+n,0)/e.length}exportarCSV(e){let r=g.json_to_sheet(e.map(m=>({"Tipo de Servicio":m.tipoServicio,"Periodo Desde":new Date(m.periodoDesde).toLocaleDateString(),"Periodo Hasta":new Date(m.periodoHasta).toLocaleDateString(),"Calificaci\xF3n Promedio":m.calificacionPromedio.toFixed(2),"Calificaci\xF3n M\xEDnima":m.calificacionMinima,"Calificaci\xF3n M\xE1xima":m.calificacionMaxima,"Total Servicios":m.totalServicios}))),n=g.book_new();g.book_append_sheet(n,r,"Reporte de Satisfacci\xF3n"),W(n,`reporte_satisfaccion_${new Date().toISOString().split("T")[0]}.xlsx`)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function te(t,s){t&1&&(o(0,"div",25),a(1," La fecha inicial es requerida "),i())}function ie(t,s){t&1&&(o(0,"span"),a(1," La fecha final es requerida "),i())}function oe(t,s){t&1&&(o(0,"span"),a(1," La fecha final debe ser mayor a la fecha inicial "),i())}function ae(t,s){if(t&1&&(o(0,"div",25),f(1,ie,2,0,"span",26)(2,oe,2,0,"span",26),i()),t&2){let e=v();c(),l("ngIf",e.fechaHastaControl==null||e.fechaHastaControl.errors==null?null:e.fechaHastaControl.errors.required),c(),l("ngIf",e.fechaHastaControl==null||e.fechaHastaControl.errors==null?null:e.fechaHastaControl.errors.fechaInvalida)}}function re(t,s){if(t&1&&(o(0,"option",27),a(1),i()),t&2){let e=s.$implicit;l("value",e),c(),F(" ",e," ")}}function ne(t,s){if(t&1&&(o(0,"div")(1,"span",35),a(2),i()()),t&2){let e=v(2);c(2),F("Total de registros: ",e.resultados.length,"")}}function ce(t,s){t&1&&(o(0,"div",36),u(1,"i",37),a(2," No se encontraron registros para los filtros seleccionados "),i())}function le(t,s){if(t&1&&(o(0,"tr")(1,"td"),a(2),i(),o(3,"td",40),a(4),i(),o(5,"td",40),a(6),i(),o(7,"td",40),a(8),i(),o(9,"td",40),a(10),i()()),t&2){let e=s.$implicit;c(2),S(e.tipoServicio),c(2),S(e.calificacionPromedio.toFixed(2)),c(2),S(e.calificacionMinima),c(2),S(e.calificacionMaxima),c(2),S(e.totalServicios)}}function se(t,s){if(t&1&&(o(0,"div",38)(1,"table",39)(2,"thead")(3,"tr")(4,"th"),a(5,"Tipo de Servicio"),i(),o(6,"th",40),a(7,"Calificaci\xF3n Promedio"),i(),o(8,"th",40),a(9,"Calificaci\xF3n M\xEDnima"),i(),o(10,"th",40),a(11,"Calificaci\xF3n M\xE1xima"),i(),o(12,"th",40),a(13,"Total Servicios"),i()()(),o(14,"tbody"),f(15,le,11,5,"tr",41),i()()()),t&2){let e=v(2);c(15),l("ngForOf",e.resultados)}}function me(t,s){if(t&1){let e=V();o(0,"div",28)(1,"div",29)(2,"div",30),f(3,ne,3,1,"div",26),o(4,"div")(5,"button",31),_("click",function(){H(e);let n=v();return M(n.exportarCSV())}),u(6,"i",32),a(7," Exportar Excel "),i()()(),f(8,ce,3,0,"div",33)(9,se,16,1,"div",34),i()()}if(t&2){let e=v();c(3),l("ngIf",e.resultados.length>0),c(2),l("disabled",e.resultados.length===0),c(3),l("ngIf",e.resultados.length===0),c(),l("ngIf",e.resultados.length>0)}}var Z=(()=>{class t{fb;reporteSatisfaccionService;filtrosForm;resultados=[];mostrarResultados=!1;tiposServicio=[];constructor(e,r){this.fb=e,this.reporteSatisfaccionService=r,this.initForm()}ngOnInit(){this.tiposServicio=this.reporteSatisfaccionService.getTiposServicio()}initForm(){this.filtrosForm=this.fb.group({fechaDesde:["",R.required],fechaHasta:["",R.required],tipoServicio:[""]}),this.filtrosForm.get("fechaHasta")?.valueChanges.subscribe(e=>{let r=this.filtrosForm.get("fechaDesde")?.value;r&&e&&new Date(e)<new Date(r)&&this.filtrosForm.get("fechaHasta")?.setErrors({fechaInvalida:!0})})}buscar(){if(this.filtrosForm.valid){let e={fechaDesde:new Date(this.filtrosForm.get("fechaDesde")?.value),fechaHasta:new Date(this.filtrosForm.get("fechaHasta")?.value),tipoServicio:this.filtrosForm.get("tipoServicio")?.value};this.reporteSatisfaccionService.getReporteSatisfaccion(e).subscribe({next:r=>{this.resultados=r,this.mostrarResultados=!0},error:r=>{console.error("Error al obtener reporte:",r),this.resultados=[],this.mostrarResultados=!0}})}}limpiar(){this.filtrosForm.reset(),this.resultados=[],this.mostrarResultados=!1}exportarCSV(){this.resultados.length>0&&this.reporteSatisfaccionService.exportarCSV(this.resultados)}get fechaDesdeControl(){return this.filtrosForm.get("fechaDesde")}get fechaHastaControl(){return this.filtrosForm.get("fechaHasta")}static \u0275fac=function(r){return new(r||t)(b(K),b(x))};static \u0275cmp=I({type:t,selectors:[["app-reporte-satisfaccion"]],standalone:!0,features:[N([x]),P],decls:39,vars:6,consts:[[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-header"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"col-md-4"],[1,"form-group"],["for","fechaDesde"],["type","date","id","fechaDesde","formControlName","fechaDesde",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","fechaHasta"],["type","date","id","fechaHasta","formControlName","fechaHasta",1,"form-control"],["for","tipoServicio"],["id","tipoServicio","formControlName","tipoServicio",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","mt-3"],[1,"col-12","text-end"],["type","button",1,"btn","btn-secondary","me-2",3,"click"],[1,"ti","ti-refresh","me-1"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"ti","ti-search","me-1"],["class","row mt-4",4,"ngIf"],[1,"text-danger","small","mt-1"],[4,"ngIf"],[3,"value"],[1,"row","mt-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"btn","btn-success",3,"click","disabled"],[1,"ti","ti-file-spreadsheet","me-1"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-muted"],[1,"alert","alert-info"],[1,"ti","ti-info-circle","me-2"],[1,"table-responsive"],[1,"table","table-hover"],[1,"text-center"],[4,"ngFor","ngForOf"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5"),a(6,"Reporte de Satisfacci\xF3n"),i()(),o(7,"div",5)(8,"form",6),_("ngSubmit",function(){return n.buscar()}),o(9,"div",1)(10,"div",7)(11,"div",8)(12,"label",9),a(13,"Fecha Desde *"),i(),u(14,"input",10),f(15,te,2,0,"div",11),i()(),o(16,"div",7)(17,"div",8)(18,"label",12),a(19,"Fecha Hasta *"),i(),u(20,"input",13),f(21,ae,3,2,"div",11),i()(),o(22,"div",7)(23,"div",8)(24,"label",14),a(25,"Tipo de Servicio"),i(),o(26,"select",15)(27,"option",16),a(28,"Todos los servicios"),i(),f(29,re,2,2,"option",17),i()()()(),o(30,"div",18)(31,"div",19)(32,"button",20),_("click",function(){return n.limpiar()}),u(33,"i",21),a(34," Limpiar "),i(),o(35,"button",22),u(36,"i",23),a(37," Buscar "),i()()()(),f(38,me,10,4,"div",24),i()()()()()),r&2&&(c(8),l("formGroup",n.filtrosForm),c(7),l("ngIf",(n.fechaDesdeControl==null?null:n.fechaDesdeControl.touched)&&(n.fechaDesdeControl==null?null:n.fechaDesdeControl.invalid)),c(6),l("ngIf",(n.fechaHastaControl==null?null:n.fechaHastaControl.touched)&&(n.fechaHastaControl==null?null:n.fechaHastaControl.errors)),c(8),l("ngForOf",n.tiposServicio),c(6),l("disabled",!n.filtrosForm.valid),c(3),l("ngIf",n.mostrarResultados))},dependencies:[O,k,L,Q,q,$,J,X,A,j,G,U,z,B],encapsulation:2})}return t})();var de=[{path:"",component:Z,data:{title:"Reporte de Satisfacci\xF3n",breadcrumb:"Reporte de Satisfacci\xF3n"}}],Fe=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=T({type:t});static \u0275inj=w({imports:[D.forChild(de),D]})}return t})();export{Fe as ReporteSatisfaccionRoutingModule,de as routes};
