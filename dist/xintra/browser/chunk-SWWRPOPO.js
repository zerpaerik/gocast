import{a as A,b as g}from"./chunk-P4PAYY2C.js";import{A as O,B as P,C as $,c as X,e as C,g as j,h as U,n as z,r as B,t as q}from"./chunk-LWEV5N6L.js";import{o as b}from"./chunk-6SH7557L.js";import{Ba as y,Ca as R,Hc as o,Ic as d,Jc as v,Ma as S,Na as F,Oc as V,Pc as H,Qb as p,Qd as G,Rd as L,Vb as c,Wc as M,Yc as T,Zd as N,ce as k,hc as n,ic as t,jc as f,nc as w,q as E,qa as D,ra as I,tc as h,vc as u,yb as a,zb as _}from"./chunk-XJ56SYHS.js";import"./chunk-DW7GCGLI.js";import"./chunk-BI7C37SH.js";var x=(()=>{class i{datosFinancieros=[{id:1,numeroServicio:"SRV-001",fechaServicio:new Date("2025-03-01"),tipoServicio:"Gr\xFAa",cliente:"Juan P\xE9rez",ubicacion:"Caracas, Venezuela",ingresos:250,gastos:100,detalleGastos:"Combustible: 50.00, Peajes: 30.00, Vi\xE1ticos: 20.00",utilidad:150},{id:2,numeroServicio:"SRV-002",fechaServicio:new Date("2025-03-05"),tipoServicio:"Mec\xE1nica",cliente:"Mar\xEDa Gonz\xE1lez",ubicacion:"Valencia, Venezuela",ingresos:180,gastos:75,detalleGastos:"Repuestos: 50.00, Mano de obra: 25.00",utilidad:105},{id:3,numeroServicio:"SRV-003",fechaServicio:new Date("2025-03-08"),tipoServicio:"Bater\xEDa",cliente:"Carlos Rodr\xEDguez",ubicacion:"Maracay, Venezuela",ingresos:120,gastos:60,detalleGastos:"Bater\xEDa: 45.00, Transporte: 15.00",utilidad:60}];getReporteFinanciero(e){let r=this.datosFinancieros.filter(l=>{let s=new Date(l.fechaServicio);return s>=new Date(e.fechaDesde)&&s<=new Date(e.fechaHasta)});return E(r)}exportarCSV(e){let r=g.json_to_sheet(e.map(s=>({"N\xFAmero de Servicio":s.numeroServicio,Fecha:new Date(s.fechaServicio).toLocaleDateString(),"Tipo de Servicio":s.tipoServicio,Cliente:s.cliente,Ubicaci\u00F3n:s.ubicacion,Ingresos:s.ingresos.toLocaleString("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}),Gastos:s.gastos.toLocaleString("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}),"Detalle de Gastos":s.detalleGastos,Utilidad:s.utilidad.toLocaleString("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2})}))),l=g.book_new();g.book_append_sheet(l,r,"Reporte Financiero"),A(l,`reporte_financiero_${new Date().toISOString().split("T")[0]}.xlsx`)}static \u0275fac=function(r){return new(r||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function W(i,m){i&1&&(n(0,"div",19),o(1," La fecha inicial es requerida "),t())}function Y(i,m){i&1&&(n(0,"span"),o(1," La fecha final es requerida "),t())}function Z(i,m){i&1&&(n(0,"span"),o(1," La fecha final debe ser mayor a la fecha inicial "),t())}function ee(i,m){if(i&1&&(n(0,"div",19),p(1,Y,2,0,"span",20)(2,Z,2,0,"span",20),t()),i&2){let e=u();a(),c("ngIf",e.fechaHastaControl==null||e.fechaHastaControl.errors==null?null:e.fechaHastaControl.errors.required),a(),c("ngIf",e.fechaHastaControl==null||e.fechaHastaControl.errors==null?null:e.fechaHastaControl.errors.fechaInvalida)}}function te(i,m){i&1&&(n(0,"div",34),f(1,"i",35),o(2," No se encontraron registros para los filtros seleccionados "),t())}function ie(i,m){if(i&1&&(n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),M(5,"date"),t(),n(6,"td"),o(7),t(),n(8,"td"),o(9),t(),n(10,"td"),o(11),t(),n(12,"td",38),o(13),t(),n(14,"td",38),o(15),t(),n(16,"td"),o(17),t(),n(18,"td",38),o(19),t()()),i&2){let e=m.$implicit,r=u(3);a(2),d(e.numeroServicio),a(2),d(T(5,9,e.fechaServicio,"dd/MM/yyyy")),a(3),d(e.tipoServicio),a(2),d(e.cliente),a(2),d(e.ubicacion),a(2),d(r.formatearMonto(e.ingresos)),a(2),d(r.formatearMonto(e.gastos)),a(2),d(e.detalleGastos),a(2),d(r.formatearMonto(e.utilidad))}}function ne(i,m){if(i&1&&(n(0,"div",36)(1,"table",37)(2,"thead")(3,"tr")(4,"th"),o(5,"N\xB0 Servicio"),t(),n(6,"th"),o(7,"Fecha"),t(),n(8,"th"),o(9,"Tipo"),t(),n(10,"th"),o(11,"Cliente"),t(),n(12,"th"),o(13,"Ubicaci\xF3n"),t(),n(14,"th",38),o(15,"Ingresos"),t(),n(16,"th",38),o(17,"Gastos"),t(),n(18,"th"),o(19,"Detalle Gastos"),t(),n(20,"th",38),o(21,"Utilidad"),t()()(),n(22,"tbody"),p(23,ie,20,12,"tr",39),t()()()),i&2){let e=u(2);a(23),c("ngForOf",e.resultados)}}function oe(i,m){if(i&1){let e=w();n(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24)(4,"div",25)(5,"strong"),o(6,"Total Ingresos:"),t(),o(7),t(),n(8,"div",26)(9,"strong"),o(10,"Total Gastos:"),t(),o(11),t(),n(12,"div",27)(13,"strong"),o(14,"Total Utilidad:"),t(),o(15),t()(),n(16,"div")(17,"button",28),h("click",function(){S(e);let l=u();return F(l.limpiar())}),f(18,"i",29),o(19," Limpiar "),t(),n(20,"button",30),h("click",function(){S(e);let l=u();return F(l.exportarCSV())}),f(21,"i",31),o(22," Exportar Excel "),t()()(),p(23,te,3,0,"div",32)(24,ne,24,1,"div",33),t()()}if(i&2){let e=u();a(7),v(" ",e.formatearMonto(e.totalIngresos)," "),a(4),v(" ",e.formatearMonto(e.totalGastos)," "),a(4),v(" ",e.formatearMonto(e.totalUtilidad)," "),a(5),c("disabled",e.resultados.length===0),a(3),c("ngIf",e.resultados.length===0),a(),c("ngIf",e.resultados.length>0)}}var K=(()=>{class i{fb;reporteFinancieroService;filtrosForm;resultados=[];mostrarResultados=!1;totalIngresos=0;totalGastos=0;totalUtilidad=0;constructor(e,r){this.fb=e,this.reporteFinancieroService=r,this.initForm()}ngOnInit(){}initForm(){this.filtrosForm=this.fb.group({fechaDesde:["",C.required],fechaHasta:["",C.required]}),this.filtrosForm.get("fechaHasta")?.valueChanges.subscribe(e=>{let r=this.filtrosForm.get("fechaDesde")?.value;r&&e&&new Date(e)<new Date(r)&&this.filtrosForm.get("fechaHasta")?.setErrors({fechaInvalida:!0})})}buscar(){if(this.filtrosForm.valid){let e={fechaDesde:new Date(this.filtrosForm.get("fechaDesde")?.value),fechaHasta:new Date(this.filtrosForm.get("fechaHasta")?.value)};this.reporteFinancieroService.getReporteFinanciero(e).subscribe({next:r=>{this.resultados=r,this.calcularTotales(),this.mostrarResultados=!0},error:r=>{console.error("Error al obtener reporte:",r),this.resultados=[],this.mostrarResultados=!0}})}}calcularTotales(){this.totalIngresos=this.resultados.reduce((e,r)=>e+r.ingresos,0),this.totalGastos=this.resultados.reduce((e,r)=>e+r.gastos,0),this.totalUtilidad=this.resultados.reduce((e,r)=>e+r.utilidad,0)}limpiar(){this.filtrosForm.reset(),this.resultados=[],this.mostrarResultados=!1,this.totalIngresos=0,this.totalGastos=0,this.totalUtilidad=0}exportarCSV(){this.resultados.length>0&&this.reporteFinancieroService.exportarCSV(this.resultados)}formatearMonto(e){return e.toLocaleString("es-VE",{style:"currency",currency:"VES",minimumFractionDigits:2,maximumFractionDigits:2})}get fechaDesdeControl(){return this.filtrosForm.get("fechaDesde")}get fechaHastaControl(){return this.filtrosForm.get("fechaHasta")}static \u0275fac=function(r){return new(r||i)(_(O),_(x))};static \u0275cmp=y({type:i,selectors:[["app-reporte-financiero"]],standalone:!0,features:[V([x]),H],decls:28,vars:5,consts:[[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-header"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"col-md-5"],[1,"form-group"],["for","fechaDesde"],["type","date","id","fechaDesde","formControlName","fechaDesde",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","fechaHasta"],["type","date","id","fechaHasta","formControlName","fechaHasta",1,"form-control"],[1,"col-md-2","d-flex","align-items-end"],[1,"form-group","w-100"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],[1,"ti","ti-search","me-1"],["class","row mt-4",4,"ngIf"],[1,"text-danger","small","mt-1"],[4,"ngIf"],[1,"row","mt-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"d-flex","gap-4"],[1,"text-success"],[1,"text-danger"],[1,"text-primary"],[1,"btn","btn-secondary","me-2",3,"click"],[1,"ti","ti-refresh","me-1"],[1,"btn","btn-success",3,"click","disabled"],[1,"ti","ti-file-spreadsheet","me-1"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"alert","alert-info"],[1,"ti","ti-info-circle","me-2"],[1,"table-responsive"],[1,"table","table-hover"],[1,"text-end"],[4,"ngFor","ngForOf"]],template:function(r,l){r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5"),o(6,"Reporte Financiero"),t()(),n(7,"div",5)(8,"form",6),h("ngSubmit",function(){return l.buscar()}),n(9,"div",1)(10,"div",7)(11,"div",8)(12,"label",9),o(13,"Fecha Desde *"),t(),f(14,"input",10),p(15,W,2,0,"div",11),t()(),n(16,"div",7)(17,"div",8)(18,"label",12),o(19,"Fecha Hasta *"),t(),f(20,"input",13),p(21,ee,3,2,"div",11),t()(),n(22,"div",14)(23,"div",15)(24,"button",16),f(25,"i",17),o(26," Buscar "),t()()()()(),p(27,oe,25,6,"div",18),t()()()()()),r&2&&(a(8),c("formGroup",l.filtrosForm),a(7),c("ngIf",(l.fechaDesdeControl==null?null:l.fechaDesdeControl.touched)&&(l.fechaDesdeControl==null?null:l.fechaDesdeControl.invalid)),a(6),c("ngIf",(l.fechaHastaControl==null?null:l.fechaHastaControl.touched)&&(l.fechaHastaControl==null?null:l.fechaHastaControl.errors)),a(3),c("disabled",!l.filtrosForm.valid),a(3),c("ngIf",l.mostrarResultados))},dependencies:[k,G,L,N,P,z,X,j,U,$,B,q],encapsulation:2})}return i})();var re=[{path:"",component:K,data:{title:"Reporte Financiero",breadcrumb:"Reporte Financiero"}}],ge=(()=>{class i{static \u0275fac=function(r){return new(r||i)};static \u0275mod=R({type:i});static \u0275inj=I({imports:[b.forChild(re),b]})}return i})();export{ge as ReporteFinancieroRoutingModule,re as routes};
