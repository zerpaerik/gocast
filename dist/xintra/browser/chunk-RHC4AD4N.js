import{A as $,B as lt,C as Fe,D as qu,E as E_,F as Ms,G as ne,H as ht,I as qa,J as ju,K as vt,L as kn,M as gr,N as ja,O as T_,P as Rt,Q as Le,a as O,b as si,c as Ma,d as d_,e as f_,f as je,g as Fa,h as Vs,i as Lu,j as p_,k as Lt,l as Uu,m as La,n as g_,o as m_,p as Ua,q as Ne,r as __,s as y_,t as yt,u as Pn,v as Ba,w as Os,x as Bu,y as v_,z as w_}from"./chunk-Z4R7YH6H.js";import{$ as Da,Ca as bn,E as xs,G as Ds,T as xa,Wa as Ft,X as i_,aa as pr,ad as u_,ba as s_,bd as h_,c as In,ca as Ou,cb as Rn,ea as o_,f as n_,fa as Va,fe as Oa,ga as rn,ha as Mu,j as ri,k as r_,ka as a_,ma as l_,n as fr,o as ii,p as An,pd as Fu,q as Mt,qa as Sn,ra as Cn,ta as qe,u as Ae,va as W,ya as c_}from"./chunk-XJ56SYHS.js";import{a as ni,b as Ns,j as Vu,k as N}from"./chunk-BI7C37SH.js";var IA="firebase",AA="10.13.2";Rt(IA,AA,"app");var on=new u_("ANGULARFIRE2_VERSION");var SA=(n,e)=>{let t=e?[e]:T_(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},sn=class{constructor(){return SA(CA)}},CA="app-check";function Gu(){}var Ga=class{zone;delegate;constructor(e,t=r_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Ku=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Gu,{},Gu,Gu)),t.pipe(a_({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},oi=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Ga(Zone.current)),this.insideAngular=t.run(()=>new Ga(Zone.current,ri)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(W(Ft))};static \u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function bA(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Ce(n){return RA(bA())(n)}function RA(n){return function(t){return t=t.lift(new Ku(n.ngZone)),t.pipe(ii(n.outsideAngular),fr(n.insideAngular))}}var PA="firebase",kA="10.13.2";Le.registerVersion(PA,kA,"app-compat");var NA=["ngOnDestroy"],A_=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(NA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(d=>{let p=d?.(...u);return r?.spy?.apply&&r.spy.apply(s,u,p),p})})})});var za=class{constructor(e){return e}},Nn=new qe("angularfire2.app.options"),xn=new qe("angularfire2.app.name");function mr(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Le.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Le.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;xA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new za(o)}var xA=(n,...e)=>{Fu()&&typeof console<"u"&&console[n](...e)},DA={provide:za,useFactory:mr,deps:[Nn,Ft,[new c_,xn]]},MP=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Nn,useValue:t},{provide:xn,useValue:r}]}}constructor(t){Le.registerVersion("angularfire",on.full,"core"),Le.registerVersion("angularfire",on.full,"app-compat"),Le.registerVersion("angular",h_.full,t.toString())}static \u0275fac=function(r){return new(r||n)(W(Rn))};static \u0275mod=bn({type:n});static \u0275inj=Cn({providers:[DA]})}return n})();function ai(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return VA(i,o)||(I_("error",`${e} was already initialized on the ${t} Firebase App with different settings.${OA?" You may need to reload as Firebase is not HMR aware.":""}`),I_("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function VA(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var OA=typeof module<"u"&&!!module.hot,I_=(n,...e)=>{Fu()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var MA=new Map,FA={activated:!1,tokenObservers:[]},LA={initialized:!1,enabled:!1};function Pt(n){return MA.get(n)||Object.assign({},FA)}function N_(){return LA}var UA="https://content-firebaseappcheck.googleapis.com/v1";var BA="exchangeDebugToken",S_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},WP=24*60*60*1e3;var $u=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return N(this,null,function*(){this.stop();try{this.pending=new je,this.pending.promise.catch(t=>{}),yield qA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new je,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function qA(n){return new Promise(e=>{setTimeout(e,n)})}var jA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Dn=new m_("appCheck","AppCheck",jA);function x_(n){if(!Pt(n).activated)throw Dn.create("use-before-activation",{appName:n.name})}function D_(r,i){return N(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let y=yield o.getHeartbeatsHeader();y&&(s["X-Firebase-Client"]=y)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(y){throw Dn.create("fetch-network-error",{originalErrorMessage:y?.message})}if(c.status!==200)throw Dn.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(y){throw Dn.create("fetch-parse-error",{originalErrorMessage:y?.message})}let d=u.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Dn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let p=Number(d[1])*1e3,g=Date.now();return{token:u.token,expireTimeMillis:g+p,issuedAtTimeMillis:g}})}function V_(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${UA}/projects/${t}/apps/${r}:${BA}?key=${i}`,body:{debug_token:e}}}var GA="firebase-app-check-database",KA=1,Qu="firebase-app-check-store";var Wa=null;function zA(){return Wa||(Wa=new Promise((n,e)=>{try{let t=indexedDB.open(GA,KA);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Dn.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Qu,{keyPath:"compositeKey"})}}}catch(t){e(Dn.create("storage-open",{originalErrorMessage:t?.message}))}}),Wa)}function WA(n,e){return $A(QA(n),e)}function $A(n,e){return N(this,null,function*(){let r=(yield zA()).transaction(Qu,"readwrite"),s=r.objectStore(Qu).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},r.onerror=c=>{var u;a(Dn.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function QA(n){return`${n.options.appId}-${n.name}`}var Hu=new kn("@firebase/app-check");function Wu(n,e){return La()?WA(n,e).catch(t=>{Hu.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function O_(){return N_().enabled}function M_(){return N(this,null,function*(){let n=N_();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var HA={error:"UNKNOWN_ERROR"};function YA(n){return Ma.encodeString(JSON.stringify(n),!1)}function Yu(n,e=!1){return N(this,null,function*(){let t=n.app;x_(t);let r=Pt(t),i=r.token,s;if(i&&!Fs(i)&&(r.token=void 0,i=void 0),!i){let c=yield r.cachedTokenPromise;c&&(Fs(c)?i=c:yield Wu(t,void 0))}if(!e&&i&&Fs(i))return{token:i.token};let o=!1;if(O_()){r.exchangeTokenPromise||(r.exchangeTokenPromise=D_(V_(t,yield M_()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let c=yield r.exchangeTokenPromise;return yield Wu(t,c),r.token=c,{token:c.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Pt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Hu.warn(c.message):Hu.error(c),s=c}let a;return i?s?Fs(i)?a={token:i.token,internalError:s}:a=b_(s):(a={token:i.token},r.token=i,yield Wu(t,i)):a=b_(s),o&&eS(t,a),a})}function JA(n){return N(this,null,function*(){let e=n.app;x_(e);let{provider:t}=Pt(e);if(O_()){let r=yield M_(),{token:i}=yield D_(V_(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function XA(n,e,t,r){let{app:i}=n,s=Pt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Fs(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),C_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>C_(n))}function F_(n,e){let t=Pt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function C_(n){let{app:e}=n,t=Pt(e),r=t.tokenRefresher;r||(r=ZA(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function ZA(n){let{app:e}=n;return new $u(()=>N(this,null,function*(){let t=Pt(e),r;if(t.token?r=yield Yu(n,!0):r=yield Yu(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Pt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},S_.RETRIAL_MIN_WAIT,S_.RETRIAL_MAX_WAIT)}function eS(n,e){let t=Pt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Fs(n){return n.expireTimeMillis-Date.now()>0}function b_(n){return{token:YA(HA),error:n}}var Ju=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Pt(this.app);for(let t of e)F_(this.app,t.next);return Promise.resolve()}};function tS(n,e){return new Ju(n,e)}function nS(n){return{getToken:e=>Yu(n,e),getLimitedUseToken:()=>JA(n),addTokenListener:e=>XA(n,"INTERNAL",e),removeTokenListener:e=>F_(n.app,e)}}var rS="@firebase/app-check",iS="0.8.8";var sS="app-check",R_="app-check-internal";function oS(){gr(new ht(sS,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return tS(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(R_).initialize()})),gr(new ht(R_,n=>{let e=n.getProvider("app-check").getImmediate();return nS(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Rt(rS,iS)}oS();var aS=["localhost","0.0.0.0","127.0.0.1"],ik=typeof window<"u"&&aS.includes(window.location.hostname);var Ls=new qe("angularfire2.auth.use-emulator"),Us=new qe("angularfire2.auth.settings"),Bs=new qe("angularfire2.auth.tenant-id"),qs=new qe("angularfire2.auth.langugage-code"),js=new qe("angularfire2.auth.use-device-language"),Gs=new qe("angularfire.auth.persistence"),Ks=(n,e,t,r,i,s,o,a)=>ai(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(let[u,d]of Object.entries(o))c.settings[u]=d;return a&&c.setPersistence(a),c},[t,r,i,s,o,a]),zs=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,c,u,d,p,g,y){let S=new n_,k=Mt(void 0).pipe(fr(o.outsideAngular),rn(()=>s.runOutsideAngular(()=>import("./chunk-N4USWQBW.js"))),Ae(()=>mr(t,s,r)),Ae(x=>Ks(x,s,a,u,d,p,c,g)),Ou({bufferSize:1,refCount:!1}));if(Oa(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Mt(null);else{k.pipe(i_()).subscribe();let x=k.pipe(rn(M=>M.getRedirectResult().then(z=>z,()=>null)),Ce,Ou({bufferSize:1,refCount:!1})),q=k.pipe(rn(M=>new In(z=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(H=>z.next(H),H=>z.error(H),()=>z.complete()))})))),j=k.pipe(rn(M=>new In(z=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(H=>z.next(H),H=>z.error(H),()=>z.complete()))}))));this.authState=x.pipe(Mu(q),ii(o.outsideAngular),fr(o.insideAngular)),this.user=x.pipe(Mu(j),ii(o.outsideAngular),fr(o.insideAngular)),this.idToken=this.user.pipe(rn(M=>M?An(M.getIdToken()):Mt(null))),this.idTokenResult=this.user.pipe(rn(M=>M?An(M.getIdTokenResult()):Mt(null))),this.credential=xs(x,S,this.authState.pipe(Ds(M=>!M))).pipe(Ae(M=>M?.user?M:null),ii(o.outsideAngular),fr(o.insideAngular))}return A_(this,k,s,{spy:{apply:(x,q,j)=>{(x.startsWith("signIn")||x.startsWith("createUser"))&&j.then(M=>S.next(M))}}})}static \u0275fac=function(r){return new(r||n)(W(Nn),W(xn,8),W(Rn),W(Ft),W(oi),W(Ls,8),W(Us,8),W(Bs,8),W(qs,8),W(js,8),W(Gs,8),W(sn,8))};static \u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),wk=(()=>{class n{constructor(){Le.registerVersion("angularfire",on.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=bn({type:n});static \u0275inj=Cn({providers:[zs]})}return n})();var U_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},B_={};var Vn,Zu;(function(){var n;function e(E,_){function w(){}w.prototype=_.prototype,E.D=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(T,I,C){for(var v=Array(arguments.length-2),en=2;en<arguments.length;en++)v[en-2]=arguments[en];return _.prototype[I].apply(T,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,w){w||(w=0);var T=Array(16);if(typeof _=="string")for(var I=0;16>I;++I)T[I]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],I=E.g[2];var C=E.g[3],v=_+(C^w&(I^C))+T[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[1]+3905402710&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[2]+606105819&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[3]+3250441966&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(C^w&(I^C))+T[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[5]+1200080426&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[6]+2821735955&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[7]+4249261313&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(C^w&(I^C))+T[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[9]+2336552879&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[10]+4294925233&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[11]+2304563134&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(C^w&(I^C))+T[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[13]+4254626195&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[14]+2792965006&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[15]+1236535329&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(I^C&(w^I))+T[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[6]+3225465664&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[11]+643717713&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[0]+3921069994&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^C&(w^I))+T[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[10]+38016083&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[15]+3634488961&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[4]+3889429448&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^C&(w^I))+T[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[14]+3275163606&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[3]+4107603335&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[8]+1163531501&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^C&(w^I))+T[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[2]+4243563512&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[7]+1735328473&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[12]+2368359562&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(w^I^C)+T[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[8]+2272392833&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[11]+1839030562&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[14]+4259657740&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^C)+T[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[4]+1272893353&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[7]+4139469664&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[10]+3200236656&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^C)+T[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[0]+3936430074&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[3]+3572445317&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[6]+76029189&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^C)+T[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[12]+3873151461&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[15]+530742520&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[2]+3299628645&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(I^(w|~C))+T[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[7]+1126891415&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[14]+2878612391&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[5]+4237533241&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~C))+T[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[3]+2399980690&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[10]+4293915773&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[1]+2240044497&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~C))+T[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[15]+4264355552&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[6]+2734768916&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[13]+1309151649&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~C))+T[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[11]+3174756917&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[2]+718787259&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+C&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var w=_-this.blockSize,T=this.B,I=this.h,C=0;C<_;){if(I==0)for(;C<=w;)i(this,E,C),C+=this.blockSize;if(typeof E=="string"){for(;C<_;)if(T[I++]=E.charCodeAt(C++),I==this.blockSize){i(this,T),I=0;break}}else for(;C<_;)if(T[I++]=E[C++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var w=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=w&255,w/=256;for(this.u(E),E=Array(16),_=w=0;4>_;++_)for(var T=0;32>T;T+=8)E[w++]=this.g[_]>>>T&255;return E};function s(E,_){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;for(var w=[],T=!0,I=E.length-1;0<=I;I--){var C=E[I]|0;T&&C==_||(w[I]=C,T=!1)}this.g=w}var a={};function c(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function u(E){if(isNaN(E)||!isFinite(E))return p;if(0>E)return x(u(-E));for(var _=[],w=1,T=0;E>=w;T++)_[T]=E/w|0,w*=4294967296;return new o(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return x(d(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(_,8)),T=p,I=0;I<E.length;I+=8){var C=Math.min(8,E.length-I),v=parseInt(E.substring(I,I+C),_);8>C?(C=u(Math.pow(_,C)),T=T.j(C).add(u(v))):(T=T.j(w),T=T.add(u(v)))}return T}var p=c(0),g=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(k(this))return-x(this).m();for(var E=0,_=1,w=0;w<this.g.length;w++){var T=this.i(w);E+=(0<=T?T:4294967296+T)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(k(this))return"-"+x(this).toString(E);for(var _=u(Math.pow(E,6)),w=this,T="";;){var I=z(w,_).g;w=q(w,I.j(_));var C=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=I,S(w))return C+T;for(;6>C.length;)C="0"+C;T=C+T}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function k(E){return E.h==-1}n.l=function(E){return E=q(this,E),k(E)?-1:S(E)?0:1};function x(E){for(var _=E.g.length,w=[],T=0;T<_;T++)w[T]=~E.g[T];return new o(w,~E.h).add(g)}n.abs=function(){return k(this)?x(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0,I=0;I<=_;I++){var C=T+(this.i(I)&65535)+(E.i(I)&65535),v=(C>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=v>>>16,C&=65535,v&=65535,w[I]=v<<16|C}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(E,_){return E.add(x(_))}n.j=function(E){if(S(this)||S(E))return p;if(k(this))return k(E)?x(this).j(x(E)):x(x(this).j(E));if(k(E))return x(this.j(x(E)));if(0>this.l(y)&&0>E.l(y))return u(this.m()*E.m());for(var _=this.g.length+E.g.length,w=[],T=0;T<2*_;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<E.g.length;I++){var C=this.i(T)>>>16,v=this.i(T)&65535,en=E.i(I)>>>16,ds=E.i(I)&65535;w[2*T+2*I]+=v*ds,j(w,2*T+2*I),w[2*T+2*I+1]+=C*ds,j(w,2*T+2*I+1),w[2*T+2*I+1]+=v*en,j(w,2*T+2*I+1),w[2*T+2*I+2]+=C*en,j(w,2*T+2*I+2)}for(T=0;T<_;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=_;T<2*_;T++)w[T]=0;return new o(w,0)};function j(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function M(E,_){this.g=E,this.h=_}function z(E,_){if(S(_))throw Error("division by zero");if(S(E))return new M(p,p);if(k(E))return _=z(x(E),_),new M(x(_.g),x(_.h));if(k(_))return _=z(E,x(_)),new M(x(_.g),_.h);if(30<E.g.length){if(k(E)||k(_))throw Error("slowDivide_ only works with positive integers.");for(var w=g,T=_;0>=T.l(E);)w=H(w),T=H(T);var I=Y(w,1),C=Y(T,1);for(T=Y(T,2),w=Y(w,2);!S(T);){var v=C.add(T);0>=v.l(E)&&(I=I.add(w),C=v),T=Y(T,1),w=Y(w,1)}return _=q(E,I.j(_)),new M(I,_)}for(I=p;0<=E.l(_);){for(w=Math.max(1,Math.floor(E.m()/_.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),C=u(w),v=C.j(_);k(v)||0<v.l(E);)w-=T,C=u(w),v=C.j(_);S(C)&&(C=g),I=I.add(C),E=q(E,v)}return new M(I,E)}n.A=function(E){return z(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)&E.i(T);return new o(w,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)|E.i(T);return new o(w,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)^E.i(T);return new o(w,this.h^E.h)};function H(E){for(var _=E.g.length+1,w=[],T=0;T<_;T++)w[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(w,E.h)}function Y(E,_){var w=_>>5;_%=32;for(var T=E.g.length-w,I=[],C=0;C<T;C++)I[C]=0<_?E.i(C+w)>>>_|E.i(C+w+1)<<32-_:E.i(C+w);return new o(I,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Zu=B_.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Vn=B_.Integer=o}).apply(typeof U_<"u"?U_:typeof self<"u"?self:typeof window<"u"?window:{});var $a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},an={};var eh,th,li,nh,Ws,Qa,rh,ih,sh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof $a=="object"&&$a];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(l,h){if(h)e:{var f=r;l=l.split(".");for(var m=0;m<l.length-1;m++){var A=l[m];if(!(A in f))break e;f=f[A]}l=l[l.length-1],m=f[l],h=h(m),h!=m&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,m=!1,A={next:function(){if(!m&&f<l.length){var P=f++;return{value:h(P,l[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function g(l,h,f){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,g.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var m=f.slice();return m.push.apply(m,arguments),l.apply(this,m)}}function S(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(m,A,P){for(var F=Array(arguments.length-2),he=2;he<arguments.length;he++)F[he-2]=arguments[he];return h.prototype[A].apply(m,F)}}function k(l){let h=l.length;if(0<h){let f=Array(h);for(let m=0;m<h;m++)f[m]=l[m];return f}return[]}function x(l,h){for(let f=1;f<arguments.length;f++){let m=arguments[f];if(c(m)){let A=l.length||0,P=m.length||0;l.length=A+P;for(let F=0;F<P;F++)l[A+F]=m[F]}else l.push(m)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(l){return/^[\s\xa0]*$/.test(l)}function M(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function z(l){return z[" "](l),l}z[" "]=function(){};var H=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function Y(l,h,f){for(let m in l)h.call(f,l[m],m,l)}function E(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(l,h){let f,m;for(let A=1;A<arguments.length;A++){m=arguments[A];for(f in m)l[f]=m[f];for(let P=0;P<w.length;P++)f=w[P],Object.prototype.hasOwnProperty.call(m,f)&&(l[f]=m[f])}}function I(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function C(l){a.setTimeout(()=>{throw l},0)}function v(){var l=cu;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class en{constructor(){this.h=this.g=null}add(h,f){let m=ds.get();m.set(h,f),this.h?this.h.next=m:this.g=m,this.h=m}}var ds=new q(()=>new GI,l=>l.reset());class GI{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let fs,ps=!1,cu=new en,tm=()=>{let l=a.Promise.resolve(void 0);fs=()=>{l.then(KI)}};var KI=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){C(f)}var h=ds;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}ps=!1};function vn(){this.s=this.s,this.C=this.C}vn.prototype.s=!1,vn.prototype.ma=function(){this.s||(this.s=!0,this.N())},vn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $e(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}$e.prototype.h=function(){this.defaultPrevented=!0};var zI=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function gs(l,h){if($e.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,m=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(H){e:{try{z(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:WI[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&gs.aa.h.call(this)}}S(gs,$e);var WI={2:"touch",3:"pen",4:"mouse"};gs.prototype.h=function(){gs.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ms="closure_listenable_"+(1e6*Math.random()|0),$I=0;function QI(l,h,f,m,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!m,this.ha=A,this.key=++$I,this.da=this.fa=!1}function ga(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ma(l){this.src=l,this.g={},this.h=0}ma.prototype.add=function(l,h,f,m,A){var P=l.toString();l=this.g[P],l||(l=this.g[P]=[],this.h++);var F=hu(l,h,m,A);return-1<F?(h=l[F],f||(h.fa=!1)):(h=new QI(h,this.src,P,!!m,A),h.fa=f,l.push(h)),h};function uu(l,h){var f=h.type;if(f in l.g){var m=l.g[f],A=Array.prototype.indexOf.call(m,h,void 0),P;(P=0<=A)&&Array.prototype.splice.call(m,A,1),P&&(ga(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function hu(l,h,f,m){for(var A=0;A<l.length;++A){var P=l[A];if(!P.da&&P.listener==h&&P.capture==!!f&&P.ha==m)return A}return-1}var du="closure_lm_"+(1e6*Math.random()|0),fu={};function nm(l,h,f,m,A){if(m&&m.once)return im(l,h,f,m,A);if(Array.isArray(h)){for(var P=0;P<h.length;P++)nm(l,h[P],f,m,A);return null}return f=_u(f),l&&l[ms]?l.K(h,f,u(m)?!!m.capture:!!m,A):rm(l,h,f,!1,m,A)}function rm(l,h,f,m,A,P){if(!h)throw Error("Invalid event type");var F=u(A)?!!A.capture:!!A,he=gu(l);if(he||(l[du]=he=new ma(l)),f=he.add(h,f,m,F,P),f.proxy)return f;if(m=HI(),f.proxy=m,m.src=l,m.listener=f,l.addEventListener)zI||(A=F),A===void 0&&(A=!1),l.addEventListener(h.toString(),m,A);else if(l.attachEvent)l.attachEvent(om(h.toString()),m);else if(l.addListener&&l.removeListener)l.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return f}function HI(){function l(f){return h.call(l.src,l.listener,f)}let h=YI;return l}function im(l,h,f,m,A){if(Array.isArray(h)){for(var P=0;P<h.length;P++)im(l,h[P],f,m,A);return null}return f=_u(f),l&&l[ms]?l.L(h,f,u(m)?!!m.capture:!!m,A):rm(l,h,f,!0,m,A)}function sm(l,h,f,m,A){if(Array.isArray(h))for(var P=0;P<h.length;P++)sm(l,h[P],f,m,A);else m=u(m)?!!m.capture:!!m,f=_u(f),l&&l[ms]?(l=l.i,h=String(h).toString(),h in l.g&&(P=l.g[h],f=hu(P,f,m,A),-1<f&&(ga(P[f]),Array.prototype.splice.call(P,f,1),P.length==0&&(delete l.g[h],l.h--)))):l&&(l=gu(l))&&(h=l.g[h.toString()],l=-1,h&&(l=hu(h,f,m,A)),(f=-1<l?h[l]:null)&&pu(f))}function pu(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[ms])uu(h.i,l);else{var f=l.type,m=l.proxy;h.removeEventListener?h.removeEventListener(f,m,l.capture):h.detachEvent?h.detachEvent(om(f),m):h.addListener&&h.removeListener&&h.removeListener(m),(f=gu(h))?(uu(f,l),f.h==0&&(f.src=null,h[du]=null)):ga(l)}}}function om(l){return l in fu?fu[l]:fu[l]="on"+l}function YI(l,h){if(l.da)l=!0;else{h=new gs(h,this);var f=l.listener,m=l.ha||l.src;l.fa&&pu(l),l=f.call(m,h)}return l}function gu(l){return l=l[du],l instanceof ma?l:null}var mu="__closure_events_fn_"+(1e9*Math.random()>>>0);function _u(l){return typeof l=="function"?l:(l[mu]||(l[mu]=function(h){return l.handleEvent(h)}),l[mu])}function Qe(){vn.call(this),this.i=new ma(this),this.M=this,this.F=null}S(Qe,vn),Qe.prototype[ms]=!0,Qe.prototype.removeEventListener=function(l,h,f,m){sm(this,l,h,f,m)};function et(l,h){var f,m=l.F;if(m)for(f=[];m;m=m.F)f.push(m);if(l=l.M,m=h.type||h,typeof h=="string")h=new $e(h,l);else if(h instanceof $e)h.target=h.target||l;else{var A=h;h=new $e(m,l),T(h,A)}if(A=!0,f)for(var P=f.length-1;0<=P;P--){var F=h.g=f[P];A=_a(F,m,!0,h)&&A}if(F=h.g=l,A=_a(F,m,!0,h)&&A,A=_a(F,m,!1,h)&&A,f)for(P=0;P<f.length;P++)F=h.g=f[P],A=_a(F,m,!1,h)&&A}Qe.prototype.N=function(){if(Qe.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],m=0;m<f.length;m++)ga(f[m]);delete l.g[h],l.h--}}this.F=null},Qe.prototype.K=function(l,h,f,m){return this.i.add(String(l),h,!1,f,m)},Qe.prototype.L=function(l,h,f,m){return this.i.add(String(l),h,!0,f,m)};function _a(l,h,f,m){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,P=0;P<h.length;++P){var F=h[P];if(F&&!F.da&&F.capture==f){var he=F.listener,ze=F.ha||F.src;F.fa&&uu(l.i,F),A=he.call(ze,m)!==!1&&A}}return A&&!m.defaultPrevented}function am(l,h,f){if(typeof l=="function")f&&(l=g(l,f));else if(l&&typeof l.handleEvent=="function")l=g(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function lm(l){l.g=am(()=>{l.g=null,l.i&&(l.i=!1,lm(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class JI extends vn{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:lm(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _s(l){vn.call(this),this.h=l,this.g={}}S(_s,vn);var cm=[];function um(l){Y(l.g,function(h,f){this.g.hasOwnProperty(f)&&pu(h)},l),l.g={}}_s.prototype.N=function(){_s.aa.N.call(this),um(this)},_s.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var yu=a.JSON.stringify,XI=a.JSON.parse,ZI=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function vu(){}vu.prototype.h=null;function hm(l){return l.h||(l.h=l.i())}function dm(){}var ys={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function wu(){$e.call(this,"d")}S(wu,$e);function Eu(){$e.call(this,"c")}S(Eu,$e);var cr={},fm=null;function ya(){return fm=fm||new Qe}cr.La="serverreachability";function pm(l){$e.call(this,cr.La,l)}S(pm,$e);function vs(l){let h=ya();et(h,new pm(h))}cr.STAT_EVENT="statevent";function gm(l,h){$e.call(this,cr.STAT_EVENT,l),this.stat=h}S(gm,$e);function tt(l){let h=ya();et(h,new gm(h,l))}cr.Ma="timingevent";function mm(l,h){$e.call(this,cr.Ma,l),this.size=h}S(mm,$e);function ws(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Es(){this.g=!0}Es.prototype.xa=function(){this.g=!1};function eA(l,h,f,m,A,P){l.info(function(){if(l.g)if(P)for(var F="",he=P.split("&"),ze=0;ze<he.length;ze++){var ae=he[ze].split("=");if(1<ae.length){var He=ae[0];ae=ae[1];var Ye=He.split("_");F=2<=Ye.length&&Ye[1]=="type"?F+(He+"="+ae+"&"):F+(He+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+h+`
`+f+`
`+F})}function tA(l,h,f,m,A,P,F){l.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+h+`
`+f+`
`+P+" "+F})}function Xr(l,h,f,m){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+rA(l,f)+(m?" "+m:"")})}function nA(l,h){l.info(function(){return"TIMEOUT: "+h})}Es.prototype.info=function(){};function rA(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var m=f[l];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var P=A[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return yu(f)}catch{return h}}var va={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},_m={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Tu;function wa(){}S(wa,vu),wa.prototype.g=function(){return new XMLHttpRequest},wa.prototype.i=function(){return{}},Tu=new wa;function wn(l,h,f,m){this.j=l,this.i=h,this.l=f,this.R=m||1,this.U=new _s(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ym}function ym(){this.i=null,this.g="",this.h=!1}var vm={},Iu={};function Au(l,h,f){l.L=1,l.v=Aa(tn(h)),l.m=f,l.P=!0,wm(l,null)}function wm(l,h){l.F=Date.now(),Ea(l),l.A=tn(l.v);var f=l.A,m=l.R;Array.isArray(m)||(m=[String(m)]),Vm(f.i,"t",m),l.C=0,f=l.j.J,l.h=new ym,l.g=Xm(l.j,f?h:null,!l.m),0<l.O&&(l.M=new JI(g(l.Y,l,l.g),l.O)),h=l.U,f=l.g,m=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(cm[0]=A.toString()),A=cm);for(var P=0;P<A.length;P++){var F=nm(f,A[P],m||h.handleEvent,!1,h.h||h);if(!F)break;h.g[F.key]=F}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),vs(),eA(l.i,l.u,l.A,l.l,l.R,l.m)}wn.prototype.ca=function(l){l=l.target;let h=this.M;h&&nn(l)==3?h.j():this.Y(l)},wn.prototype.Y=function(l){try{if(l==this.g)e:{let Ye=nn(this.g);var h=this.g.Ba();let ti=this.g.Z();if(!(3>Ye)&&(Ye!=3||this.g&&(this.h.h||this.g.oa()||qm(this.g)))){this.J||Ye!=4||h==7||(h==8||0>=ti?vs(3):vs(2)),Su(this);var f=this.g.Z();this.X=f;t:if(Em(this)){var m=qm(this.g);l="";var A=m.length,P=nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ur(this),Ts(this);var F="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(m[h],{stream:!(P&&h==A-1)});m.length=0,this.h.g+=l,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=f==200,tA(this.i,this.u,this.A,this.l,this.R,Ye,f),this.o){if(this.T&&!this.K){t:{if(this.g){var he,ze=this.g;if((he=ze.g?ze.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(he)){var ae=he;break t}}ae=null}if(f=ae)Xr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cu(this,f);else{this.o=!1,this.s=3,tt(12),ur(this),Ts(this);break e}}if(this.P){f=!0;let bt;for(;!this.J&&this.C<F.length;)if(bt=iA(this,F),bt==Iu){Ye==4&&(this.s=4,tt(14),f=!1),Xr(this.i,this.l,null,"[Incomplete Response]");break}else if(bt==vm){this.s=4,tt(15),Xr(this.i,this.l,F,"[Invalid Chunk]"),f=!1;break}else Xr(this.i,this.l,bt,null),Cu(this,bt);if(Em(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ye!=4||F.length!=0||this.h.h||(this.s=1,tt(16),f=!1),this.o=this.o&&f,!f)Xr(this.i,this.l,F,"[Invalid Chunked Response]"),ur(this),Ts(this);else if(0<F.length&&!this.W){this.W=!0;var He=this.j;He.g==this&&He.ba&&!He.M&&(He.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),xu(He),He.M=!0,tt(11))}}else Xr(this.i,this.l,F,null),Cu(this,F);Ye==4&&ur(this),this.o&&!this.J&&(Ye==4?Qm(this.j,this):(this.o=!1,Ea(this)))}else EA(this.g),f==400&&0<F.indexOf("Unknown SID")?(this.s=3,tt(12)):(this.s=0,tt(13)),ur(this),Ts(this)}}}catch{}finally{}};function Em(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function iA(l,h){var f=l.C,m=h.indexOf(`
`,f);return m==-1?Iu:(f=Number(h.substring(f,m)),isNaN(f)?vm:(m+=1,m+f>h.length?Iu:(h=h.slice(m,m+f),l.C=m+f,h)))}wn.prototype.cancel=function(){this.J=!0,ur(this)};function Ea(l){l.S=Date.now()+l.I,Tm(l,l.I)}function Tm(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=ws(g(l.ba,l),h)}function Su(l){l.B&&(a.clearTimeout(l.B),l.B=null)}wn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(nA(this.i,this.A),this.L!=2&&(vs(),tt(17)),ur(this),this.s=2,Ts(this)):Tm(this,this.S-l)};function Ts(l){l.j.G==0||l.J||Qm(l.j,l)}function ur(l){Su(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,um(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Cu(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||bu(f.h,l))){if(!l.K&&bu(f.h,l)&&f.G==3){try{var m=f.Da.g.parse(h)}catch{m=null}if(Array.isArray(m)&&m.length==3){var A=m;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Pa(f),ba(f);else break e;Nu(f),tt(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=ws(g(f.Za,f),6e3));if(1>=Sm(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else dr(f,11)}else if((l.K||f.g==l)&&Pa(f),!j(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(f.T=ae[0],ae=ae[1],f.G==2)if(ae[0]=="c"){f.K=ae[1],f.ia=ae[2];let He=ae[3];He!=null&&(f.la=He,f.j.info("VER="+f.la));let Ye=ae[4];Ye!=null&&(f.Aa=Ye,f.j.info("SVER="+f.Aa));let ti=ae[5];ti!=null&&typeof ti=="number"&&0<ti&&(m=1.5*ti,f.L=m,f.j.info("backChannelRequestTimeoutMs_="+m)),m=f;let bt=l.g;if(bt){let Na=bt.g?bt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Na){var P=m.h;P.g||Na.indexOf("spdy")==-1&&Na.indexOf("quic")==-1&&Na.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Ru(P,P.h),P.h=null))}if(m.D){let Du=bt.g?bt.g.getResponseHeader("X-HTTP-Session-Id"):null;Du&&(m.ya=Du,me(m.I,m.D,Du))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),m=f;var F=l;if(m.qa=Jm(m,m.J?m.ia:null,m.W),F.K){Cm(m.h,F);var he=F,ze=m.L;ze&&(he.I=ze),he.B&&(Su(he),Ea(he)),m.g=F}else Wm(m);0<f.i.length&&Ra(f)}else ae[0]!="stop"&&ae[0]!="close"||dr(f,7);else f.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?dr(f,7):ku(f):ae[0]!="noop"&&f.l&&f.l.ta(ae),f.v=0)}}vs(4)}catch{}}var sA=class{constructor(l,h){this.g=l,this.map=h}};function Im(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Am(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Sm(l){return l.h?1:l.g?l.g.size:0}function bu(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Ru(l,h){l.g?l.g.add(h):l.h=h}function Cm(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}Im.prototype.cancel=function(){if(this.i=bm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function bm(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return k(l.i)}function oA(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],f=l.length,m=0;m<f;m++)h.push(l[m]);return h}h=[],f=0;for(m in l)h[f++]=l[m];return h}function aA(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let m in l)h[f++]=m;return h}}}function Rm(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=aA(l),m=oA(l),A=m.length,P=0;P<A;P++)h.call(void 0,m[P],f&&f[P],l)}var Pm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lA(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var m=l[f].indexOf("="),A=null;if(0<=m){var P=l[f].substring(0,m);A=l[f].substring(m+1)}else P=l[f];h(P,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function hr(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof hr){this.h=l.h,Ta(this,l.j),this.o=l.o,this.g=l.g,Ia(this,l.s),this.l=l.l;var h=l.i,f=new Ss;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),km(this,f),this.m=l.m}else l&&(h=String(l).match(Pm))?(this.h=!1,Ta(this,h[1]||"",!0),this.o=Is(h[2]||""),this.g=Is(h[3]||"",!0),Ia(this,h[4]),this.l=Is(h[5]||"",!0),km(this,h[6]||"",!0),this.m=Is(h[7]||"")):(this.h=!1,this.i=new Ss(null,this.h))}hr.prototype.toString=function(){var l=[],h=this.j;h&&l.push(As(h,Nm,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(As(h,Nm,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(As(f,f.charAt(0)=="/"?hA:uA,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",As(f,fA)),l.join("")};function tn(l){return new hr(l)}function Ta(l,h,f){l.j=f?Is(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function Ia(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function km(l,h,f){h instanceof Ss?(l.i=h,pA(l.i,l.h)):(f||(h=As(h,dA)),l.i=new Ss(h,l.h))}function me(l,h,f){l.i.set(h,f)}function Aa(l){return me(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Is(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function As(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,cA),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function cA(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Nm=/[#\/\?@]/g,uA=/[#\?:]/g,hA=/[#\?]/g,dA=/[#\?@]/g,fA=/#/g;function Ss(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function En(l){l.g||(l.g=new Map,l.h=0,l.i&&lA(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=Ss.prototype,n.add=function(l,h){En(this),this.i=null,l=Zr(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function xm(l,h){En(l),h=Zr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function Dm(l,h){return En(l),h=Zr(l,h),l.g.has(h)}n.forEach=function(l,h){En(this),this.g.forEach(function(f,m){f.forEach(function(A){l.call(h,A,m,this)},this)},this)},n.na=function(){En(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let m=0;m<h.length;m++){let A=l[m];for(let P=0;P<A.length;P++)f.push(h[m])}return f},n.V=function(l){En(this);let h=[];if(typeof l=="string")Dm(this,l)&&(h=h.concat(this.g.get(Zr(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return En(this),this.i=null,l=Zr(this,l),Dm(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Vm(l,h,f){xm(l,h),0<f.length&&(l.i=null,l.g.set(Zr(l,h),k(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var m=h[f];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var A=P;F[m]!==""&&(A+="="+encodeURIComponent(String(F[m]))),l.push(A)}}return this.i=l.join("&")};function Zr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function pA(l,h){h&&!l.j&&(En(l),l.i=null,l.g.forEach(function(f,m){var A=m.toLowerCase();m!=A&&(xm(this,m),Vm(this,A,f))},l)),l.j=h}function gA(l,h){let f=new Es;if(a.Image){let m=new Image;m.onload=y(Tn,f,"TestLoadImage: loaded",!0,h,m),m.onerror=y(Tn,f,"TestLoadImage: error",!1,h,m),m.onabort=y(Tn,f,"TestLoadImage: abort",!1,h,m),m.ontimeout=y(Tn,f,"TestLoadImage: timeout",!1,h,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=l}else h(!1)}function mA(l,h){let f=new Es,m=new AbortController,A=setTimeout(()=>{m.abort(),Tn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:m.signal}).then(P=>{clearTimeout(A),P.ok?Tn(f,"TestPingServer: ok",!0,h):Tn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),Tn(f,"TestPingServer: error",!1,h)})}function Tn(l,h,f,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(f)}catch{}}function _A(){this.g=new ZI}function yA(l,h,f){let m=f||"";try{Rm(l,function(A,P){let F=A;u(A)&&(F=yu(A)),h.push(m+P+"="+encodeURIComponent(F))})}catch(A){throw h.push(m+"type="+encodeURIComponent("_badmap")),A}}function Cs(l){this.l=l.Ub||null,this.j=l.eb||!1}S(Cs,vu),Cs.prototype.g=function(){return new Sa(this.l,this.j)},Cs.prototype.i=function(l){return function(){return l}}({});function Sa(l,h){Qe.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(Sa,Qe),n=Sa.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,Rs(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bs(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Rs(this)),this.g&&(this.readyState=3,Rs(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Om(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Om(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?bs(this):Rs(this),this.readyState==3&&Om(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,bs(this))},n.Qa=function(l){this.g&&(this.response=l,bs(this))},n.ga=function(){this.g&&bs(this)};function bs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Rs(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function Rs(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Sa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Mm(l){let h="";return Y(l,function(f,m){h+=m,h+=":",h+=f,h+=`\r
`}),h}function Pu(l,h,f){e:{for(m in f){var m=!1;break e}m=!0}m||(f=Mm(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):me(l,h,f))}function Ie(l){Qe.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Ie,Qe);var vA=/^https?$/i,wA=["POST","PUT"];n=Ie.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Tu.g(),this.v=this.o?hm(this.o):hm(Tu),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(P){Fm(this,P);return}if(l=f||"",f=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)f.set(A,m[A]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())f.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(f.keys()).find(P=>P.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(wA,h,void 0))||m||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of f)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Bm(this),this.u=!0,this.g.send(l),this.u=!1}catch(P){Fm(this,P)}};function Fm(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,Lm(l),Ca(l)}function Lm(l){l.A||(l.A=!0,et(l,"complete"),et(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,et(this,"complete"),et(this,"abort"),Ca(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ca(this,!0)),Ie.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Um(this):this.bb())},n.bb=function(){Um(this)};function Um(l){if(l.h&&typeof o<"u"&&(!l.v[1]||nn(l)!=4||l.Z()!=2)){if(l.u&&nn(l)==4)am(l.Ea,0,l);else if(et(l,"readystatechange"),nn(l)==4){l.h=!1;try{let F=l.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var m;if(m=F===0){var A=String(l.D).match(Pm)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),m=!vA.test(A?A.toLowerCase():"")}f=m}if(f)et(l,"complete"),et(l,"success");else{l.m=6;try{var P=2<nn(l)?l.g.statusText:""}catch{P=""}l.l=P+" ["+l.Z()+"]",Lm(l)}}finally{Ca(l)}}}}function Ca(l,h){if(l.g){Bm(l);let f=l.g,m=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||et(l,"ready");try{f.onreadystatechange=m}catch{}}}function Bm(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function nn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),XI(h)}};function qm(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function EA(l){let h={};l=(l.g&&2<=nn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<l.length;m++){if(j(l[m]))continue;var f=I(l[m]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let P=h[A]||[];h[A]=P,P.push(f)}E(h,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ps(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function jm(l){this.Aa=0,this.i=[],this.j=new Es,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ps("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ps("baseRetryDelayMs",5e3,l),this.cb=Ps("retryDelaySeedMs",1e4,l),this.Wa=Ps("forwardChannelMaxRetries",2,l),this.wa=Ps("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Im(l&&l.concurrentRequestLimit),this.Da=new _A,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=jm.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,m){tt(0),this.W=l,this.H=h||{},f&&m!==void 0&&(this.H.OSID=f,this.H.OAID=m),this.F=this.X,this.I=Jm(this,null,this.W),Ra(this)};function ku(l){if(Gm(l),l.G==3){var h=l.U++,f=tn(l.I);if(me(f,"SID",l.K),me(f,"RID",h),me(f,"TYPE","terminate"),ks(l,f),h=new wn(l,l.j,h),h.L=2,h.v=Aa(tn(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=Xm(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ea(h)}Ym(l)}function ba(l){l.g&&(xu(l),l.g.cancel(),l.g=null)}function Gm(l){ba(l),l.u&&(a.clearTimeout(l.u),l.u=null),Pa(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Ra(l){if(!Am(l.h)&&!l.s){l.s=!0;var h=l.Ga;fs||tm(),ps||(fs(),ps=!0),cu.add(h,l),l.B=0}}function TA(l,h){return Sm(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=ws(g(l.Ga,l,h),Hm(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new wn(this,this.j,l),P=this.o;if(this.S&&(P?(P=_(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(A.H=P,P=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var m=this.i[f];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(h+=m,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=zm(this,A,h),f=tn(this.I),me(f,"RID",l),me(f,"CVER",22),this.D&&me(f,"X-HTTP-Session-Id",this.D),ks(this,f),P&&(this.O?h="headers="+encodeURIComponent(String(Mm(P)))+"&"+h:this.m&&Pu(f,this.m,P)),Ru(this.h,A),this.Ua&&me(f,"TYPE","init"),this.P?(me(f,"$req",h),me(f,"SID","null"),A.T=!0,Au(A,f,null)):Au(A,f,h),this.G=2}}else this.G==3&&(l?Km(this,l):this.i.length==0||Am(this.h)||Km(this))};function Km(l,h){var f;h?f=h.l:f=l.U++;let m=tn(l.I);me(m,"SID",l.K),me(m,"RID",f),me(m,"AID",l.T),ks(l,m),l.m&&l.o&&Pu(m,l.m,l.o),f=new wn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=zm(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Ru(l.h,f),Au(f,m,h)}function ks(l,h){l.H&&Y(l.H,function(f,m){me(h,m,f)}),l.l&&Rm({},function(f,m){me(h,m,f)})}function zm(l,h,f){f=Math.min(l.i.length,f);var m=l.l?g(l.l.Na,l.l,l):null;e:{var A=l.i;let P=-1;for(;;){let F=["count="+f];P==-1?0<f?(P=A[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let he=!0;for(let ze=0;ze<f;ze++){let ae=A[ze].g,He=A[ze].map;if(ae-=P,0>ae)P=Math.max(0,A[ze].g-100),he=!1;else try{yA(He,F,"req"+ae+"_")}catch{m&&m(He)}}if(he){m=F.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,m}function Wm(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;fs||tm(),ps||(fs(),ps=!0),cu.add(h,l),l.v=0}}function Nu(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=ws(g(l.Fa,l),Hm(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,$m(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=ws(g(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,tt(10),ba(this),$m(this))};function xu(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function $m(l){l.g=new wn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=tn(l.qa);me(h,"RID","rpc"),me(h,"SID",l.K),me(h,"AID",l.T),me(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&me(h,"TO",l.ja),me(h,"TYPE","xmlhttp"),ks(l,h),l.m&&l.o&&Pu(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=Aa(tn(h)),f.m=null,f.P=!0,wm(f,l)}n.Za=function(){this.C!=null&&(this.C=null,ba(this),Nu(this),tt(19))};function Pa(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function Qm(l,h){var f=null;if(l.g==h){Pa(l),xu(l),l.g=null;var m=2}else if(bu(l.h,h))f=h.D,Cm(l.h,h),m=1;else return;if(l.G!=0){if(h.o)if(m==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;m=ya(),et(m,new mm(m,f)),Ra(l)}else Wm(l);else if(A=h.s,A==3||A==0&&0<h.X||!(m==1&&TA(l,h)||m==2&&Nu(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:dr(l,5);break;case 4:dr(l,10);break;case 3:dr(l,6);break;default:dr(l,2)}}}function Hm(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function dr(l,h){if(l.j.info("Error code "+h),h==2){var f=g(l.fb,l),m=l.Xa;let A=!m;m=new hr(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ta(m,"https"),Aa(m),A?gA(m.toString(),f):mA(m.toString(),f)}else tt(2);l.G=0,l.l&&l.l.sa(h),Ym(l),Gm(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),tt(2)):(this.j.info("Failed to ping google.com"),tt(1))};function Ym(l){if(l.G=0,l.ka=[],l.l){let h=bm(l.h);(h.length!=0||l.i.length!=0)&&(x(l.ka,h),x(l.ka,l.i),l.h.i.length=0,k(l.i),l.i.length=0),l.l.ra()}}function Jm(l,h,f){var m=f instanceof hr?tn(f):new hr(f);if(m.g!="")h&&(m.g=h+"."+m.g),Ia(m,m.s);else{var A=a.location;m=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var P=new hr(null);m&&Ta(P,m),h&&(P.g=h),A&&Ia(P,A),f&&(P.l=f),m=P}return f=l.D,h=l.ya,f&&h&&me(m,f,h),me(m,"VER",l.la),ks(l,m),m}function Xm(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ie(new Cs({eb:f})):new Ie(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Zm(){}n=Zm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ka(){}ka.prototype.g=function(l,h){return new ut(l,h)};function ut(l,h){Qe.call(this),this.g=new jm(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!j(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new ei(this)}S(ut,Qe),ut.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ut.prototype.close=function(){ku(this.g)},ut.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=yu(l),l=f);h.i.push(new sA(h.Ya++,l)),h.G==3&&Ra(h)},ut.prototype.N=function(){this.g.l=null,delete this.j,ku(this.g),delete this.g,ut.aa.N.call(this)};function e_(l){wu.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}S(e_,wu);function t_(){Eu.call(this),this.status=1}S(t_,Eu);function ei(l){this.g=l}S(ei,Zm),ei.prototype.ua=function(){et(this.g,"a")},ei.prototype.ta=function(l){et(this.g,new e_(l))},ei.prototype.sa=function(l){et(this.g,new t_)},ei.prototype.ra=function(){et(this.g,"b")},ka.prototype.createWebChannel=ka.prototype.g,ut.prototype.send=ut.prototype.o,ut.prototype.open=ut.prototype.m,ut.prototype.close=ut.prototype.close,sh=an.createWebChannelTransport=function(){return new ka},ih=an.getStatEventTarget=function(){return ya()},rh=an.Event=cr,Qa=an.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},va.NO_ERROR=0,va.TIMEOUT=8,va.HTTP_ERROR=6,Ws=an.ErrorCode=va,_m.COMPLETE="complete",nh=an.EventType=_m,dm.EventType=ys,ys.OPEN="a",ys.CLOSE="b",ys.ERROR="c",ys.MESSAGE="d",Qe.prototype.listen=Qe.prototype.K,li=an.WebChannel=dm,th=an.FetchXmlHttpFactory=Cs,Ie.prototype.listenOnce=Ie.prototype.L,Ie.prototype.getLastError=Ie.prototype.Ka,Ie.prototype.getLastErrorCode=Ie.prototype.Ba,Ie.prototype.getStatus=Ie.prototype.Z,Ie.prototype.getResponseJson=Ie.prototype.Oa,Ie.prototype.getResponseText=Ie.prototype.oa,Ie.prototype.send=Ie.prototype.ea,Ie.prototype.setWithCredentials=Ie.prototype.Ha,eh=an.XhrIo=Ie}).apply(typeof $a<"u"?$a:typeof self<"u"?self:typeof window<"u"?window:{});var q_="@firebase/firestore";var Ve=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ve.UNAUTHENTICATED=new Ve(null),Ve.GOOGLE_CREDENTIALS=new Ve("google-credentials-uid"),Ve.FIRST_PARTY=new Ve("first-party-uid"),Ve.MOCK_USER=new Ve("mock-user");var Ui="10.13.2";var qn=new kn("@firebase/firestore");function fi(){return qn.logLevel}function Gy(n){qn.setLogLevel(n)}function V(n,...e){if(qn.logLevel<=vt.DEBUG){let t=e.map(hf);qn.debug(`Firestore (${Ui}): ${n}`,...t)}}function be(n,...e){if(qn.logLevel<=vt.ERROR){let t=e.map(hf);qn.error(`Firestore (${Ui}): ${n}`,...t)}}function Et(n,...e){if(qn.logLevel<=vt.WARN){let t=e.map(hf);qn.warn(`Firestore (${Ui}): ${n}`,...t)}}function hf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${Ui}) INTERNAL ASSERTION FAILED: `+n;throw be(e),new Error(e)}function G(n,e){n||B()}function Ky(n,e){n||B()}function L(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends g_{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Oe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var sl=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},uh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ve.UNAUTHENTICATED))}shutdown(){}},hh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},dh=class{constructor(e){this.t=e,this.currentUser=Ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),s=new Oe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Oe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>N(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Oe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(G(typeof r.accessToken=="string"),new sl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Ve(e)}},fh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ve.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ph=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new fh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}},gh=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},mh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new gh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function cS(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var ol=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=cS(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function Q(n,e){return n<e?-1:n>e?1:0}function Ti(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function zy(n){return n+"\0"}var Ee=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var K=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ee(0,0))}static max(){return new n(new Ee(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var al=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(),r===void 0?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends al{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},uS=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Re=class n extends al{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return uS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new D(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new D(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Ii=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function _h(n){return n.fields.find(e=>e.kind===2)}function yr(n){return n.fields.filter(e=>e.kind!==2)}Ii.UNKNOWN_ID=-1;var vi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var io=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Tt.min())}};function Wy(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(r===1e9?new Ee(t+1,0):new Ee(t,r));return new Tt(i,U.empty(),e)}function $y(n){return new Tt(n.readTime,n.key,-1)}var Tt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(K.min(),U.empty(),-1)}static max(){return new n(K.max(),U.empty(),-1)}};function df(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}var Qy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ll=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Jn(n){return N(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==Qy)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var cl=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Oe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ar(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=ff(r.target.error);this.V.reject(new Ar(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Ar(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new vh(t)}},jn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(Vs())===12.2&&be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),vr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!La())return!1;if(n.v())return!0;let e=Vs(),t=n.S(e),r=0<t&&t<10,i=Hy(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return N(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Ar(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new D(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new D(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ar(e,o))},i.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return N(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=cl.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),b.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Hy(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var yh=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return vr(this.B.delete())}},Ar=class extends D{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Xn(n){return n.name==="IndexedDbTransactionError"}var vh=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),vr(r)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),vr(this.store.add(e))}get(e){return vr(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),vr(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),vr(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new b((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new b((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new b((r,i)=>{t.onerror=s=>{let o=ff(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new b((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new yh(a),u=t(a.primaryKey,a.value,c);if(u instanceof b){let d=u.catch(p=>(c.done(),b.reject(p)));r.push(d)}c.isDone?i():c.K===null?a.continue():a.continue(c.K)}}).next(()=>b.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function vr(n){return new b((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=ff(r.target.error);t(i)}})}var j_=!1;function ff(n){let e=jn.S(Vs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return j_||(j_=!0,setTimeout(()=>{throw r},0)),r}}return n}var wh=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>N(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Xn(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Jn(t)}yield this.X(6e4)}))}},Eh=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return N(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(V("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=$y(s);df(o,r)>0&&(r=o)}),new Tt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var dt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Ro(n){return n==null}function so(n){return n===0&&1/n==-1/0}function Yy(n){return typeof n=="number"&&Number.isInteger(n)&&!so(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function nt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=G_(e)),e=hS(n.get(t),e);return G_(e)}function hS(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function G_(n){return n+""}function Ut(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===""&&n.charAt(1)===""),se.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&B(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;i.length===0?c=a:(i+=a,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:B()}s=o+2}return new se(r)}var K_=["userId","batchId"];function Za(n,e){return[n,nt(e)]}function Jy(n,e,t){return[n,nt(e),t]}var dS={},fS=["prefixPath","collectionGroup","readTime","documentId"],pS=["prefixPath","collectionGroup","documentId"],gS=["collectionGroup","readTime","prefixPath","documentId"],mS=["canonicalId","targetId"],_S=["targetId","path"],yS=["path","targetId"],vS=["collectionId","parent"],wS=["indexId","uid"],ES=["uid","sequenceNumber"],TS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],IS=["indexId","uid","orderedDocumentKey"],AS=["userId","collectionPath","documentId"],SS=["userId","collectionPath","largestBatchId"],CS=["userId","collectionGroup","largestBatchId"],Xy=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],bS=[...Xy,"documentOverlays"],Zy=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ev=Zy,pf=[...ev,"indexConfiguration","indexState","indexEntries"],RS=pf,PS=[...pf,"globals"];var oo=class extends ll{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ue(n,e){let t=L(n);return jn.F(t._e,e)}function z_(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function tv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||qt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yi(this.root,e,this.comparator,!1)}getReverseIterator(){return new yi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yi(this.root,e,this.comparator,!0)}},yi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},qt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}};qt.EMPTY=null,qt.RED=!0,qt.BLACK=!1;qt.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new qt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var de=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ul(this.data.getIterator())}getIteratorFrom(e){return new ul(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ul=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function ci(n){return n.hasNext()?n.getNext():void 0}var ft=class n{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new n([])}unionWith(e){let t=new de(Re.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ti(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var hl=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function nv(){return typeof atob<"u"}var ke=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new hl("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ke.EMPTY_BYTE_STRING=new ke("");var kS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function un(n){if(G(!!n),typeof n=="string"){let e=0,t=kS.exec(n);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ye(n.seconds),nanos:ye(n.nanos)}}function ye(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Gn(n){return typeof n=="string"?ke.fromBase64String(n):ke.fromUint8Array(n)}function tc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function gf(n){let e=n.mapValue.fields.__previous_value__;return tc(e)?gf(e):e}function ao(n){let e=un(n.mapValue.fields.__local_write_time__.timestampValue);return new Ee(e.seconds,e.nanos)}var Th=class{constructor(e,t,r,i,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},Kn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Un={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},el={nullValue:"NULL_VALUE"};function Sr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?tc(n)?4:rv(n)?9007199254740991:nc(n)?10:11:B()}function Kt(n,e){if(n===e)return!0;let t=Sr(n);if(t!==Sr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ao(n).isEqual(ao(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=un(i.timestampValue),a=un(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Gn(i.bytesValue).isEqual(Gn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ye(i.geoPointValue.latitude)===ye(s.geoPointValue.latitude)&&ye(i.geoPointValue.longitude)===ye(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ye(i.integerValue)===ye(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ye(i.doubleValue),a=ye(s.doubleValue);return o===a?so(o)===so(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ti(n.arrayValue.values||[],e.arrayValue.values||[],Kt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(z_(o)!==z_(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Kt(o[c],a[c])))return!1;return!0}(n,e);default:return B()}}function lo(n,e){return(n.values||[]).find(t=>Kt(t,e))!==void 0}function zn(n,e){if(n===e)return 0;let t=Sr(n),r=Sr(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ye(s.integerValue||s.doubleValue),c=ye(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return W_(n.timestampValue,e.timestampValue);case 4:return W_(ao(n),ao(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Gn(s),c=Gn(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=Q(a[u],c[u]);if(d!==0)return d}return Q(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=Q(ye(s.latitude),ye(o.latitude));return a!==0?a:Q(ye(s.longitude),ye(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return $_(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,u,d;let p=s.fields||{},g=o.fields||{},y=(a=p.value)===null||a===void 0?void 0:a.arrayValue,S=(c=g.value)===null||c===void 0?void 0:c.arrayValue,k=Q(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=S?.values)===null||d===void 0?void 0:d.length)||0);return k!==0?k:$_(y,S)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Un.mapValue&&o===Un.mapValue)return 0;if(s===Un.mapValue)return 1;if(o===Un.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){let g=Q(c[p],d[p]);if(g!==0)return g;let y=zn(a[c[p]],u[d[p]]);if(y!==0)return y}return Q(c.length,d.length)}(n.mapValue,e.mapValue);default:throw B()}}function W_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=un(n),r=un(e),i=Q(t.seconds,r.seconds);return i!==0?i:Q(t.nanos,r.nanos)}function $_(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=zn(t[i],r[i]);if(s)return s}return Q(t.length,r.length)}function Ai(n){return Ih(n)}function Ih(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=un(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Gn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Ih(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Ih(t.fields[o])}`;return i+"}"}(n.mapValue):B()}function Cr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ah(n){return!!n&&"integerValue"in n}function co(n){return!!n&&"arrayValue"in n}function Q_(n){return!!n&&"nullValue"in n}function H_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tl(n){return!!n&&"mapValue"in n}function nc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Zs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Mr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Zs(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zs(n.arrayValue.values[t]);return e}return Object.assign({},n)}function rv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var iv={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function NS(n){return"nullValue"in n?el:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Cr(Kn.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?nc(n)?iv:{mapValue:{}}:B()}function xS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Cr(Kn.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?iv:"mapValue"in n?nc(n)?{mapValue:{}}:Un:B()}function Y_(n,e){let t=zn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function J_(n,e){let t=zn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Xe=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!tl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Zs(t)}setAll(e){let t=Re.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Zs(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());tl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];tl(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Mr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Zs(this.value))}};function sv(n){let e=[];return Mr(n.fields,(t,r)=>{let i=new Re([t]);if(tl(r)){let s=sv(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new ft(e)}var Me=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,K.min(),K.min(),K.min(),Xe.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,K.min(),K.min(),Xe.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,K.min(),K.min(),Xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var zt=class{constructor(e,t){this.position=e,this.inclusive=t}};function X_(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=U.comparator(U.fromName(o.referenceValue),t.key):r=zn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Z_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Kt(n.position[t],e.position[t]))return!1;return!0}var br=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function DS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var dl=class{},re=class n extends dl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new bh(e,t,r):t==="array-contains"?new kh(e,r):t==="in"?new fl(e,r):t==="not-in"?new Nh(e,r):t==="array-contains-any"?new xh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Rh(e,r):new Ph(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(zn(t,this.value)):t!==null&&Sr(this.value)===Sr(t)&&this.matchesComparison(zn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends dl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Si(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Si(n){return n.op==="and"}function Sh(n){return n.op==="or"}function mf(n){return ov(n)&&Si(n)}function ov(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function Ch(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+Ai(n.value);if(mf(n))return n.filters.map(e=>Ch(e)).join(",");{let e=n.filters.map(t=>Ch(t)).join(",");return`${n.op}(${e})`}}function av(n,e){return n instanceof re?function(r,i){return i instanceof re&&r.op===i.op&&r.field.isEqual(i.field)&&Kt(r.value,i.value)}(n,e):n instanceof ue?function(r,i){return i instanceof ue&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&av(o,i.filters[a]),!0):!1}(n,e):void B()}function lv(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function cv(n){return n instanceof re?function(t){return`${t.field.canonicalString()} ${t.op} ${Ai(t.value)}`}(n):n instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(cv).join(" ,")+"}"}(n):"Filter"}var bh=class extends re{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},Rh=class extends re{constructor(e,t){super(e,"in",t),this.keys=uv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ph=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=uv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function uv(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var kh=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return co(t)&&lo(t.arrayValue,this.value)}},fl=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&lo(this.value.arrayValue,t)}},Nh=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(lo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!lo(this.value.arrayValue,t)}},xh=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!co(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>lo(this.value.arrayValue,r))}};var Dh=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function Vh(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Dh(n,e,t,r,i,s,o)}function Rr(n){let e=L(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ch(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Ro(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ai(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ai(r)).join(",")),e.ue=t}return e.ue}function Po(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!DS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!av(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Z_(n.startAt,e.startAt)&&Z_(n.endAt,e.endAt)}function pl(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function gl(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function ey(n,e,t){let r=el,i=!0;for(let s of gl(n,e)){let o=el,a=!0;switch(s.op){case"<":case"<=":o=NS(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=el}Y_({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Y_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function ty(n,e,t){let r=Un,i=!0;for(let s of gl(n,e)){let o=Un,a=!0;switch(s.op){case">=":case">":o=xS(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Un}J_({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];J_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var kt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function hv(n,e,t,r,i,s,o,a){return new kt(n,e,t,r,i,s,o,a)}function Bi(n){return new kt(n)}function ny(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function _f(n){return n.collectionGroup!==null}function wi(n){let e=L(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new de(Re.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new br(s,r))}),t.has(Re.keyField().canonicalString())||e.ce.push(new br(Re.keyField(),r))}return e.ce}function rt(n){let e=L(n);return e.le||(e.le=VS(e,wi(n))),e.le}function VS(n,e){if(n.limitType==="F")return Vh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new br(i.field,s)});let t=n.endAt?new zt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new zt(n.startAt.position,n.startAt.inclusive):null;return Vh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Oh(n,e){let t=n.filters.concat([e]);return new kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ml(n,e,t){return new kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ko(n,e){return Po(rt(n),rt(e))&&n.limitType===e.limitType}function dv(n){return`${Rr(rt(n))}|lt:${n.limitType}`}function pi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>cv(i)).join(", ")}]`),Ro(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ai(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ai(i)).join(",")),`Target(${r})`}(rt(n))}; limitType=${n.limitType})`}function No(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):U.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of wi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=X_(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,wi(r),i)||r.endAt&&!function(o,a,c){let u=X_(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,wi(r),i))}(n,e)}function fv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function pv(n){return(e,t)=>{let r=!1;for(let i of wi(n)){let s=OS(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function OS(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?zn(c,u):B()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}var Wt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Mr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return tv(this.inner)}size(){return this.innerSize}};var MS=new _e(U.comparator);function ct(){return MS}var gv=new _e(U.comparator);function Js(...n){let e=gv;for(let t of n)e=e.insert(t.key,t);return e}function mv(n){let e=gv;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Bt(){return eo()}function _v(){return eo()}function eo(){return new Wt(n=>n.toString(),(n,e)=>n.isEqual(e))}var FS=new _e(U.comparator),LS=new de(U.comparator);function X(...n){let e=LS;for(let t of n)e=e.add(t);return e}var US=new de(Q);function yf(){return US}function vf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:so(e)?"-0":e}}function yv(n){return{integerValue:""+n}}function vv(n,e){return Yy(e)?yv(e):vf(n,e)}var Ci=class{constructor(){this._=void 0}};function BS(n,e,t){return n instanceof Wn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&tc(s)&&(s=gf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof hn?Ev(n,e):n instanceof dn?Tv(n,e):function(i,s){let o=wv(i,s),a=ry(o)+ry(i.Pe);return Ah(o)&&Ah(i.Pe)?yv(a):vf(i.serializer,a)}(n,e)}function qS(n,e,t){return n instanceof hn?Ev(n,e):n instanceof dn?Tv(n,e):t}function wv(n,e){return n instanceof $n?function(r){return Ah(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Wn=class extends Ci{},hn=class extends Ci{constructor(e){super(),this.elements=e}};function Ev(n,e){let t=Iv(e);for(let r of n.elements)t.some(i=>Kt(i,r))||t.push(r);return{arrayValue:{values:t}}}var dn=class extends Ci{constructor(e){super(),this.elements=e}};function Tv(n,e){let t=Iv(e);for(let r of n.elements)t=t.filter(i=>!Kt(i,r));return{arrayValue:{values:t}}}var $n=class extends Ci{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function ry(n){return ye(n.integerValue||n.doubleValue)}function Iv(n){return co(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Pr=class{constructor(e,t){this.field=e,this.transform=t}};function jS(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof hn&&i instanceof hn||r instanceof dn&&i instanceof dn?Ti(r.elements,i.elements,Kt):r instanceof $n&&i instanceof $n?Kt(r.Pe,i.Pe):r instanceof Wn&&i instanceof Wn}(n.transform,e.transform)}var Mh=class{constructor(e,t){this.version=e,this.transformResults=t}},Se=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function nl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var bi=class{};function Av(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Hn(n.key,Se.none()):new Qn(n.key,n.data,Se.none());{let t=n.data,r=Xe.empty(),i=new de(Re.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Nt(n.key,r,new ft(i.toArray()),Se.none())}}function GS(n,e,t){n instanceof Qn?function(i,s,o){let a=i.value.clone(),c=sy(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Nt?function(i,s,o){if(!nl(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=sy(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Sv(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function to(n,e,t,r){return n instanceof Qn?function(s,o,a,c){if(!nl(s.precondition,o))return a;let u=s.value.clone(),d=oy(s.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Nt?function(s,o,a,c){if(!nl(s.precondition,o))return a;let u=oy(s.fieldTransforms,c,o),d=o.data;return d.setAll(Sv(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,r):function(s,o,a){return nl(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function KS(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=wv(r.transform,i||null);s!=null&&(t===null&&(t=Xe.empty()),t.set(r.field,s))}return t||null}function iy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ti(r,i,(s,o)=>jS(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Qn=class extends bi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Nt=class extends bi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Sv(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function sy(n,e,t){let r=new Map;G(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,qS(o,a,t[i]))}return r}function oy(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,BS(s,o,e))}return r}var Hn=class extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},uo=class extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ho=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&GS(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=to(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=to(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=_v();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let c=Av(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&Ti(this.mutations,e.mutations,(t,r)=>iy(t,r))&&Ti(this.baseMutations,e.baseMutations,(t,r)=>iy(t,r))}},Fh=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){G(e.mutations.length===r.length);let i=function(){return FS}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var fo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Lh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var xe,ie;function Cv(n){switch(n){default:return B();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function bv(n){if(n===void 0)return be("GRPC error has no .code"),R.UNKNOWN;switch(n){case xe.OK:return R.OK;case xe.CANCELLED:return R.CANCELLED;case xe.UNKNOWN:return R.UNKNOWN;case xe.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case xe.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case xe.INTERNAL:return R.INTERNAL;case xe.UNAVAILABLE:return R.UNAVAILABLE;case xe.UNAUTHENTICATED:return R.UNAUTHENTICATED;case xe.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case xe.NOT_FOUND:return R.NOT_FOUND;case xe.ALREADY_EXISTS:return R.ALREADY_EXISTS;case xe.PERMISSION_DENIED:return R.PERMISSION_DENIED;case xe.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case xe.ABORTED:return R.ABORTED;case xe.OUT_OF_RANGE:return R.OUT_OF_RANGE;case xe.UNIMPLEMENTED:return R.UNIMPLEMENTED;case xe.DATA_LOSS:return R.DATA_LOSS;default:return B()}}(ie=xe||(xe={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";var ay=null;function Rv(){return new TextEncoder}var zS=new Vn([4294967295,4294967295],0);function ly(n){let e=Rv().encode(n),t=new Zu;return t.update(e),new Uint8Array(t.digest())}function cy(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Vn([t,r],0),new Vn([i,s],0)]}var Uh=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ir(`Invalid padding: ${t}`);if(r<0)throw new Ir(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ir(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ir(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Vn.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Vn.fromNumber(r)));return i.compare(zS)===1&&(i=new Vn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=ly(e),[r,i]=cy(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=ly(e),[r,i]=cy(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ir=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var po=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,go.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(K.min(),i,new _e(Q),ct(),X())}},go=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,X(),X(),X())}};var Ei=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},_l=class{constructor(e,t){this.targetId=e,this.me=t}},yl=class{constructor(e,t,r=ke.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},vl=class{constructor(){this.fe=0,this.ge=hy(),this.pe=ke.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),r=X();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new go(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=hy()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Bh=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=ct(),this.qe=uy(),this.Qe=new _e(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(pl(s))if(r===0){let o=new U(s.path);this.Ue(t,o,Me.newNoDocument(o,K.min()))}else G(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}ay?.et(function(d,p,g,y,S){var k,x,q,j,M,z;let H={localCacheCount:d,existenceFilterCount:p.count,databaseId:g.database,projectId:g.projectId},Y=p.unchangedNames;return Y&&(H.bloomFilter={applied:S===0,hashCount:(k=Y?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=(q=(x=Y?.bits)===null||x===void 0?void 0:x.bitmap)===null||q===void 0?void 0:q.length)!==null&&j!==void 0?j:0,padding:(z=(M=Y?.bits)===null||M===void 0?void 0:M.padding)!==null&&z!==void 0?z:0,mightContain:E=>{var _;return(_=y?.mightContain(E))!==null&&_!==void 0&&_}}),H}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Gn(r).toUint8Array()}catch(c){if(c instanceof hl)return Et("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Uh(o,i,s)}catch(c){return Et(c instanceof Ir?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&pl(a.target)){let c=new U(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Me.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=X();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new po(e,t,this.Qe,this.ke,r);return this.ke=ct(),this.qe=uy(),this.Qe=new _e(Q),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new vl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new de(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new vl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function uy(){return new _e(U.comparator)}function hy(){return new _e(U.comparator)}var WS={asc:"ASCENDING",desc:"DESCENDING"},$S={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},QS={and:"AND",or:"OR"},qh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function jh(n,e){return n.useProto3Json||Ro(e)?e:{value:e}}function Ri(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Pv(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function HS(n,e){return Ri(n,e.toTimestamp())}function Pe(n){return G(!!n),K.fromTimestamp(function(t){let r=un(t);return new Ee(r.seconds,r.nanos)}(n))}function wf(n,e){return Gh(n,e).canonicalString()}function Gh(n,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function kv(n){let e=se.fromString(n);return G(Bv(e)),e}function mo(n,e){return wf(n.databaseId,e.path)}function jt(n,e){let t=kv(e);if(t.get(1)!==n.databaseId.projectId)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(Dv(t))}function Nv(n,e){return wf(n.databaseId,e)}function xv(n){let e=kv(n);return e.length===4?se.emptyPath():Dv(e)}function Kh(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Dv(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function dy(n,e,t){return{name:mo(n,e),fields:t.value.mapValue.fields}}function Vv(n,e,t){let r=jt(n,e.name),i=Pe(e.updateTime),s=e.createTime?Pe(e.createTime):K.min(),o=new Xe({mapValue:{fields:e.fields}}),a=Me.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function YS(n,e){return"found"in e?function(r,i){G(!!i.found),i.found.name,i.found.updateTime;let s=jt(r,i.found.name),o=Pe(i.found.updateTime),a=i.found.createTime?Pe(i.found.createTime):K.min(),c=new Xe({mapValue:{fields:i.found.fields}});return Me.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(r,i){G(!!i.missing),G(!!i.readTime);let s=jt(r,i.missing),o=Pe(i.readTime);return Me.newNoDocument(s,o)}(n,e):B()}function JS(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:B()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?(G(d===void 0||typeof d=="string"),ke.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),ke.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?R.UNKNOWN:bv(u.code);return new D(d,u.message||"")}(o);t=new yl(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=jt(n,r.document.name),s=Pe(r.document.updateTime),o=r.document.createTime?Pe(r.document.createTime):K.min(),a=new Xe({mapValue:{fields:r.document.fields}}),c=Me.newFoundDocument(i,s,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];t=new Ei(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=jt(n,r.document),s=r.readTime?Pe(r.readTime):K.min(),o=Me.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Ei([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=jt(n,r.document),s=r.removedTargetIds||[];t=new Ei([],s,i,null)}else{if(!("filter"in e))return B();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Lh(i,s),a=r.targetId;t=new _l(a,o)}}return t}function _o(n,e){let t;if(e instanceof Qn)t={update:dy(n,e.key,e.value)};else if(e instanceof Hn)t={delete:mo(n,e.key)};else if(e instanceof Nt)t={update:dy(n,e.key,e.data),updateMask:r0(e.fieldMask)};else{if(!(e instanceof uo))return B();t={verify:mo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Wn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof hn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof dn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof $n)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw B()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:HS(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B()}(n,e.precondition)),t}function zh(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Se.updateTime(Pe(s.updateTime)):s.exists!==void 0?Se.exists(s.exists):Se.none()}(e.currentDocument):Se.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let c=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),c=new Wn;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new hn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new dn(d)}else"increment"in a?c=new $n(o,a.increment):B();let u=Re.fromServerFormat(a.fieldPath);return new Pr(u,c)}(n,i)):[];if(e.update){e.update.name;let i=jt(n,e.update.name),s=new Xe({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new ft(u.map(d=>Re.fromServerFormat(d)))}(e.updateMask);return new Nt(i,s,o,t,r)}return new Qn(i,s,t,r)}if(e.delete){let i=jt(n,e.delete);return new Hn(i,t)}if(e.verify){let i=jt(n,e.verify);return new uo(i,t)}return B()}function XS(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Pe(i.updateTime):Pe(s);return o.isEqual(K.min())&&(o=Pe(s)),new Mh(o,i.transformResults||[])}(t,e))):[]}function Ov(n,e){return{documents:[Nv(n,e.path)]}}function Mv(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Nv(n,i);let s=function(u){if(u.length!==0)return Uv(ue.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(g){return{field:gi(g.field),direction:e0(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=jh(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:i}}function Fv(n){let e=xv(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){G(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(p){let g=Lv(p);return g instanceof ue&&mf(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(g=>function(S){return new br(mi(S.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(p){let g;return g=typeof p=="object"?p.value:p,Ro(g)?null:g}(t.limit));let c=null;t.startAt&&(c=function(p){let g=!!p.before,y=p.values||[];return new zt(y,g)}(t.startAt));let u=null;return t.endAt&&(u=function(p){let g=!p.before,y=p.values||[];return new zt(y,g)}(t.endAt)),hv(e,i,o,s,a,"F",c,u)}function ZS(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Lv(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=mi(t.unaryFilter.field);return re.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=mi(t.unaryFilter.field);return re.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=mi(t.unaryFilter.field);return re.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=mi(t.unaryFilter.field);return re.create(o,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):n.fieldFilter!==void 0?function(t){return re.create(mi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ue.create(t.compositeFilter.filters.map(r=>Lv(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B()}function e0(n){return WS[n]}function t0(n){return $S[n]}function n0(n){return QS[n]}function gi(n){return{fieldPath:n.canonicalString()}}function mi(n){return Re.fromServerFormat(n.fieldPath)}function Uv(n){return n instanceof re?function(t){if(t.op==="=="){if(H_(t.value))return{unaryFilter:{field:gi(t.field),op:"IS_NAN"}};if(Q_(t.value))return{unaryFilter:{field:gi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(H_(t.value))return{unaryFilter:{field:gi(t.field),op:"IS_NOT_NAN"}};if(Q_(t.value))return{unaryFilter:{field:gi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gi(t.field),op:t0(t.op),value:t.value}}}(n):n instanceof ue?function(t){let r=t.getFilters().map(i=>Uv(i));return r.length===1?r[0]:{compositeFilter:{op:n0(t.op),filters:r}}}(n):B()}function r0(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Bv(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Pi=class n{constructor(e,t,r,i,s=K.min(),o=K.min(),a=ke.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var wl=class{constructor(e){this.ct=e}};function i0(n,e){let t;if(e.document)t=Vv(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=Nr(e.noDocument.readTime);t=Me.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{let r=U.fromSegments(e.unknownDocument.path),i=Nr(e.unknownDocument.version);t=Me.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Ee(i[0],i[1]);return K.fromTimestamp(s)}(e.readTime)),t}function fy(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:El(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:mo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ri(s,o.version.toTimestamp()),createTime:Ri(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:kr(e.version)};else{if(!e.isUnknownDocument())return B();r.unknownDocument={path:t.path.toArray(),version:kr(e.version)}}return r}function El(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function kr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Nr(n){let e=new Ee(n.seconds,n.nanoseconds);return K.fromTimestamp(e)}function wr(n,e){let t=(e.baseMutations||[]).map(s=>zh(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>zh(n.ct,s)),i=Ee.fromMillis(e.localWriteTimeMs);return new ho(e.batchId,i,t,r)}function Xs(n){let e=Nr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Nr(n.lastLimboFreeSnapshotVersion):K.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),rt(Bi(xv(s.documents[0])))}(n.query):function(s){return rt(Fv(s))}(n.query),new Pi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ke.fromBase64String(n.resumeToken))}function qv(n,e){let t=kr(e.snapshotVersion),r=kr(e.lastLimboFreeSnapshotVersion),i;i=pl(e.target)?Ov(n.ct,e.target):Mv(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Rr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ef(n){let e=Fv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ml(e,e.limit,"L"):e}function oh(n,e){return new fo(e.largestBatchId,zh(n.ct,e.overlayMutation))}function py(n,e){let t=e.path.lastSegment();return[n,nt(e.path.popLast()),t]}function gy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:kr(r.readTime),documentKey:nt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Wh=class{getBundleMetadata(e,t){return my(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Nr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return my(e).put(function(i){return{bundleId:i.id,createTime:kr(Pe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return _y(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Ef(s.bundledQuery),readTime:Nr(s.readTime)}}(r)})}saveNamedQuery(e,t){return _y(e).put(function(i){return{name:i.name,readTime:kr(Pe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function my(n){return Ue(n,"bundles")}function _y(n){return Ue(n,"namedQueries")}var Tl=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return $s(e).get(py(this.userId,t)).next(r=>r?oh(this.serializer,r):null)}getOverlays(e,t){let r=Bt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new fo(t,o);i.push(this.ht(e,a))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(nt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push($s(e).j("collectionPathOverlayIndex",a))}),b.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Bt(),s=nt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return $s(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=oh(this.serializer,c);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Bt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return $s(e).J({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{let p=oh(this.serializer,u);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return $s(e).put(function(i,s,o){let[a,c,u]=py(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_o(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function $s(n){return Ue(n,"documentOverlays")}var $h=class{Pt(e){return Ue(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?ke.fromUint8Array(r):ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var ln=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ye(e.integerValue));else if("doubleValue"in e){let r=ye(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),so(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=un(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Gn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?rv(e)?this.dt(t,Number.MAX_SAFE_INTEGER):nc(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(ye(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};ln.vt=new ln;function s0(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function yy(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=s0(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Qh=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=yy(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=yy(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Hh=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Yh=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Er=class{constructor(){this.jt=new Qh,this.Ht=new Hh(this.jt),this.Jt=new Yh(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Tr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function On(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=vy(n.arrayValue,e.arrayValue),t!==0?t:(t=vy(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function vy(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Il=class{constructor(e){this.Xt=new de((t,r)=>Re.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=_h(e);if(t!==void 0&&!this.sn(t))return!1;let r=yr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let c=r[s];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new de(Re.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new vi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new vi(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new vi(r.field,r.dir==="asc"?0:1)));return new Ii(Ii.UNKNOWN_ID,this.collectionId,t,io.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function jv(n){var e,t;if(G(n instanceof re||n instanceof ue),n instanceof re){if(n instanceof fl){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return ue.create(i,"or")}return n}let r=n.filters.map(i=>jv(i));return ue.create(r,n.op)}function o0(n){if(n.getFilters().length===0)return[];let e=Zh(jv(n));return G(Gv(e)),Jh(e)||Xh(e)?[e]:e.getFilters()}function Jh(n){return n instanceof re}function Xh(n){return n instanceof ue&&mf(n)}function Gv(n){return Jh(n)||Xh(n)||function(t){if(t instanceof ue&&Sh(t)){for(let r of t.getFilters())if(!Jh(r)&&!Xh(r))return!1;return!0}return!1}(n)}function Zh(n){if(G(n instanceof re||n instanceof ue),n instanceof re)return n;if(n.filters.length===1)return Zh(n.filters[0]);let e=n.filters.map(r=>Zh(r)),t=ue.create(e,n.op);return t=Al(t),Gv(t)?t:(G(t instanceof ue),G(Si(t)),G(t.filters.length>1),t.filters.reduce((r,i)=>Tf(r,i)))}function Tf(n,e){let t;return G(n instanceof re||n instanceof ue),G(e instanceof re||e instanceof ue),t=n instanceof re?e instanceof re?function(i,s){return ue.create([i,s],"and")}(n,e):wy(n,e):e instanceof re?wy(e,n):function(i,s){if(G(i.filters.length>0&&s.filters.length>0),Si(i)&&Si(s))return lv(i,s.getFilters());let o=Sh(i)?i:s,a=Sh(i)?s:i,c=o.filters.map(u=>Tf(u,a));return ue.create(c,"or")}(n,e),Al(t)}function wy(n,e){if(Si(e))return lv(e,n.getFilters());{let t=e.filters.map(r=>Tf(n,r));return ue.create(t,"or")}}function Al(n){if(G(n instanceof re||n instanceof ue),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return Al(e[0]);if(ov(n))return n;let t=e.map(i=>Al(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof ue&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ue.create(r,n.op)}var ed=class{constructor(){this.un=new yo}addToCollectionParentIndex(e,t){return this.un.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(Tt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(Tt.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},yo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new de(se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new de(se.comparator)).toArray()}};var Ha=new Uint8Array(0),td=class{constructor(e,t){this.databaseId=t,this.cn=new yo,this.ln=new Wt(r=>Rr(r),(r,i)=>Po(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:nt(i)};return Ey(e).put(s)}return b.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[zy(t),""],!1,!0);return Ey(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Ut(o.parent))}return r})}addFieldIndex(e,t){let r=Qs(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=hi(e);return s.next(a=>{o.put(gy(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Qs(e),i=hi(e),s=ui(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Qs(e),r=ui(e),i=hi(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return b.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Il(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=ui(e),i=!0,s=new Map;return b.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=X(),a=[];return b.forEach(s,(c,u)=>{V("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(c)} to execute ${Rr(t)}`);let d=function(M,z){let H=_h(z);if(H===void 0)return null;for(let Y of gl(M,H.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(u,c),p=function(M,z){let H=new Map;for(let Y of yr(z))for(let E of gl(M,Y.fieldPath))switch(E.op){case"==":case"in":H.set(Y.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return H.set(Y.fieldPath.canonicalString(),E.value),Array.from(H.values())}return null}(u,c),g=function(M,z){let H=[],Y=!0;for(let E of yr(z)){let _=E.kind===0?ey(M,E.fieldPath,M.startAt):ty(M,E.fieldPath,M.startAt);H.push(_.value),Y&&(Y=_.inclusive)}return new zt(H,Y)}(u,c),y=function(M,z){let H=[],Y=!0;for(let E of yr(z)){let _=E.kind===0?ty(M,E.fieldPath,M.endAt):ey(M,E.fieldPath,M.endAt);H.push(_.value),Y&&(Y=_.inclusive)}return new zt(H,Y)}(u,c),S=this.In(c,u,g),k=this.In(c,u,y),x=this.Tn(c,u,p),q=this.En(c.indexId,d,S,g.inclusive,k,y.inclusive,x);return b.forEach(q,j=>r.G(j,t.limit).next(M=>{M.forEach(z=>{let H=U.fromSegments(z.documentKey);o.has(H)||(o=o.add(H),a.push(H))})}))}).next(()=>a)}return b.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=o0(ue.create(e.filters,"and")).map(r=>Vh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,a){let c=(t!=null?t.length:1)*Math.max(r.length,s.length),u=c/(t!=null?t.length:1),d=[];for(let p=0;p<c;++p){let g=t?this.dn(t[p/u]):Ha,y=this.An(e,g,r[p%u],i),S=this.Rn(e,g,s[p%u],o),k=a.map(x=>this.An(e,g,x,!0));d.push(...this.createRange(y,S,k))}return d}An(e,t,r,i){let s=new Tr(e,U.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new Tr(e,U.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new Il(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return b.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new de(Re.comparator),d=!1;for(let p of c.filters)for(let g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:u=u.add(g.field));for(let p of c.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new Er;for(let i of yr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);ln.vt.It(s,o)}return r.zt()}dn(e){let t=new Er;return ln.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new Er;return ln.vt.It(Cr(this.databaseId,t),r.Yt(function(s){let o=yr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new Er);let s=0;for(let o of yr(e)){let a=r[s++];for(let c of i)if(this.fn(t,o.fieldPath)&&co(a))i=this.gn(i,o,a);else{let u=c.Yt(o.kind);ln.vt.It(a,u)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let c=new Er;c.seed(a.zt()),ln.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Qs(e),i=hi(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return b.forEach(s,a=>i.get([a.indexId,this.uid]).next(c=>{o.push(function(d,p){let g=p?new io(p.sequenceNumber,new Tt(Nr(p.readTime),new U(Ut(p.documentKey)),p.largestBatchId)):io.empty(),y=d.fields.map(([S,k])=>new vi(Re.fromServerFormat(S),k));return new Ii(d.indexId,d.collectionGroup,y,g)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Q(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Qs(e),s=hi(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,c=>s.put(gy(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return b.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),b.forEach(a,c=>this.wn(e,i,c).next(u=>{let d=this.Sn(s,c);return u.isEqual(d)?b.resolve():this.bn(e,s,c,u,d)}))))})}Dn(e,t,r,i){return ui(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return ui(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=ui(e),s=new de(On);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{s=s.add(new Tr(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let r=new de(On),i=this.Vn(t,e);if(i==null)return r;let s=_h(t);if(s!=null){let o=e.data.field(s.fieldPath);if(co(o))for(let a of o.arrayValue.values||[])r=r.add(new Tr(t.indexId,e.key,this.dn(a),i))}else r=r.add(new Tr(t.indexId,e.key,Ha,i));return r}bn(e,t,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,p,g){let y=c.getIterator(),S=u.getIterator(),k=ci(y),x=ci(S);for(;k||x;){let q=!1,j=!1;if(k&&x){let M=d(k,x);M<0?j=!0:M>0&&(q=!0)}else k!=null?j=!0:q=!0;q?(p(x),x=ci(S)):j?(g(k),k=ci(y)):(k=ci(y),x=ci(S))}}(i,s,On,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),b.waitFor(o)}yn(e){let t=1;return hi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>On(o,a)).filter((o,a,c)=>!a||On(o,c[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=On(o,e),c=On(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&c<0)i.push(o),i.push(o.Zt());else if(c>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ha,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ha,[]];s.push(IDBKeyRange.bound(a,c))}return s}Cn(e,t){return On(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ty)}getMinOffset(e,t){return b.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||B())).next(Ty)}};function Ey(n){return Ue(n,"collectionParents")}function ui(n){return Ue(n,"indexEntries")}function Qs(n){return Ue(n,"indexConfiguration")}function hi(n){return Ue(n,"indexState")}function Ty(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;df(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Tt(e.readTime,e.documentKey,t)}var Iy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Kv(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=r.J({range:o},(d,p,g)=>(a++,g.delete()));s.push(c.next(()=>{G(a===1)}));let u=[];for(let d of t.mutations){let p=Jy(e,d.key.path,t.batchId);s.push(i.delete(p)),u.push(d.key)}return b.waitFor(s).next(()=>u)}function Sl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B();e=n.noDocument}return JSON.stringify(e).length}wt.DEFAULT_COLLECTION_PERCENTILE=10,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wt.DEFAULT=new wt(41943040,wt.DEFAULT_COLLECTION_PERCENTILE,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wt.DISABLED=new wt(-1,0,0);var Cl=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=_i(e),o=Mn(e);return o.add({}).next(a=>{G(typeof a=="number");let c=new ho(a,t,r,i),u=function(y,S,k){let x=k.baseMutations.map(j=>_o(y.ct,j)),q=k.mutations.map(j=>_o(y.ct,j));return{userId:S,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:x,mutations:q}}(this.serializer,this.userId,c),d=[],p=new de((g,y)=>Q(g.canonicalString(),y.canonicalString()));for(let g of i){let y=Jy(this.userId,g.key.path,a);p=p.add(g.key.path.popLast()),d.push(o.put(u)),d.push(s.put(y,dS))}return p.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),b.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return Mn(e).get(t).next(r=>r?(G(r.userId===this.userId),wr(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?b.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Mn(e).J({index:"userMutationsIndex",range:i},(o,a,c)=>{a.userId===this.userId&&(G(a.batchId>=r),s=wr(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Mn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mn(e).U("userMutationsIndex",t).next(r=>r.map(i=>wr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Za(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return _i(e).J({range:i},(o,a,c)=>{let[u,d,p]=o,g=Ut(d);if(u===this.userId&&t.path.isEqual(g))return Mn(e).get(p).next(y=>{if(!y)throw B();G(y.userId===this.userId),s.push(wr(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de(Q),i=[];return t.forEach(s=>{let o=Za(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=_i(e).J({range:a},(u,d,p)=>{let[g,y,S]=u,k=Ut(y);g===this.userId&&s.path.isEqual(k)?r=r.add(S):p.done()});i.push(c)}),b.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Za(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new de(Q);return _i(e).J({range:o},(c,u,d)=>{let[p,g,y]=c,S=Ut(g);p===this.userId&&r.isPrefixOf(S)?S.length===i&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Mn(e).get(s).next(o=>{if(o===null)throw B();G(o.userId===this.userId),r.push(wr(this.serializer,o))}))}),b.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Kv(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),b.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return _i(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let c=Ut(s[1]);i.push(c)}else a.done()}).next(()=>{G(i.length===0)})})}containsKey(e,t){return zv(e,this.userId,t)}Nn(e){return Wv(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function zv(n,e,t){let r=Za(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return _i(n).J({range:s,H:!0},(a,c,u)=>{let[d,p,g]=a;d===e&&p===i&&(o=!0),u.done()}).next(()=>o)}function Mn(n){return Ue(n,"mutations")}function _i(n){return Ue(n,"documentMutations")}function Wv(n){return Ue(n,"mutationQueues")}var ki=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var nd=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new ki(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>K.fromTimestamp(new Ee(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>di(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(G(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return di(e).J((o,a)=>{let c=Xs(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return di(e).J((r,i)=>{let s=Xs(i);t(s)})}qn(e){return Ay(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return Ay(e).put("targetGlobalKey",t)}Kn(e,t){return di(e).put(qv(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Rr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return di(e).J({range:i,index:"queryTargetsIndex"},(o,a,c)=>{let u=Xs(a);Po(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Fn(e);return t.forEach(o=>{let a=nt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),b.waitFor(i)}removeMatchingKeys(e,t,r){let i=Fn(e);return b.forEach(t,s=>{let o=nt(s.path);return b.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Fn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Fn(e),s=X();return i.J({range:r,H:!0},(o,a,c)=>{let u=Ut(o[1]),d=new U(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=nt(t.path),i=IDBKeyRange.bound([r],[zy(r)],!1,!0),s=0;return Fn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}ot(e,t){return di(e).get(t).next(r=>r?Xs(r):null)}};function di(n){return Ue(n,"targets")}function Ay(n){return Ue(n,"targetGlobal")}function Fn(n){return Ue(n,"targetDocuments")}function Sy([n,e],[t,r]){let i=Q(n,t);return i===0?Q(e,r):i}var rd=class{constructor(e){this.Un=e,this.buffer=new de(Sy),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Sy(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},id=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>N(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xn(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Jn(t)}yield this.Hn(3e5)}))}},sd=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return b.resolve(dt.oe);let r=new rd(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Iy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Iy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,a=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(u=Date.now(),fi()<=vt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function a0(n,e){return new sd(n,e)}var od=class{constructor(e,t){this.db=e,this.garbageCollector=a0(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return Ya(e,r)}removeReference(e,t,r){return Ya(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ya(e,t)}nr(e,t){return function(i,s){let o=!1;return Wv(i).Y(a=>zv(i,a,s).next(c=>(c&&(o=!0),b.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,K.min()),Fn(e).delete(function(p){return[0,nt(p.path)]}(o))))});i.push(c)}}).next(()=>b.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ya(e,t)}tr(e,t){let r=Fn(e),i,s=dt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==dt.oe&&t(new U(Ut(i)),s),s=u,i=c):s=dt.oe}).next(()=>{s!==dt.oe&&t(new U(Ut(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Ya(n,e){return Fn(n).put(function(r,i){return{targetId:0,path:nt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var bl=class{constructor(){this.changes=new Wt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var ad=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return _r(e).put(r)}removeEntry(e,t,r){return _r(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],El(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Me.newInvalidDocument(t);return _r(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Hs(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Me.newInvalidDocument(t)};return _r(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Hs(t))},(i,s)=>{r={document:this.ir(t,s),size:Sl(s)}}).next(()=>r)}getEntries(e,t){let r=ct();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=ct(),i=new _e(U.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);r=r.insert(s,a),i=i.insert(s,Sl(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return b.resolve();let i=new de(Ry);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Hs(i.first()),Hs(i.last())),o=i.getIterator(),a=o.getNext();return _r(e).J({index:"documentKeyIndex",range:s},(c,u,d)=>{let p=U.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Ry(a,p)<0;)r(a,null),a=o.getNext();a&&a.isEqual(p)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?d.$(Hs(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),El(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _r(e).U(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let d=ct();for(let p of u){let g=this.ir(U.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(No(t,g)||i.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=ct(),o=by(t,r),a=by(t,Tt.max());return _r(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let p=this.ir(U.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new ld(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Cy(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return Cy(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=i0(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(K.min())))return r}return Me.newInvalidDocument(e)}};function $v(n){return new ad(n)}var ld=class extends bl{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Wt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new de((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=fy(this.cr.serializer,o);i=i.add(s.path.popLast());let u=Sl(c);r+=u-a.size,t.push(this.cr.addEntry(e,s,c))}else if(r-=a.size,this.trackRemovals){let c=fy(this.cr.serializer,o.convertToNoDocument(K.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Cy(n){return Ue(n,"remoteDocumentGlobal")}function _r(n){return Ue(n,"remoteDocumentsV14")}function Hs(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function by(n,e){let t=e.documentKey.path.toArray();return[n,El(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Ry(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Q(t[s],r[s]),i)return i;return i=Q(t.length,r.length),i||(i=Q(t[t.length-2],r[r.length-2]),i||Q(t[t.length-1],r[r.length-1]))}var cd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Rl=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&to(r.mutation,i,ft.empty(),Ee.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,X()).next(()=>r))}getLocalViewOfDocuments(e,t,r=X()){let i=Bt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Js();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Bt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,X()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=ct(),o=eo(),a=function(){return eo()}();return t.forEach((c,u)=>{let d=r.get(u.key);i.has(u.key)&&(d===void 0||d.mutation instanceof Nt)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),to(d.mutation,u,d.mutation.getFieldMask(),Ee.now())):o.set(u.key,ft.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var p;return a.set(u,new cd(d,(p=o.get(u))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let r=eo(),i=new _e((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=r.get(c)||ft.empty();d=a.applyToLocalView(u,d),r.set(c,d);let p=(i.get(a.batchId)||X()).add(c);i=i.insert(a.batchId,p)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,p=_v();d.forEach(g=>{if(!s.has(g)){let y=Av(t.get(g),r.get(g));y!==null&&p.set(g,y),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return b.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):_f(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):b.resolve(Bt()),a=-1,c=s;return o.next(u=>b.forEach(u,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(d)?b.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{c=c.insert(d,g)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,X())).next(d=>({batchId:a,changes:mv(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=Js();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Js();return this.indexManager.getCollectionParents(e,s).next(a=>b.forEach(a,c=>{let u=function(p,g){return new kt(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(d=>{d.forEach((p,g)=>{o=o.insert(p,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,Me.newInvalidDocument(d)))});let a=Js();return o.forEach((c,u)=>{let d=s.get(c);d!==void 0&&to(d.mutation,u,ft.empty(),Ee.now()),No(t,u)&&(a=a.insert(c,u))}),a})}};var ud=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return b.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Pe(i.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:Ef(i.bundledQuery),readTime:Pe(i.readTime)}}(t)),b.resolve()}};var hd=class{constructor(){this.overlays=new _e(U.comparator),this.Ir=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Bt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){let i=Bt(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new _e((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=Bt(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Bt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=i)););return b.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new fo(t,r));let s=this.Ir.get(t);s===void 0&&(s=X(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var dd=class{constructor(){this.sessionToken=ke.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}};var vo=class{constructor(){this.Tr=new de(De.Er),this.dr=new de(De.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new De(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new De(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new U(new se([])),r=new De(t,e),i=new De(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new se([])),r=new De(t,e),i=new De(t,e+1),s=X();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new De(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},De=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||U.comparator(e.key,t.key)}};var fd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new de(De.Er)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ho(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new De(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new De(t,0),i=new De(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let a=this.Dr(o.wr);s.push(a)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de(Q);return t.forEach(i=>{let s=new De(i,0),o=new De(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),b.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new De(new U(s),0),a=new de(Q);return this.br.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.wr)),!0)},o),b.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return b.forEach(t.mutations,i=>{let s=new De(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new De(t,0),i=this.br.firstAfterOrEqual(r);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var pd=class{constructor(e){this.Mr=e,this.docs=function(){return new _e(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=ct();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Me.newInvalidDocument(i))}),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=ct(),o=t.path,a=new U(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||df($y(d),r)<=0||(i.has(d.key)||No(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}Or(e,t){return b.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new gd(this)}getSize(e){return b.resolve(this.size)}},gd=class extends bl{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),b.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var md=class{constructor(e){this.persistence=e,this.Nr=new Wt(t=>Rr(t),Po),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Lr=0,this.Br=new vo,this.targetCount=0,this.kr=ki.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),b.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new ki(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Kn(t),b.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this.Br.containsKey(t))}};var Pl=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new dt(0),this.Kr=!1,this.Kr=!0,this.$r=new dd,this.referenceDelegate=e(this),this.Ur=new md(this),this.indexManager=new ed,this.remoteDocumentCache=function(i){return new pd(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new wl(t),this.Gr=new ud(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new fd(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new _d(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return b.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},_d=class extends ll{constructor(e){super(),this.currentSequenceNumber=e}},kl=class n{constructor(e){this.persistence=e,this.Jr=new vo,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),b.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Xr,r=>{let i=U.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return b.or([()=>b.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var yd=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new cl("createOrUpgrade",t);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",K_,{unique:!0}),c.createObjectStore("documentMutations")}(e),Py(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Py(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",K_,{unique:!0});let p=u.store("mutations"),g=d.map(y=>p.put(y));return b.waitFor(g)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:AS});u.createIndex("collectionPathOverlayIndex",SS,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",CS,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:fS});u.createIndex("documentKeyIndex",pS),u.createIndex("collectionGroupIndex",gS)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:wS}).createIndex("sequenceNumberIndex",ES,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:TS}).createIndex("documentKeyIndex",IS,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Sl(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>b.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>b.forEach(a,c=>{G(c.userId===s.userId);let u=wr(this.serializer,c);return Kv(e,s.userId,u).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let c=new se(o),u=function(p){return[0,nt(p)]}(c);s.push(t.get(u).next(d=>d?b.resolve():(p=>t.put({targetId:0,path:nt(p),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:vS});let r=t.store("collectionParents"),i=new yo,s=o=>{if(i.add(o)){let a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:nt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new se(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],u)=>{let d=Ut(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=Xs(i),o=qv(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),c=function(p){return p.document?new U(se.fromString(p.document.name).popFirst(5)):p.noDocument?U.fromSegments(p.noDocument.path):p.unknownDocument?U.fromSegments(p.unknownDocument.path):B()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>b.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=$v(this.serializer),s=new Pl(kl.Zr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:X();wr(this.serializer,c).keys().forEach(p=>d=d.add(p)),a.set(c.userId,d)}),b.forEach(a,(c,u)=>{let d=new Ve(u),p=Tl.lt(this.serializer,d),g=s.getIndexManager(d),y=Cl.lt(d,this.serializer,g,s.referenceDelegate);return new Rl(i,y,p,g).recalculateAndSaveOverlaysForDocumentKeys(new oo(t,dt.oe),c).next()})})}};function Py(n){n.createObjectStore("targetDocuments",{keyPath:_S}).createIndex("documentTargetsIndex",yS,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",mS,{unique:!0}),n.createObjectStore("targetGlobal")}var ah="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",vd=class n{constructor(e,t,r,i,s,o,a,c,u,d,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!n.D())throw new D(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new od(this,i),this.Ai=t+"main",this.serializer=new wl(c),this.Ri=new jn(this.Ai,this.hi,new yd(this.serializer)),this.$r=new $h,this.Ur=new nd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$v(this.serializer),this.Gr=new Wh,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&be("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,ah);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new dt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>N(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>N(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>N(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ja(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Xn(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ys(e).get("owner").next(t=>b.resolve(this.vi(t)))}Ci(e){return Ja(e).delete(this.clientId)}Fi(){return N(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ue(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return b.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?b.resolve(!0):Ys(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,ah);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ja(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return N(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new oo(e,dt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Ja(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Cl.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new td(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Tl.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?PS:c===16?RS:c===15?pf:c===14?ev:c===13?Zy:c===12?bS:c===11?Xy:void B()}(this.hi),o;return this.Ri.runTransaction(e,i,s,a=>(o=new oo(a,this.Qr?this.Qr.next():dt.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(R.FAILED_PRECONDITION,Qy);return r(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Ys(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(R.FAILED_PRECONDITION,ah)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ys(e).put("owner",t)}static D(){return jn.D()}bi(e){let t=Ys(e);return t.get("owner").next(r=>this.vi(r)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(be(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;Uu()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return be("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){be("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ys(n){return Ue(n,"owner")}function Ja(n){return Ue(n,"clientMetadata")}function If(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var wd=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=X(),i=X();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Ed=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Nl=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Uu()?8:Hy(Vs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Ed;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(fi()<=vt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",pi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),b.resolve()):(fi()<=vt.DEBUG&&V("QueryEngine","Query:",pi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(fi()<=vt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",pi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rt(t))):b.resolve())}Yi(e,t){if(ny(t))return b.resolve(null);let r=rt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ml(t,null,"F"),r=rt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=X(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.ts(t,a);return this.ns(t,u,o,c.readTime)?this.Yi(e,ml(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,r,i){return ny(t)||i.isEqual(K.min())?b.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?b.resolve(null):(fi()<=vt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pi(t)),this.rs(e,o,t,Wy(i,-1)).next(a=>a))})}ts(e,t){let r=new de(pv(e));return t.forEach((i,s)=>{No(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return fi()<=vt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",pi(t)),this.Ji.getDocumentsMatchingQuery(e,t,Tt.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Td=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new _e(Q),this._s=new Wt(s=>Rr(s),Po),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rl(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function Qv(n,e,t,r){return new Td(n,e,t,r)}function Hv(n,e){return N(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=X();for(let u of i){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function l0(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let p=u.batch,g=p.keys(),y=b.resolve();return g.forEach(S=>{y=y.next(()=>d.getEntry(c,S)).next(k=>{let x=u.docVersions.get(S);G(x!==null),k.version.compareTo(x)<0&&(p.applyToRemoteDocument(k,u),k.isValidDocument()&&(k.setReadTime(u.commitVersion),d.addEntry(k)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,p))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=X();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Yv(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function c0(n,e){let t=L(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((d,p)=>{let g=i.get(p);if(!g)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,p)));let y=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(ke.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),i=i.insert(p,y),function(k,x,q){return k.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let c=ct(),u=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(Jv(s,o,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!r.isEqual(K.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return b.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.os=i,s))}function Jv(n,e,t){let r=X(),i=X();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=ct();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(K.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):V("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:i}})}function u0(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ni(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,b.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new Pi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function xi(n,e,t){return N(this,null,function*(){let r=L(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Xn(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function xl(n,e,t){let r=L(n),i=K.min(),s=X();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let p=L(c),g=p._s.get(d);return g!==void 0?b.resolve(p.os.get(g)):p.Ur.getTargetData(u,d)}(r,o,rt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:K.min(),t?s:X())).next(a=>(ew(r,fv(e),a),{documents:a,Ts:s})))}function Xv(n,e){let t=L(n),r=L(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function Zv(n,e){let t=L(n),r=t.us.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,Wy(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(ew(t,e,i),i))}function ew(n,e,t){let r=n.us.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function h0(n,e,t,r){return N(this,null,function*(){let i=L(n),s=X(),o=ct();for(let u of t){let d=e.Es(u.metadata.name);u.document&&(s=s.add(d));let p=e.ds(u);p.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,p)}let a=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield Ni(i,function(d){return rt(Bi(se.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",u=>Jv(u,a,o).next(d=>(a.apply(u),d)).next(d=>i.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>i.Ur.addMatchingKeys(u,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))})}function d0(r,i){return N(this,arguments,function*(n,e,t=X()){let s=yield Ni(n,rt(Ef(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=Pe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let u=s.withResumeToken(ke.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(u.targetId,u),o.Ur.updateTargetData(a,u).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function ky(n,e){return`firestore_clients_${n}_${e}`}function Ny(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function lh(n,e){return`firestore_targets_${n}_${e}`}var Dl=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new D(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(be("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},no=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new D(r.error.code,r.error.message))),s?new n(e,r.state,i):(be("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Vl=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=yf();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Yy(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(be("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Id=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(be("SharedClientState",`Failed to parse online state: ${e}`),null)}},wo=class{constructor(){this.activeTargetIds=yf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},ro=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new _e(Q),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=ky(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new wo),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return N(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(ky(this.persistenceKey,r));if(i){let s=Vl.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(lh(this.persistenceKey,e));if(i){let s=no.Rs(e,i);s&&(r=s.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void be("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>N(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=function(s){let o=dt.oe;if(s!=null)try{let a=JSON.parse(s);G(typeof a=="number"),o=a}catch(a){be("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==dt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new Dl(this.currentUser,e,t,r),s=Ny(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=Ny(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=lh(this.persistenceKey,e),s=new no(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return Vl.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Dl.Rs(new Ve(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return no.Rs(i,t)}Ls(e){return Id.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return N(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],a=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=yf();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Ol=class{constructor(){this.so=new wo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new wo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Ad=class{_o(e){}shutdown(){}};var Ml=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Xa=null;function ch(){return Xa===null?Xa=function(){return 268435456+Math.round(2147483648*Math.random())}():Xa++,"0x"+Xa.toString(16)}var f0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Sd=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Je="WebChannelConnection",Cd=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let a=ch(),c=this.xo(t,r.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,c,u,i).then(d=>(V("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Et("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",i),d})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ui}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=f0[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=ch();return new Promise((o,a)=>{let c=new eh;c.setWithCredentials(!0),c.listenOnce(nh.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ws.NO_ERROR:let d=c.getResponseJson();V(Je,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case Ws.TIMEOUT:V(Je,`RPC '${e}' ${s} timed out`),a(new D(R.DEADLINE_EXCEEDED,"Request time out"));break;case Ws.HTTP_ERROR:let p=c.getStatus();if(V(Je,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let g=c.getResponseJson();Array.isArray(g)&&(g=g[0]);let y=g?.error;if(y&&y.status&&y.message){let S=function(x){let q=x.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(q)>=0?q:R.UNKNOWN}(y.status);a(new D(S,y.message))}else a(new D(R.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new D(R.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{V(Je,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);V(Je,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",u,r,15)})}Bo(e,t,r){let i=ch(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=sh(),a=ih(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.xmlHttpFactory=new th({})),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;let d=s.join("");V(Je,`Creating RPC '${e}' stream ${i}: ${d}`,c);let p=o.createWebChannel(d,c),g=!1,y=!1,S=new Sd({Io:x=>{y?V(Je,`Not sending because RPC '${e}' stream ${i} is closed:`,x):(g||(V(Je,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),V(Je,`RPC '${e}' stream ${i} sending:`,x),p.send(x))},To:()=>p.close()}),k=(x,q,j)=>{x.listen(q,M=>{try{j(M)}catch(z){setTimeout(()=>{throw z},0)}})};return k(p,li.EventType.OPEN,()=>{y||(V(Je,`RPC '${e}' stream ${i} transport opened.`),S.yo())}),k(p,li.EventType.CLOSE,()=>{y||(y=!0,V(Je,`RPC '${e}' stream ${i} transport closed`),S.So())}),k(p,li.EventType.ERROR,x=>{y||(y=!0,Et(Je,`RPC '${e}' stream ${i} transport errored:`,x),S.So(new D(R.UNAVAILABLE,"The operation could not be completed")))}),k(p,li.EventType.MESSAGE,x=>{var q;if(!y){let j=x.data[0];G(!!j);let M=j,z=M.error||((q=M[0])===null||q===void 0?void 0:q.error);if(z){V(Je,`RPC '${e}' stream ${i} received error:`,z);let H=z.status,Y=function(w){let T=xe[w];if(T!==void 0)return bv(T)}(H),E=z.message;Y===void 0&&(Y=R.INTERNAL,E="Unknown error status: "+H+" with message "+z.message),y=!0,S.So(new D(Y,E)),p.close()}else V(Je,`RPC '${e}' stream ${i} received:`,j),S.bo(j)}}),k(a,rh.STAT_EVENT,x=>{x.stat===Qa.PROXY?V(Je,`RPC '${e}' stream ${i} detected buffering proxy`):x.stat===Qa.NOPROXY&&V(Je,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}};function tw(){return typeof window<"u"?window:null}function rl(){return typeof document<"u"?document:null}function xo(n){return new qh(n,!0)}var Eo=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Fl=class{constructor(e,t,r,i,s,o,a,c){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Eo(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return N(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return N(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return N(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(be(t.toString()),be("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new D(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>N(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},bd=class extends Fl{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=JS(this.serializer,e),r=function(s){if(!("targetChange"in s))return K.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?K.min():o.readTime?Pe(o.readTime):K.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=Kh(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=pl(c)?{documents:Ov(s,c)}:{query:Mv(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Pv(s,o.resumeToken);let u=jh(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(K.min())>0){a.readTime=Ri(s,o.snapshotVersion.toTimestamp());let u=jh(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=ZS(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=Kh(this.serializer),t.removeTarget=e,this.a_(t)}},Rd=class extends Fl{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=XS(e.writeResults,e.commitTime),r=Pe(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=Kh(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>_o(this.serializer,r))};this.a_(t)}};var Pd=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Gh(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(R.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Gh(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(R.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},kd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(be(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Nd=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>N(this,null,function*(){Zn(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return N(this,null,function*(){let u=L(c);u.L_.add(4),yield qi(u),u.q_.set("Unknown"),u.L_.delete(4),yield Do(u)})}(this))}))}),this.q_=new kd(r,i)}};function Do(n){return N(this,null,function*(){if(Zn(n))for(let e of n.B_)yield e(!0)})}function qi(n){return N(this,null,function*(){for(let e of n.B_)yield e(!1)})}function rc(n,e){let t=L(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Cf(t)?Sf(t):Gi(t).r_()&&Af(t,e))}function Di(n,e){let t=L(n),r=Gi(t);t.N_.delete(e),r.r_()&&nw(t,e),t.N_.size===0&&(r.r_()?r.o_():Zn(t)&&t.q_.set("Unknown"))}function Af(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Gi(n).A_(e)}function nw(n,e){n.Q_.xe(e),Gi(n).R_(e)}function Sf(n){n.Q_=new Bh({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Gi(n).start(),n.q_.v_()}function Cf(n){return Zn(n)&&!Gi(n).n_()&&n.N_.size>0}function Zn(n){return L(n).L_.size===0}function rw(n){n.Q_=void 0}function p0(n){return N(this,null,function*(){n.q_.set("Online")})}function g0(n){return N(this,null,function*(){n.N_.forEach((e,t)=>{Af(n,e)})})}function m0(n,e){return N(this,null,function*(){rw(n),Cf(n)?(n.q_.M_(e),Sf(n)):n.q_.set("Unknown")})}function _0(n,e,t){return N(this,null,function*(){if(n.q_.set("Online"),e instanceof yl&&e.state===2&&e.cause)try{yield function(i,s){return N(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ll(n,r)}else if(e instanceof Ei?n.Q_.Ke(e):e instanceof _l?n.Q_.He(e):n.Q_.We(e),!t.isEqual(K.min()))try{let r=yield Yv(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.N_.get(u);d&&s.N_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=s.N_.get(c);if(!d)return;s.N_.set(c,d.withResumeToken(ke.EMPTY_BYTE_STRING,d.snapshotVersion)),nw(s,c);let p=new Pi(d.target,c,u,d.sequenceNumber);Af(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield Ll(n,r)}})}function Ll(n,e,t){return N(this,null,function*(){if(!Xn(e))throw e;n.L_.add(1),yield qi(n),n.q_.set("Offline"),t||(t=()=>Yv(n.localStore)),n.asyncQueue.enqueueRetryable(()=>N(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield Do(n)}))})}function iw(n,e){return e().catch(t=>Ll(n,t,e))}function ji(n){return N(this,null,function*(){let e=L(n),t=Yn(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;y0(e);)try{let i=yield u0(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,v0(e,i)}catch(i){yield Ll(e,i)}sw(e)&&ow(e)})}function y0(n){return Zn(n)&&n.O_.length<10}function v0(n,e){n.O_.push(e);let t=Yn(n);t.r_()&&t.V_&&t.m_(e.mutations)}function sw(n){return Zn(n)&&!Yn(n).n_()&&n.O_.length>0}function ow(n){Yn(n).start()}function w0(n){return N(this,null,function*(){Yn(n).p_()})}function E0(n){return N(this,null,function*(){let e=Yn(n);for(let t of n.O_)e.m_(t.mutations)})}function T0(n,e,t){return N(this,null,function*(){let r=n.O_.shift(),i=Fh.from(r,e,t);yield iw(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ji(n)})}function I0(n,e){return N(this,null,function*(){e&&Yn(n).V_&&(yield function(r,i){return N(this,null,function*(){if(function(o){return Cv(o)&&o!==R.ABORTED}(i.code)){let s=r.O_.shift();Yn(r).s_(),yield iw(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield ji(r)}})}(n,e)),sw(n)&&ow(n)})}function xy(n,e){return N(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let r=Zn(t);t.L_.add(3),yield qi(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Do(t)})}function xd(n,e){return N(this,null,function*(){let t=L(n);e?(t.L_.delete(2),yield Do(t)):e||(t.L_.add(2),yield qi(t),t.q_.set("Unknown"))})}function Gi(n){return n.K_||(n.K_=function(t,r,i){let s=L(t);return s.w_(),new bd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:p0.bind(null,n),Ro:g0.bind(null,n),mo:m0.bind(null,n),d_:_0.bind(null,n)}),n.B_.push(e=>N(this,null,function*(){e?(n.K_.s_(),Cf(n)?Sf(n):n.q_.set("Unknown")):(yield n.K_.stop(),rw(n))}))),n.K_}function Yn(n){return n.U_||(n.U_=function(t,r,i){let s=L(t);return s.w_(),new Rd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:w0.bind(null,n),mo:I0.bind(null,n),f_:E0.bind(null,n),g_:T0.bind(null,n)}),n.B_.push(e=>N(this,null,function*(){e?(n.U_.s_(),yield ji(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var Dd=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Oe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ki(n,e){if(be("AsyncQueue",`${e}: ${n}`),Xn(n))return new D(R.UNAVAILABLE,`${e}: ${n}`);throw n}var Ul=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||U.comparator(t.key,r.key):(t,r)=>U.comparator(t.key,r.key),this.keyedMap=Js(),this.sortedSet=new _e(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Bl=class{constructor(){this.W_=new _e(U.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},Vi=class n{constructor(e,t,r,i,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Ul.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ko(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Vd=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Od=class{constructor(){this.queries=Dy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=L(t),s=i.queries;i.queries=Dy(),s.forEach((o,a)=>{for(let c of a.j_)c.onError(r)})})(this,new D(R.ABORTED,"Firestore shutting down"))}};function Dy(){return new Wt(n=>dv(n),ko)}function bf(n,e){return N(this,null,function*(){let t=L(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Vd,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Ki(o,`Initialization of query '${pi(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Pf(t)})}function Rf(n,e){return N(this,null,function*(){let t=L(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function A0(n,e){let t=L(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&Pf(t)}function S0(n,e,t){let r=L(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function Pf(n){n.Y_.forEach(e=>{e.next()})}var Md,Vy;(Vy=Md||(Md={})).ea="default",Vy.Cache="cache";var To=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Vi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Vi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Md.Cache}};var Fd=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var ql=class{constructor(e){this.serializer=e}Es(e){return jt(this.serializer,e)}ds(e){return e.metadata.exists?Vv(this.serializer,e.document,!1):Me.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Pe(e)}},Ld=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=aw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=se.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new ql(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}complete(){return N(this,null,function*(){let e=yield h0(this.localStore,new ql(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield d0(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function aw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var jl=class{constructor(e){this.key=e}},Gl=class{constructor(e){this.key=e}},Kl=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=pv(e),this.Ra=new Ul(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new Bl,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,p)=>{let g=i.get(d),y=No(this.query,p)?p:null,S=!!g&&this.mutatedKeys.has(g.key),k=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),x=!1;g&&y?g.data.isEqual(y.data)?S!==k&&(r.track({type:3,doc:y}),x=!0):this.ga(g,y)||(r.track({type:2,doc:y}),x=!0,(c&&this.Aa(y,c)>0||u&&this.Aa(y,u)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),x=!0):g&&!y&&(r.track({type:1,doc:g}),x=!0,(c||u)&&(a=!0)),x&&(y?(o=o.add(y),s=k?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,p)=>function(y,S){let k=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return k(y)-k(S)}(d.type,p.type)||this.Aa(d.doc,p.doc)),this.pa(r),i=i!=null&&i;let a=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new Vi(this.query,e.Ra,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Bl,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=X(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Gl(r))}),this.da.forEach(r=>{e.has(r)||t.push(new jl(r))}),t}ba(e){this.Ta=e.Ts,this.da=X();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Vi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Ud=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Bd=class{constructor(e){this.key=e,this.va=!1}},qd=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Wt(a=>dv(a),ko),this.Ma=new Map,this.xa=new Set,this.Oa=new _e(U.comparator),this.Na=new Map,this.La=new vo,this.Ba={},this.ka=new Map,this.qa=ki.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function C0(n,e,t=!0){return N(this,null,function*(){let r=ic(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield lw(r,e,t,!0),i})}function b0(n,e){return N(this,null,function*(){let t=ic(n);yield lw(t,e,!0,!1)})}function lw(n,e,t,r){return N(this,null,function*(){let i=yield Ni(n.localStore,rt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield kf(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&rc(n.remoteStore,i),a})}function kf(n,e,t,r,i){return N(this,null,function*(){n.Ka=(p,g,y)=>function(k,x,q,j){return N(this,null,function*(){let M=x.view.ma(q);M.ns&&(M=yield xl(k.localStore,x.query,!1).then(({documents:E})=>x.view.ma(E,M)));let z=j&&j.targetChanges.get(x.targetId),H=j&&j.targetMismatches.get(x.targetId)!=null,Y=x.view.applyChanges(M,k.isPrimaryClient,z,H);return jd(k,x.targetId,Y.wa),Y.snapshot})}(n,p,g,y);let s=yield xl(n.localStore,e,!0),o=new Kl(e,s.Ts),a=o.ma(s.documents),c=go.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,c);jd(n,t,u.wa);let d=new Ud(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot})}function R0(n,e,t){return N(this,null,function*(){let r=L(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!ko(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield xi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Di(r.remoteStore,i.targetId),Oi(r,i.targetId)}).catch(Jn))):(Oi(r,i.targetId),yield xi(r.localStore,i.targetId,!0))})}function P0(n,e){return N(this,null,function*(){let t=L(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Di(t.remoteStore,r.targetId))})}function k0(n,e,t){return N(this,null,function*(){let r=Vf(n);try{let i=yield function(o,a){let c=L(o),u=Ee.now(),d=a.reduce((y,S)=>y.add(S.key),X()),p,g;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let S=ct(),k=X();return c.cs.getEntries(y,d).next(x=>{S=x,S.forEach((q,j)=>{j.isValidDocument()||(k=k.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,S)).next(x=>{p=x;let q=[];for(let j of a){let M=KS(j,p.get(j.key).overlayedDocument);M!=null&&q.push(new Nt(j.key,M,sv(M.value.mapValue),Se.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,q,a)}).next(x=>{g=x;let q=x.applyToLocalDocumentSet(p,k);return c.documentOverlayCache.saveOverlays(y,x.batchId,q)})}).then(()=>({batchId:g.batchId,changes:mv(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Ba[o.currentUser.toKey()];u||(u=new _e(Q)),u=u.insert(a,c),o.Ba[o.currentUser.toKey()]=u}(r,i.batchId,t),yield gn(r,i.changes),yield ji(r.remoteStore)}catch(i){let s=Ki(i,"Failed to persist write");t.reject(s)}})}function cw(n,e){return N(this,null,function*(){let t=L(n);try{let r=yield c0(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?G(o.va):i.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield gn(t,r,e)}catch(r){yield Jn(r)}})}function Oy(n,e,t){let r=L(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=L(o);c.onlineState=a;let u=!1;c.queries.forEach((d,p)=>{for(let g of p.j_)g.Z_(a)&&(u=!0)}),u&&Pf(c)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function N0(n,e,t){return N(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new _e(U.comparator);o=o.insert(s,Me.newNoDocument(s,K.min()));let a=X().add(s),c=new po(K.min(),new Map,new _e(Q),o,a);yield cw(r,c),r.Oa=r.Oa.remove(s),r.Na.delete(e),Df(r)}else yield xi(r.localStore,e,!1).then(()=>Oi(r,e,t)).catch(Jn)})}function x0(n,e){return N(this,null,function*(){let t=L(n),r=e.batch.batchId;try{let i=yield l0(t.localStore,e);xf(t,r,null),Nf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield gn(t,i)}catch(i){yield Jn(i)}})}function D0(n,e,t){return N(this,null,function*(){let r=L(n);try{let i=yield function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(p=>(G(p!==null),d=p.keys(),c.mutationQueue.removeMutationBatch(u,p))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(r.localStore,e);xf(r,e,t),Nf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield gn(r,i)}catch(i){yield Jn(i)}})}function V0(n,e){return N(this,null,function*(){let t=L(n);Zn(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=Ki(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Nf(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function xf(n,e,t){let r=L(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Oi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||uw(n,r)})}function uw(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(Di(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Df(n))}function jd(n,e,t){for(let r of t)r instanceof jl?(n.La.addReference(r.key,e),O0(n,r)):r instanceof Gl?(V("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||uw(n,r.key)):B()}function O0(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(r),Df(n))}function Df(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new U(se.fromString(e)),r=n.qa.next();n.Na.set(r,new Bd(t)),n.Oa=n.Oa.insert(t,r),rc(n.remoteStore,new Pi(rt(Bi(t.path)),r,"TargetPurposeLimboResolution",dt.oe))}}function gn(n,e,t){return N(this,null,function*(){let r=L(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,c)=>{o.push(r.Ka(c,e,t).then(u=>{var d;if((u||t)&&r.isPrimaryClient){let p=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(u){i.push(u);let p=wd.Wi(c.targetId,u);s.push(p)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(c,u){return N(this,null,function*(){let d=L(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(u,g=>b.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(p,g.targetId,y)).next(()=>b.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(p,g.targetId,y)))))}catch(p){if(!Xn(p))throw p;V("LocalStore","Failed to update sequence numbers: "+p)}for(let p of u){let g=p.targetId;if(!p.fromCache){let y=d.os.get(g),S=y.snapshotVersion,k=y.withLastLimboFreeSnapshotVersion(S);d.os=d.os.insert(g,k)}}})}(r.localStore,s))})}function M0(n,e){return N(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let r=yield Hv(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(c=>{c.reject(new D(R.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield gn(t,r.hs)}})}function F0(n,e){let t=L(n),r=t.Na.get(e);if(r&&r.va)return X().add(r.key);{let i=X(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function L0(n,e){return N(this,null,function*(){let t=L(n),r=yield xl(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&jd(t,e.targetId,i.wa),i})}function U0(n,e){return N(this,null,function*(){let t=L(n);return Zv(t.localStore,e).then(r=>gn(t,r))})}function B0(n,e,t,r){return N(this,null,function*(){let i=L(n),s=yield function(a,c){let u=L(a),d=L(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",p=>d.Mn(p,c).next(g=>g?u.localDocuments.getDocuments(p,g):b.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield ji(i.remoteStore):t==="acknowledged"||t==="rejected"?(xf(i,e,r||null),Nf(i,e),function(a,c){L(L(a).mutationQueue).On(c)}(i.localStore,e)):B(),yield gn(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function q0(n,e){return N(this,null,function*(){let t=L(n);if(ic(t),Vf(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield My(t,r.toArray());t.Qa=!0,yield xd(t.remoteStore,!0);for(let s of i)rc(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Oi(t,o),xi(t.localStore,o,!0))),Di(t.remoteStore,o)}),yield i,yield My(t,r),function(o){let a=L(o);a.Na.forEach((c,u)=>{Di(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new _e(U.comparator)}(t),t.Qa=!1,yield xd(t.remoteStore,!1)}})}function My(n,e,t){return N(this,null,function*(){let r=L(n),i=[],s=[];for(let o of e){let a,c=r.Ma.get(o);if(c&&c.length!==0){a=yield Ni(r.localStore,rt(c[0]));for(let u of c){let d=r.Fa.get(u),p=yield L0(r,d);p.snapshot&&s.push(p.snapshot)}}else{let u=yield Xv(r.localStore,o);a=yield Ni(r.localStore,u),yield kf(r,hw(u),o,!1,a.resumeToken)}i.push(a)}return r.Ca.d_(s),i})}function hw(n){return hv(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function j0(n){return function(t){return L(L(t).persistence).Qi()}(L(n).localStore)}function G0(n,e,t,r){return N(this,null,function*(){let i=L(n);if(i.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Zv(i.localStore,fv(s[0])),a=po.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ke.EMPTY_BYTE_STRING);yield gn(i,o,a);break}case"rejected":yield xi(i.localStore,e,!0),Oi(i,e,r);break;default:B()}})}function K0(n,e,t){return N(this,null,function*(){let r=ic(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V("SyncEngine","Adding an already active target "+i);continue}let s=yield Xv(r.localStore,i),o=yield Ni(r.localStore,s);yield kf(r,hw(s),o.targetId,!1,o.resumeToken),rc(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield xi(r.localStore,i,!1).then(()=>{Di(r.remoteStore,i),Oi(r,i)}).catch(Jn))}})}function ic(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=cw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=F0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=N0.bind(null,e),e.Ca.d_=A0.bind(null,e.eventManager),e.Ca.$a=S0.bind(null,e.eventManager),e}function Vf(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=x0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=D0.bind(null,e),e}function z0(n,e,t){let r=L(n);(function(s,o,a){return N(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(y,S){let k=L(y),x=Pe(S.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",q=>k.Gr.getBundleMetadata(q,S.id)).then(q=>!!q&&q.createTime.compareTo(x)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(aw(c));let u=new Ld(c,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let g=yield u.la(d);g&&a._updateProgress(g),d=yield o.Ua()}let p=yield u.complete();return yield gn(s,p.Ia,void 0),yield function(y,S){let k=L(y);return k.persistence.runTransaction("Save bundle","readwrite",x=>k.Gr.saveBundleMetadata(x,S))}(s.localStore,c),a._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return Et("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Io=class{constructor(){this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){this.serializer=xo(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Qv(this.persistence,new Nl,e.initialUser,this.serializer)}createPersistence(e){return new Pl(kl.Zr,this.serializer)}createSharedClientState(e){return new Ol}terminate(){return N(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var zl=class n extends Io{constructor(e,t,r){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){yield Vu(n.prototype,this,"initialize").call(this,e),yield this.Wa.initialize(this,e),yield Vf(this.Wa.syncEngine),yield ji(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return Qv(this.persistence,new Nl,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new id(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Eh(t,this.persistence);return new wh(e.asyncQueue,r)}createPersistence(e){let t=If(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?wt.withCacheSize(this.cacheSizeBytes):wt.DEFAULT;return new vd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,tw(),rl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ol}},Gd=class n extends zl{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return N(this,null,function*(){yield Vu(n.prototype,this,"initialize").call(this,e);let t=this.Wa.syncEngine;this.sharedClientState instanceof ro&&(this.sharedClientState.syncEngine={no:B0.bind(null,t),ro:G0.bind(null,t),io:K0.bind(null,t),Qi:j0.bind(null,t),eo:U0.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>N(this,null,function*(){yield q0(this.Wa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=tw();if(!ro.D(t))throw new D(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=If(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ro(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Ao=class{initialize(e,t){return N(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Oy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=M0.bind(null,this.syncEngine),yield xd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Od}()}createDatastore(e){let t=xo(e.databaseInfo.databaseId),r=function(s){return new Cd(s)}(e.databaseInfo);return function(s,o,a,c){return new Pd(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Nd(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Oy(this.syncEngine,t,0),function(){return Ml.D()?new Ml:new Ad}())}createSyncEngine(e,t){return function(i,s,o,a,c,u,d){let p=new qd(i,s,o,a,c,u);return d&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return N(this,null,function*(){var e,t;yield function(i){return N(this,null,function*(){let s=L(i);V("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield qi(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};function Fy(n,e=10240){let t=0;return{read(){return N(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return N(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Mi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):be("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Kd=class{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Oe,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.ja.cancel()}getMetadata(){return N(this,null,function*(){return this.metadata.promise})}Ua(){return N(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return N(this,null,function*(){let e=yield this.Ya();if(e===null)return null;let t=this.Ha.decode(e),r=Number(t);isNaN(r)&&this.Za(`length string (${t}) is not valid number`);let i=yield this.Xa(r);return new Fd(JSON.parse(i),e.length+r)})}eu(){return this.buffer.findIndex(e=>e===123)}Ya(){return N(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let e=this.eu();e<0&&this.Za("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Xa(e){return N(this,null,function*(){for(;this.buffer.length<e;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let t=this.Ha.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){return N(this,null,function*(){let e=yield this.ja.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var zd=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return N(this,null,function*(){let o=L(i),a={documents:s.map(p=>mo(o.serializer,p))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,se.emptyPath(),a,s.length),u=new Map;c.forEach(p=>{let g=YS(o.serializer,p);u.set(g.key.toString(),g)});let d=[];return s.forEach(p=>{let g=u.get(p.toString());G(!!g),d.push(g)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Hn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new uo(i,this.precondition(i)))}),yield function(r,i){return N(this,null,function*(){let s=L(r),o={writes:i.map(a=>_o(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,se.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=K.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Se.exists(!1):Se.updateTime(t):Se.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new D(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Se.updateTime(t)}return Se.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Wd=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.nu=r.maxAttempts,this.t_=new Eo(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>N(this,null,function*(){let e=new zd(this.datastore),t=this.su(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ou(i)}))}).catch(r=>{this.ou(r)})}))}su(e){try{let t=this.updateFunction(e);return!Ro(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Cv(t)}return!1}};var $d=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ve.UNAUTHENTICATED,this.clientId=ol.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>N(this,null,function*(){V("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(V("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Oe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ki(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function il(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>N(this,null,function*(){r.isEqual(i)||(yield Hv(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Qd(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Of(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>xy(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>xy(e.remoteStore,i)),n._onlineComponents=e})}function dw(n){return n.name==="FirebaseError"?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Of(n){return N(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield il(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!dw(t))throw t;Et("Error using user provided cache. Falling back to memory cache: "+t),yield il(n,new Io)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield il(n,new Io);return n._offlineComponents})}function sc(n){return N(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield Qd(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield Qd(n,new Ao))),n._onlineComponents})}function fw(n){return Of(n).then(e=>e.persistence)}function Mf(n){return Of(n).then(e=>e.localStore)}function pw(n){return sc(n).then(e=>e.remoteStore)}function Ff(n){return sc(n).then(e=>e.syncEngine)}function W0(n){return sc(n).then(e=>e.datastore)}function Fi(n){return N(this,null,function*(){let e=yield sc(n),t=e.eventManager;return t.onListen=C0.bind(null,e.syncEngine),t.onUnlisten=R0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=b0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=P0.bind(null,e.syncEngine),t})}function $0(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield fw(n),t=yield pw(n);return e.setNetworkEnabled(!0),function(i){let s=L(i);return s.L_.delete(0),Do(s)}(t)}))}function Q0(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield fw(n),t=yield pw(n);return e.setNetworkEnabled(!1),function(i){return N(this,null,function*(){let s=L(i);s.L_.add(0),yield qi(s),s.q_.set("Offline")})}(t)}))}function H0(n,e){let t=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s,o){return N(this,null,function*(){try{let a=yield function(u,d){let p=L(u);return p.persistence.runTransaction("read document","readonly",g=>p.localDocuments.getDocument(g,d))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=Ki(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield Mf(n),e,t)})),t.promise}function gw(n,e,t={}){let r=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,c,u){let d=new Mi({next:g=>{o.enqueueAndForget(()=>Rf(s,p));let y=g.docs.has(a);!y&&g.fromCache?u.reject(new D(R.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&c&&c.source==="server"?u.reject(new D(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),p=new To(Bi(a.path),d,{includeMetadataChanges:!0,_a:!0});return bf(s,p)}(yield Fi(n),n.asyncQueue,e,t,r)})),r.promise}function Y0(n,e){let t=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s,o){return N(this,null,function*(){try{let a=yield xl(i,s,!0),c=new Kl(s,a.Ts),u=c.ma(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=Ki(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield Mf(n),e,t)})),t.promise}function mw(n,e,t={}){let r=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,c,u){let d=new Mi({next:g=>{o.enqueueAndForget(()=>Rf(s,p)),g.fromCache&&c.source==="server"?u.reject(new D(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),p=new To(a,d,{includeMetadataChanges:!0,_a:!0});return bf(s,p)}(yield Fi(n),n.asyncQueue,e,t,r)})),r.promise}function J0(n,e){let t=new Mi(e);return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s){L(i).Y_.add(s),s.next()}(yield Fi(n),t)})),()=>{t.za(),n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s){L(i).Y_.delete(s)}(yield Fi(n),t)}))}}function X0(n,e,t,r){let i=function(o,a){let c;return c=typeof o=="string"?Rv().encode(o):o,function(d,p){return new Kd(d,p)}(function(d,p){if(d instanceof Uint8Array)return Fy(d,p);if(d instanceof ArrayBuffer)return Fy(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,xo(e));n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){z0(yield Ff(n),i,r)}))}function Z0(n,e){return n.asyncQueue.enqueue(()=>N(this,null,function*(){return function(r,i){let s=L(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield Mf(n),e)}))}function _w(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Ly=new Map;function Lf(n,e,t){if(!t)throw new D(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Uf(n,e,t,r){if(e===!0&&r===!0)throw new D(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Uy(n){if(!U.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function By(n){if(U.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function oc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B()}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=oc(n);throw new D(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function yw(n,e){if(e<=0)throw new D(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Wl=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new D(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Uf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_w((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},xr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new D(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wl(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new uh;switch(r.type){case"firstParty":return new ph(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Ly.get(t);r&&(V("ComponentProvider","Removing Datastore"),Ly.delete(t),r.terminate())}(this),Promise.resolve()}};function vw(n,e,t,r={}){var i;let s=(n=oe(n,xr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Et("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Ve.MOCK_USER;else{a=Fa(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new D(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ve(u)}n._authCredentials=new hh(new sl(a,c))}}var We=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},pe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Gt=class n extends We{constructor(e,t,r){super(e,t,Bi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Bf(n,e,...t){if(n=ne(n),Lf("collection","path",e),n instanceof xr){let r=se.fromString(e,...t);return By(r),new Gt(n,null,r)}{if(!(n instanceof pe||n instanceof Gt))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return By(r),new Gt(n.firestore,null,r)}}function ww(n,e){if(n=oe(n,xr),Lf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new We(n,null,function(r){return new kt(se.emptyPath(),r)}(e))}function Vo(n,e,...t){if(n=ne(n),arguments.length===1&&(e=ol.newId()),Lf("doc","path",e),n instanceof xr){let r=se.fromString(e,...t);return Uy(r),new pe(n,null,new U(r))}{if(!(n instanceof pe||n instanceof Gt))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return Uy(r),new pe(n.firestore,n instanceof Gt?n.converter:null,new U(r))}}function qf(n,e){return n=ne(n),e=ne(e),(n instanceof pe||n instanceof Gt)&&(e instanceof pe||e instanceof Gt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function jf(n,e){return n=ne(n),e=ne(e),n instanceof We&&e instanceof We&&n.firestore===e.firestore&&ko(n._query,e._query)&&n.converter===e.converter}var Hd=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Eo(this,"async_queue_retry"),this.Eu=()=>{let t=rl();t&&V("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=rl();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=rl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new Oe;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return N(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Xn(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(r=>{this.hu=r,this.Pu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Pu=!1,r))));return this.au=t,t}enqueueAfterDelay(e,t,r){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=Dd.createAndSchedule(this,e,t,r,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&B()}verifyOperationInProgress(){}mu(){return N(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function Yd(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Jd=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Oe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var Ew=-1,ve=class extends xr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Hd}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Tw(this),this._firestoreClient.terminate()}};function Be(n){return n._firestoreClient||Tw(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Tw(n){var e,t,r;let i=n._freezeSettings(),s=function(a,c,u,d){return new Th(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,_w(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new $d(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Iw(n,e){xw(n=oe(n,ve));let t=Be(n);if(t._uninitializedComponentsProvider)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");Et("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Ao;return Sw(t,i,new zl(i,r.cacheSizeBytes,e?.forceOwnership))}function Aw(n){xw(n=oe(n,ve));let e=Be(n);if(e._uninitializedComponentsProvider)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");Et("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Ao;return Sw(e,r,new Gd(r,t.cacheSizeBytes))}function Sw(n,e,t){let r=new Oe;return n.asyncQueue.enqueue(()=>N(this,null,function*(){try{yield il(n,t),yield Qd(n,e),r.resolve()}catch(i){let s=i;if(!dw(s))throw s;Et("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Cw(n){if(n._initialized&&!n._terminated)throw new D(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Oe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{yield function(r){return N(this,null,function*(){if(!jn.D())return Promise.resolve();let i=r+"main";yield jn.delete(i)})}(If(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function bw(n){return function(t){let r=new Oe;return t.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return V0(yield Ff(t),r)})),r.promise}(Be(n=oe(n,ve)))}function Rw(n){return $0(Be(n=oe(n,ve)))}function Pw(n){return Q0(Be(n=oe(n,ve)))}function kw(n,e){let t=Be(n=oe(n,ve)),r=new Jd;return X0(t,n._databaseId,e,r),r}function Nw(n,e){return Z0(Be(n=oe(n,ve)),e).then(t=>t?new We(n,null,t.query):null)}function xw(n){if(n._initialized||n._terminated)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var $t=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ke.fromBase64String(e))}catch(t){throw new D(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var xt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var fn=class{constructor(e){this._methodName=e}};var Dr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var So=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var eC=/^__.*__$/,Xd=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Nt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qn(e,this.data,t,this.fieldTransforms)}},$l=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Nt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Dw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var Ql=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.vu(e),i}Cu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return Hl(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(Dw(this.wu)&&eC.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},Zd=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||xo(e)}Nu(e,t,r,i=!1){return new Ql({wu:e,methodName:t,Ou:r,path:Re.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Fr(n){let e=n._freezeSettings(),t=xo(n._databaseId);return new Zd(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ac(n,e,t,r,i,s={}){let o=n.Nu(s.merge||s.mergeFields?2:0,e,t,i);zf("Data must be an object, but it was:",o,r);let a=Mw(r,o),c,u;if(s.merge)c=new ft(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let p of s.mergeFields){let g=sf(e,p,t);if(!o.contains(g))throw new D(R.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Lw(d,g)||d.push(g)}c=new ft(d),u=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,u=o.fieldTransforms;return new Xd(new Xe(a),c,u)}var Co=class n extends fn{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Vw(n,e,t){return new Ql({wu:3,Ou:e.settings.Ou,methodName:n._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var ef=class n extends fn{_toFieldTransform(e){return new Pr(e.path,new Wn)}isEqual(e){return e instanceof n}},tf=class n extends fn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=Vw(this,e,!0),r=this.Lu.map(s=>Lr(s,t)),i=new hn(r);return new Pr(e.path,i)}isEqual(e){return e instanceof n&&Bu(this.Lu,e.Lu)}},nf=class n extends fn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=Vw(this,e,!0),r=this.Lu.map(s=>Lr(s,t)),i=new dn(r);return new Pr(e.path,i)}isEqual(e){return e instanceof n&&Bu(this.Lu,e.Lu)}},rf=class n extends fn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){let t=new $n(e.serializer,vv(e.serializer,this.Bu));return new Pr(e.path,t)}isEqual(e){return e instanceof n&&this.Bu===e.Bu}};function Gf(n,e,t,r){let i=n.Nu(1,e,t);zf("Data must be an object, but it was:",i,r);let s=[],o=Xe.empty();Mr(r,(c,u)=>{let d=Wf(e,c,t);u=ne(u);let p=i.Cu(d);if(u instanceof Co)s.push(d);else{let g=Lr(u,p);g!=null&&(s.push(d),o.set(d,g))}});let a=new ft(s);return new $l(o,a,i.fieldTransforms)}function Kf(n,e,t,r,i,s){let o=n.Nu(1,e,t),a=[sf(e,r,t)],c=[i];if(s.length%2!=0)throw new D(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(sf(e,s[g])),c.push(s[g+1]);let u=[],d=Xe.empty();for(let g=a.length-1;g>=0;--g)if(!Lw(u,a[g])){let y=a[g],S=c[g];S=ne(S);let k=o.Cu(y);if(S instanceof Co)u.push(y);else{let x=Lr(S,k);x!=null&&(u.push(y),d.set(y,x))}}let p=new ft(u);return new $l(d,p,o.fieldTransforms)}function Ow(n,e,t,r=!1){return Lr(t,n.Nu(r?4:3,e))}function Lr(n,e){if(Fw(n=ne(n)))return zf("Unsupported field value:",e,n),Mw(n,e);if(n instanceof fn)return function(r,i){if(!Dw(i.wu))throw i.Mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=Lr(a,i.Fu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Ee.fromDate(r);return{timestampValue:Ri(i.serializer,s)}}if(r instanceof Ee){let s=new Ee(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ri(i.serializer,s)}}if(r instanceof Dr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $t)return{bytesValue:Pv(i.serializer,r._byteString)};if(r instanceof pe){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:wf(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof So)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Mu("VectorValues must only contain numeric values.");return vf(a.serializer,c)})}}}}}}(r,i);throw i.Mu(`Unsupported field value: ${oc(r)}`)}(n,e)}function Mw(n,e){let t={};return tv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mr(n,(r,i)=>{let s=Lr(i,e.bu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Fw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ee||n instanceof Dr||n instanceof $t||n instanceof pe||n instanceof fn||n instanceof So)}function zf(n,e,t){if(!Fw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=oc(t);throw r==="an object"?e.Mu(n+" a custom object"):e.Mu(n+" "+r)}}function sf(n,e,t){if((e=ne(e))instanceof xt)return e._internalPath;if(typeof e=="string")return Wf(n,e);throw Hl("Field path arguments must be of type string or ",n,!1,void 0,t)}var tC=new RegExp("[~\\*/\\[\\]]");function Wf(n,e,t){if(e.search(tC)>=0)throw Hl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new xt(...e.split("."))._internalPath}catch{throw Hl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Hl(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new D(R.INVALID_ARGUMENT,a+n+c)}function Lw(n,e){return n.some(t=>t.isEqual(e))}var Vr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new of(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(lc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},of=class extends Vr{data(){return super.data()}};function lc(n,e){return typeof e=="string"?Wf(n,e):e instanceof xt?e._internalPath:e._delegate._internalPath}function Uw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bo=class{},Or=class extends bo{};function mn(n,e,...t){let r=[];e instanceof bo&&r.push(e),r=r.concat(t),function(s){let o=s.filter(c=>c instanceof af).length,a=s.filter(c=>c instanceof Yl).length;if(o>1||o>0&&a>0)throw new D(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Yl=class n extends Or{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Hw(e._query,t),new We(e.firestore,e.converter,Oh(e._query,t))}_parse(e){let t=Fr(e.firestore);return function(s,o,a,c,u,d,p){let g;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){jy(p,d);let y=[];for(let S of p)y.push(qy(c,s,S));g={arrayValue:{values:y}}}else g=qy(c,s,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||jy(p,d),g=Ow(a,o,p,d==="in"||d==="not-in");return re.create(u,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Bw(n,e,t){let r=e,i=lc("where",n);return Yl._create(i,r,t)}var af=class n extends bo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)Hw(o,c),o=Oh(o,c)}(e._query,t),new We(e.firestore,e.converter,Oh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var lf=class n extends Or{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new br(s,o)}(e._query,this._field,this._direction);return new We(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new kt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function qw(n,e="asc"){let t=e,r=lc("orderBy",n);return lf._create(r,t)}var Jl=class n extends Or{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new We(e.firestore,e.converter,ml(e._query,this._limit,this._limitType))}};function jw(n){return yw("limit",n),Jl._create("limit",n,"F")}function Gw(n){return yw("limitToLast",n),Jl._create("limitToLast",n,"L")}var Xl=class n extends Or{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Qw(e,this.type,this._docOrFields,this._inclusive);return new We(e.firestore,e.converter,function(i,s){return new kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Kw(...n){return Xl._create("startAt",n,!0)}function zw(...n){return Xl._create("startAfter",n,!1)}var Zl=class n extends Or{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Qw(e,this.type,this._docOrFields,this._inclusive);return new We(e.firestore,e.converter,function(i,s){return new kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Ww(...n){return Zl._create("endBefore",n,!1)}function $w(...n){return Zl._create("endAt",n,!0)}function Qw(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof Vr)return function(s,o,a,c,u){if(!c)throw new D(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let p of wi(s))if(p.field.isKeyField())d.push(Cr(o,c.key));else{let g=c.data.field(p.field);if(tc(g))throw new D(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let y=p.field.canonicalString();throw new D(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new zt(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Fr(n.firestore);return function(o,a,c,u,d,p){let g=o.explicitOrderBy;if(d.length>g.length)throw new D(R.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let S=0;S<d.length;S++){let k=d[S];if(g[S].field.isKeyField()){if(typeof k!="string")throw new D(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof k}`);if(!_f(o)&&k.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${k}' contains a slash.`);let x=o.path.child(se.fromString(k));if(!U.isDocumentKey(x))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);let q=new U(x);y.push(Cr(a,q))}else{let x=Ow(c,u,k);y.push(x)}}return new zt(y,p)}(n._query,n.firestore._databaseId,i,e,t,r)}}function qy(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new D(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!_f(e)&&t.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(se.fromString(t));if(!U.isDocumentKey(r))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Cr(n,new U(r))}if(t instanceof pe)return Cr(n,t._key);throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${oc(t)}.`)}function jy(n,e){if(!Array.isArray(n)||n.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Hw(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Li=class{convertValue(e,t="none"){switch(Sr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ye(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Gn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Mr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ye(o.doubleValue));return new So(s)}convertGeoPoint(e){return new Dr(ye(e.latitude),ye(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=gf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ao(e));default:return null}}convertTimestamp(e){let t=un(e);return new Ee(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=se.fromString(e);G(Bv(r));let i=new Kn(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function cc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var cf=class extends Li{constructor(e){super(),this.firestore=e}convertBytes(e){return new $t(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};var cn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},It=class extends Vr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Bn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(lc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Bn=class extends It{data(e={}){return super.data(e)}},Dt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new cn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Bn(this._firestore,this._userDataWriter,r.key,r,new cn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new Bn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new cn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Bn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new cn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:nC(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function nC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function $f(n,e){return n instanceof It&&e instanceof It?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Dt&&e instanceof Dt&&n._firestore===e._firestore&&jf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Yw(n){n=oe(n,pe);let e=oe(n.firestore,ve);return gw(Be(e),n._key).then(t=>Jf(e,n,t))}var pn=class extends Li{constructor(e){super(),this.firestore=e}convertBytes(e){return new $t(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};function Jw(n){n=oe(n,pe);let e=oe(n.firestore,ve),t=Be(e),r=new pn(e);return H0(t,n._key).then(i=>new It(e,r,n._key,i,new cn(i!==null&&i.hasLocalMutations,!0),n.converter))}function Xw(n){n=oe(n,pe);let e=oe(n.firestore,ve);return gw(Be(e),n._key,{source:"server"}).then(t=>Jf(e,n,t))}function Zw(n){n=oe(n,We);let e=oe(n.firestore,ve),t=Be(e),r=new pn(e);return Uw(n._query),mw(t,n._query).then(i=>new Dt(e,r,n,i))}function eE(n){n=oe(n,We);let e=oe(n.firestore,ve),t=Be(e),r=new pn(e);return Y0(t,n._query).then(i=>new Dt(e,r,n,i))}function tE(n){n=oe(n,We);let e=oe(n.firestore,ve),t=Be(e),r=new pn(e);return mw(t,n._query,{source:"server"}).then(i=>new Dt(e,r,n,i))}function Qf(n,e,t){n=oe(n,pe);let r=oe(n.firestore,ve),i=cc(n.converter,e,t);return zi(r,[ac(Fr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Se.none())])}function Hf(n,e,t,...r){n=oe(n,pe);let i=oe(n.firestore,ve),s=Fr(i),o;return o=typeof(e=ne(e))=="string"||e instanceof xt?Kf(s,"updateDoc",n._key,e,t,r):Gf(s,"updateDoc",n._key,e),zi(i,[o.toMutation(n._key,Se.exists(!0))])}function nE(n){return zi(oe(n.firestore,ve),[new Hn(n._key,Se.none())])}function rE(n,e){let t=oe(n.firestore,ve),r=Vo(n),i=cc(n.converter,e);return zi(t,[ac(Fr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Se.exists(!1))]).then(()=>r)}function Yf(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Yd(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Yd(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let c,u,d;if(n instanceof pe)u=oe(n.firestore,ve),d=Bi(n._key.path),c={next:p=>{e[o]&&e[o](Jf(u,n,p))},error:e[o+1],complete:e[o+2]};else{let p=oe(n,We);u=oe(p.firestore,ve),d=p._query;let g=new pn(u);c={next:y=>{e[o]&&e[o](new Dt(u,g,p,y))},error:e[o+1],complete:e[o+2]},Uw(n._query)}return function(g,y,S,k){let x=new Mi(k),q=new To(y,x,S);return g.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return bf(yield Fi(g),q)})),()=>{x.za(),g.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return Rf(yield Fi(g),q)}))}}(Be(u),d,a,c)}function iE(n,e){return J0(Be(n=oe(n,ve)),Yd(e)?e:{next:e})}function zi(n,e){return function(r,i){let s=new Oe;return r.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return k0(yield Ff(r),i,s)})),s.promise}(Be(n),e)}function Jf(n,e,t){let r=t.docs.get(e._key),i=new pn(n);return new It(n,i,e._key,r,new cn(t.hasPendingWrites,t.fromCache),e.converter)}var rC={maxAttempts:5};var ec=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Fr(e)}set(e,t,r){this._verifyNotCommitted();let i=Ln(e,this._firestore),s=cc(i.converter,t,r),o=ac(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Se.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Ln(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof xt?Kf(this._dataReader,"WriteBatch.update",s._key,t,r,i):Gf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Se.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ln(e,this._firestore);return this._mutations=this._mutations.concat(new Hn(t._key,Se.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ln(n,e){if((n=ne(n)).firestore!==e)throw new D(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var uf=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Fr(t)}get(t){let r=Ln(t,this._firestore),i=new cf(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return B();let o=s[0];if(o.isFoundDocument())return new Vr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Vr(this._firestore,i,r._key,null,r.converter);throw B()})}set(t,r,i){let s=Ln(t,this._firestore),o=cc(s.converter,r,i),a=ac(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Ln(t,this._firestore),a;return a=typeof(r=ne(r))=="string"||r instanceof xt?Kf(this._dataReader,"Transaction.update",o._key,r,i,s):Gf(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Ln(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ln(e,this._firestore),r=new pn(this._firestore);return super.get(e).then(i=>new It(this._firestore,r,t._key,i._document,new cn(!1,!1),t.converter))}};function sE(n,e,t){n=oe(n,ve);let r=Object.assign(Object.assign({},rC),t);return function(s){if(s.maxAttempts<1)throw new D(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let c=new Oe;return s.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){let u=yield W0(s);new Wd(s.asyncQueue,u,a,o,c).ru()})),c.promise}(Be(n),i=>e(new uf(n,i)),r)}function oE(){return new Co("deleteField")}function aE(){return new ef("serverTimestamp")}function lE(...n){return new tf("arrayUnion",n)}function cE(...n){return new nf("arrayRemove",n)}function uE(n){return new rf("increment",n)}(function(e,t=!0){(function(i){Ui=i})(ja),gr(new ht("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new ve(new dh(r.getProvider("auth-internal")),new mh(r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new D(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Kn(u.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Rt(q_,"4.7.2",e),Rt(q_,"4.7.2","esm2017")})();var iC="@firebase/firestore-compat",sC="0.3.37";function rp(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function hE(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function dE(){if(!nv())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var uc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return dE(),new n($t.fromBase64String(e))}static fromUint8Array(e){return hE(),new n($t.fromUint8Array(e))}toBase64(){return dE(),this._delegate.toBase64()}toUint8Array(){return hE(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Xf(n){return oC(n,["next","error","complete"])}function oC(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Zf=class{enableIndexedDbPersistence(e,t){return Iw(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Aw(e._delegate)}clearIndexedDbPersistence(e){return Cw(e._delegate)}},hc=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Kn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Et("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){vw(this._delegate,e,t,r)}enableNetwork(){return Rw(this._delegate)}disableNetwork(){return Pw(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Uf("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return bw(this._delegate)}onSnapshotsInSync(e){return iE(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Qi(this,Bf(this._delegate,e))}catch(t){throw it(t,"collection()","Firestore.collection()")}}doc(e){try{return new Qt(this,Vo(this._delegate,e))}catch(t){throw it(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new jr(this,ww(this._delegate,e))}catch(t){throw it(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return sE(this._delegate,t=>e(new dc(this,t)))}batch(){return Be(this._delegate),new fc(new ec(this._delegate,e=>zi(this._delegate,e)))}loadBundle(e){return kw(this._delegate,e)}namedQuery(e){return Nw(this._delegate,e).then(t=>t?new jr(this,t):null)}},Wi=class extends Li{constructor(e){super(),this.firestore=e}convertBytes(e){return new uc(new $t(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Qt.forKey(t,this.firestore,null)}};function aC(n){Gy(n)}var dc=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Wi(e)}get(e){let t=Ur(e);return this._delegate.get(t).then(r=>new Br(this._firestore,new It(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Ur(e);return r?(rp("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ur(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ur(e);return this._delegate.delete(t),this}},fc=class{constructor(e){this._delegate=e}set(e,t,r){let i=Ur(e);return r?(rp("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ur(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ur(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},$i=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Bn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Wi(e),t),i.set(t,s)),s}};$i.INSTANCES=new WeakMap;var Qt=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Wi(e)}static forPath(e,t,r){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new pe(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new pe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Qi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Qi(this.firestore,Bf(this._delegate,e))}catch(t){throw it(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof pe?qf(this._delegate,e):!1}set(e,t){t=rp("DocumentReference.set",t);try{return t?Qf(this._delegate,e,t):Qf(this._delegate,e)}catch(r){throw it(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Hf(this._delegate,e):Hf(this._delegate,e,t,...r)}catch(i){throw it(i,"updateDoc()","DocumentReference.update()")}}delete(){return nE(this._delegate)}onSnapshot(...e){let t=fE(e),r=pE(e,i=>new Br(this.firestore,new It(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Yf(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=Jw(this._delegate):e?.source==="server"?t=Xw(this._delegate):t=Yw(this._delegate),t.then(r=>new Br(this.firestore,new It(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter($i.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function it(n,e,t){return n.message=n.message.replace(e,t),n}function fE(n){for(let e of n)if(typeof e=="object"&&!Xf(e))return e;return{}}function pE(n,e){var t,r;let i;return Xf(n[0])?i=n[0]:Xf(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Br=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Qt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return $f(this._delegate,e._delegate)}},qr=class extends Br{data(e){let t=this._delegate.data(e);return this._delegate._converter||Ky(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},jr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Wi(e)}where(e,t,r){try{return new n(this.firestore,mn(this._delegate,Bw(e,t,r)))}catch(i){throw it(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,mn(this._delegate,qw(e,t)))}catch(r){throw it(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,mn(this._delegate,jw(e)))}catch(t){throw it(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,mn(this._delegate,Gw(e)))}catch(t){throw it(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,mn(this._delegate,Kw(...e)))}catch(t){throw it(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,mn(this._delegate,zw(...e)))}catch(t){throw it(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,mn(this._delegate,Ww(...e)))}catch(t){throw it(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,mn(this._delegate,$w(...e)))}catch(t){throw it(t,"endAt()","Query.endAt()")}}isEqual(e){return jf(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=eE(this._delegate):e?.source==="server"?t=tE(this._delegate):t=Zw(this._delegate),t.then(r=>new Oo(this.firestore,new Dt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=fE(e),r=pE(e,i=>new Oo(this.firestore,new Dt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Yf(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter($i.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},ep=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Oo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new jr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new qr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new ep(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new qr(this._firestore,r))})}isEqual(e){return $f(this._delegate,e._delegate)}},Qi=class n extends jr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Qt(this.firestore,e):null}doc(e){try{return e===void 0?new Qt(this.firestore,Vo(this._delegate)):new Qt(this.firestore,Vo(this._delegate,e))}catch(t){throw it(t,"doc()","CollectionReference.doc()")}}add(e){return rE(this._delegate,e).then(t=>new Qt(this.firestore,t))}isEqual(e){return qf(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter($i.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ur(n){return oe(n,pe)}var tp=class n{constructor(...e){this._delegate=new xt(...e)}static documentId(){return new n(Re.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof xt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var np=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=aE();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=oE();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=lE(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=cE(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=uE(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var lC={Firestore:hc,GeoPoint:Dr,Timestamp:Ee,Blob:uc,Transaction:dc,WriteBatch:fc,DocumentReference:Qt,DocumentSnapshot:Br,Query:jr,QueryDocumentSnapshot:qr,QuerySnapshot:Oo,CollectionReference:Qi,FieldPath:tp,FieldValue:np,setLogLevel:aC,CACHE_SIZE_UNLIMITED:Ew};function cC(n,e){n.INTERNAL.registerComponent(new ht("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},lC)))}function uC(n){cC(n,(e,t)=>new hc(e,t,new Zf)),n.registerVersion(iC,sC)}uC(Le);function hC(n,e=ri){return new In(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function gE(n,e){return hC(n,e)}function dC(n,e){return gE(n,e).pipe(Va(void 0),Da(),Ae(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function op(n,e){return gE(n,e).pipe(Ae(t=>({payload:t,type:"query"})))}var pc=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=wE(r,t);return new mc(i,s,this.afs)}snapshotChanges(){return dC(this.ref,this.afs.schedulers.outsideAngular).pipe(Ce)}valueChanges(e={}){return this.snapshotChanges().pipe(Ae(({payload:t})=>e.idField?Ns(ni({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return An(this.ref.get(e)).pipe(Ce)}};function gc(n,e){return op(n,e).pipe(Va(void 0),Da(),Ae(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,c)=>{let u=s.find(p=>p.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(p=>p.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function mE(n,e,t){return gc(n,t).pipe(pr((r,i)=>fC(r,i.map(s=>s.payload),e),[]),xa(),Ae(r=>r.map(i=>({type:i.type,payload:i}))))}function fC(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=pC(n,r))}),n}function ip(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function pC(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return ip(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return ip(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ip(n,e.oldIndex,1);break}return n}function _E(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var mc=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=gc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ae(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Va(void 0),Da(),Ds(([r,i])=>i.length>0||!r),Ae(([,r])=>r),Ce)}auditTrail(e){return this.stateChanges(e).pipe(pr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=_E(e);return mE(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce)}valueChanges(e={}){return op(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.payload.docs.map(r=>e.idField?Ns(ni({},r.data()),{[e.idField]:r.id}):r.data())),Ce)}get(e){return An(this.query.get(e)).pipe(Ce)}add(e){return this.ref.add(e)}doc(e){return new pc(this.ref.doc(e),this.afs)}},sp=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?gc(this.query,this.afs.schedulers.outsideAngular).pipe(Ce):gc(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ds(t=>t.length>0),Ce)}auditTrail(e){return this.stateChanges(e).pipe(pr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=_E(e);return mE(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce)}valueChanges(e={}){return op(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(r=>r.payload.docs.map(i=>e.idField?ni({[e.idField]:i.id},i.data()):i.data())),Ce)}get(e){return An(this.query.get(e)).pipe(Ce)}},yE=new qe("angularfire2.enableFirestorePersistence"),vE=new qe("angularfire2.firestore.persistenceSettings"),gC=new qe("angularfire2.firestore.settings"),mC=new qe("angularfire2.firestore.use-emulator");function wE(n,e=t=>t){return{query:e(n),ref:n}}var _C=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,c,u,d,p,g,y,S,k,x,q,j){this.schedulers=c;let M=mr(t,a,r),z=d;p&&Ks(M,a,g,S,k,x,y,q),[this.firestore,this.persistenceEnabled$]=ai(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let H=a.runOutsideAngular(()=>M.firestore());if(s&&H.settings(s),z&&H.useEmulator(...z),i&&!Oa(o)){let Y=()=>{try{return An(H.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),Mt(!1)}};return[H,a.runOutsideAngular(Y)]}else return[H,Mt(!1)]},[s,z,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=wE(i,r),a=this.schedulers.ngZone.run(()=>s);return new mc(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new sp(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new pc(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(W(Nn),W(xn,8),W(yE,8),W(gC,8),W(Rn),W(Ft),W(oi),W(vE,8),W(mC,8),W(zs,8),W(Ls,8),W(Us,8),W(Bs,8),W(qs,8),W(js,8),W(Gs,8),W(sn,8))};static \u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),iN=(()=>{class n{constructor(){Le.registerVersion("angularfire",on.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:yE,useValue:!0},{provide:vE,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=bn({type:n});static \u0275inj=Cn({providers:[_C]})}return n})();var EE="@firebase/database",TE="1.0.8";var yg="";function vg(n){yg=n}var pp=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ne(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ua(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var gp=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return yt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var ZE=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new pp(e)}}catch{}return new gp},Kr=ZE("localStorage"),mp=ZE("sessionStorage");var Xi=new kn("@firebase/database"),eT=function(){let n=1;return function(){return n++}}(),tT=function(n){let e=E_(n),t=new w_;t.update(e);let r=t.digest();return Ma.encodeByteArray(r)},sa=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=sa.apply(null,r):typeof r=="object"?e+=Ne(r):e+=r,e+=" "}return e},zr=null,IE=!0,nT=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Xi.logLevel=vt.VERBOSE,zr=Xi.log.bind(Xi),e&&mp.set("logging_enabled",!0)):typeof n=="function"?zr=n:(zr=null,mp.remove("logging_enabled"))},Ge=function(...n){if(IE===!0&&(IE=!1,zr===null&&mp.get("logging_enabled")===!0&&nT(!0)),zr){let e=sa.apply(null,n);zr(e)}},oa=function(n){return function(...e){Ge(n,...e)}},_p=function(...n){let e="FIREBASE INTERNAL ERROR: "+sa(...n);Xi.error(e)},Jt=function(...n){let e=`FIREBASE FATAL ERROR: ${sa(...n)}`;throw Xi.error(e),new Error(e)},Ze=function(...n){let e="FIREBASE WARNING: "+sa(...n);Xi.warn(e)},yC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ze("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Kc=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},vC=function(n){if(Lt()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},rr="[MIN_NAME]",_n="[MAX_NAME]",$r=function(n,e){if(n===e)return 0;if(n===rr||e===_n)return-1;if(e===rr||n===_n)return 1;{let t=AE(n),r=AE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},wC=function(n,e){return n===e?0:n<e?-1:1},Mo=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ne(e))},wg=function(n){if(typeof n!="object"||n===null)return Ne(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Ne(e[r]),t+=":",t+=wg(n[e[r]]);return t+="}",t},rT=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Ke(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var iT=function(n){O(!Kc(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,c;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(i?1:0),u.reverse();let d=u.join(""),p="";for(c=0;c<64;c+=8){let g=parseInt(d.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),p=p+g}return p.toLowerCase()},EC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},TC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function IC(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var AC=new RegExp("^-?(0*)\\d{1,10}$"),SC=-2147483648,CC=2147483647,AE=function(n){if(AC.test(n)){let e=Number(n);if(e>=SC&&e<=CC)return e}return null},as=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Ze("Exception was thrown by user callback.",t),e},Math.floor(0))}},bC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Bo=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var yp=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Ze(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var vp=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ge("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ze(e)}},qo=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),yc="5",sT="v",oT="s",aT="r",lT="f",cT=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,uT="ls",hT="p",wp="ac",dT="websocket",fT="long_polling";var vc=class{constructor(e,t,r,i,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Kr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Kr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function RC(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function pT(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let r;if(e===dT)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===fT)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);RC(n)&&(t.ns=n.namespace);let i=[];return Ke(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Ep=class{constructor(){this.counters_={}}incrementCounter(e,t=1){yt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return f_(this.counters_)}};var ap={},lp={};function Eg(n){let e=n.toString();return ap[e]||(ap[e]=new Ep),ap[e]}function PC(n,e){let t=n.toString();return lp[t]||(lp[t]=e()),lp[t]}var Tp=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&as(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var SE="start",kC="close",NC="pLPCommand",xC="pRTLPCB",gT="id",mT="pw",_T="ser",DC="cb",VC="seg",OC="ts",MC="d",FC="dframe",yT=1870,vT=30,LC=yT-vT,UC=25e3,BC=3e4,zo=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=oa(e),this.stats_=Eg(t),this.urlFn=c=>(this.appCheckToken&&(c[wp]=this.appCheckToken),pT(t,fT,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Tp(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(BC)),vC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ip((...s)=>{let[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===SE)this.id=a,this.password=c;else if(o===kC)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[SE]="t",r[_T]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[DC]=this.scriptTagHolder.uniqueCallbackIdentifier),r[sT]=yc,this.transportSessionId&&(r[oT]=this.transportSessionId),this.lastSessionId&&(r[uT]=this.lastSessionId),this.applicationId&&(r[hT]=this.applicationId),this.appCheckToken&&(r[wp]=this.appCheckToken),typeof location<"u"&&location.hostname&&cT.test(location.hostname)&&(r[aT]=lT);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Lt()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!EC()&&!TC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Ne(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=d_(t),i=rT(r,LC);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Lt())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[FC]="t",r[gT]=e,r[mT]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Ne(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Ip=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Lt())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=eT(),window[NC+this.uniqueCallbackIdentifier]=e,window[xC+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ge("frame writing exception"),a.stack&&Ge(a.stack),Ge(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ge("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[gT]=this.myID,e[mT]=this.myPW,e[_T]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+vT+r.length<=yT;){let o=this.pendingSegs.shift();r=r+"&"+VC+i+"="+o.seg+"&"+OC+i+"="+o.ts+"&"+MC+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(UC)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Lt()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ge("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var qC=16384,jC=45e3,wc=null;typeof MozWebSocket<"u"?wc=MozWebSocket:typeof WebSocket<"u"&&(wc=WebSocket);var Yi=(()=>{class n{constructor(t,r,i,s,o,a,c){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=oa(this.connId),this.stats_=Eg(r),this.connURL=n.connectionURL_(r,a,c,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[sT]=yc,!Lt()&&typeof location<"u"&&location.hostname&&cT.test(location.hostname)&&(a[aT]=lT),r&&(a[oT]=r),i&&(a[uT]=i),s&&(a[wp]=s),o&&(a[hT]=o),pT(t,dT,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Kr.set("previous_websocket_failure",!0);try{let i;if(Lt()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${yc}/${yg}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new wc(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&wc!==null&&!n.forceDisallow_}static previouslyFailed(){return Kr.isInMemoryStorage||Kr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Kr.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Ua(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=Ne(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=rT(r,qC);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(jC))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),wT=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[zo,Yi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=Yi&&Yi.isAvailable(),i=r&&!Yi.previouslyFailed();if(t.webSocketOnly&&(r||Ze("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Yi];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),GC=6e4,KC=5e3,zC=10*1024,WC=100*1024,cp="t",CE="d",$C="s",bE="r",QC="e",RE="o",PE="a",kE="n",NE="p",HC="h",Ap=class{constructor(e,t,r,i,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=oa("c:"+this.id+":"),this.transportManager_=new wT(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Bo(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>WC?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>zC?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(cp in e){let t=e[cp];t===PE?this.upgradeIfSecondaryHealthy_():t===bE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===RE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Mo("t",e),r=Mo("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:NE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:PE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:kE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Mo("t",e),r=Mo("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Mo(cp,e);if(CE in e){let r=e[CE];if(t===HC){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===kE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===$C?this.onConnectionShutdown_(r):t===bE?this.onReset_(r):t===QC?_p("Server Error: "+r):t===RE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_p("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),yc!==r&&Ze("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Bo(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(GC))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Bo(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(KC))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:NE,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Kr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Ec=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Tc=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Ic=class n extends Tc{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Lu()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var xE=32,DE=768,ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function le(){return new ce("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ir(n){return n.pieces_.length-n.pieceNum_}function fe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ce(n.pieces_,e)}function Tg(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function YC(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Wo(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ET(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ce(e,0)}function we(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ce)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new ce(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function st(n,e){let t=Z(n),r=Z(e);if(t===null)return e;if(t===r)return st(fe(n),fe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function JC(n,e){let t=Wo(n,0),r=Wo(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=$r(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Ig(n,e){if(ir(n)!==ir(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function At(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(ir(n)>ir(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var Sp=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Wo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ms(this.parts_[r]);TT(this)}};function XC(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ms(e),TT(n)}function ZC(n){let e=n.parts_.pop();n.byteLength_-=Ms(e),n.parts_.length>0&&(n.byteLength_-=1)}function TT(n){if(n.byteLength_>DE)throw new Error(n.errorPrefix_+"has a key path longer than "+DE+" bytes ("+n.byteLength_+").");if(n.parts_.length>xE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xE+") or object contains a cycle "+Gr(n))}function Gr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Cp=class n extends Tc{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var Fo=1e3,eb=60*5*1e3,VE=30*1e3,tb=1.3,nb=3e4,rb="server_kill",OE=3,Ag=(()=>{class n extends Ec{constructor(t,r,i,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=oa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Fo,this.maxReconnectDelay_=eb,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Lt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Cp.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Ic.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(Ne(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new je,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?r.resolve(c):r.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;n.warnOnListenWarnings_(u,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&yt(t,"w")){let i=Pn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();Ze(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||y_(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=VE)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=__(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ne(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):_p("Unrecognized action received from server: "+Ne(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Fo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Fo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>nb&&(this.reconnectDelay_=Fo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*tb)}this.onConnectStatus_(!1)}establishConnection_(){return N(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,i())},d=function(g){O(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(g)};this.realtime_={close:u,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,y]=yield Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?Ge("getToken() completed but was canceled"):(Ge("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=y&&y.token,c=new Ap(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,S=>{Ze(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(rb)},o))}catch(g){this.log_("Failed to get token: "+g),a||(this.repoInfo_.nodeAdmin&&Ze(g),u())}}})}interrupt(t){Ge("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ge("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ba(this.interruptReasons_)&&(this.reconnectDelay_=Fo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>wg(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new ce(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){Ge("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=OE&&(this.reconnectDelay_=VE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){Ge("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=OE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Lt()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+yg.replace(/\./g,"-")]=1,Lu()?t["framework.cordova"]=1:p_()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Ic.getInstance().currentlyOnline();return Ba(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Zi=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new te(rr,e),i=new te(rr,t);return this.compare(r,i)!==0}minPost(){return te.MIN}};var _c,Ac=class extends Zi{static get __EMPTY_NODE(){return _c}static set __EMPTY_NODE(e){_c=e}compare(e,t){return $r(e.name,t.name)}isDefinedOn(e){throw si("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(_n,_c)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,_c)}toString(){return".key"}},Yt=new Ac;var Ji=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Vt=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??St.EMPTY_NODE,this.right=o??St.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return St.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return St.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),bp=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Vt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},St=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Vt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Vt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ji(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ji(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ji(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ji(this.root_,null,this.comparator_,!0,e)}};St.EMPTY_NODE=new bp;function ib(n,e){return $r(n.name,e.name)}function Sg(n,e){return $r(n,e)}var Rp;function sb(n){Rp=n}var IT=function(n){return typeof n=="number"?"number:"+iT(n):"string:"+n},AT=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&yt(e,".sv"),"Priority must be a string or number.")}else O(n===Rp||n.isEmpty(),"priority of unexpected type.");O(n===Rp||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var ME,es=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),AT(this.priorityNode_)}static set __childrenNodeConstructor(t){ME=t}static get __childrenNodeConstructor(){return ME}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=Z(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(O(i!==".priority"||ir(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(fe(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+IT(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=iT(this.value_):t+=this.value_,this.lazyHash_=tT(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return O(s>=0,"Unknown leaf type: "+r),O(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),ST,CT;function ob(n){ST=n}function ab(n){CT=n}var Pp=class extends Zi{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?$r(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(_n,new es("[PRIORITY-POST]",CT))}makePost(e,t){let r=ST(e);return new te(t,new es("[PRIORITY-POST]",r))}toString(){return".priority"}},ge=new Pp;var lb=Math.log(2),kp=class{constructor(e){let t=s=>parseInt(Math.log(s)/lb,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Sc=function(n,e,t,r){n.sort(e);let i=function(c,u){let d=u-c,p,g;if(d===0)return null;if(d===1)return p=n[c],g=t?t(p):p,new Vt(g,p.node,Vt.BLACK,null,null);{let y=parseInt(d/2,10)+c,S=i(c,y),k=i(y+1,u);return p=n[y],g=t?t(p):p,new Vt(g,p.node,Vt.BLACK,S,k)}},s=function(c){let u=null,d=null,p=n.length,g=function(S,k){let x=p-S,q=p;p-=S;let j=i(x+1,q),M=n[x],z=t?t(M):M;y(new Vt(z,M.node,k,null,j))},y=function(S){u?(u.left=S,u=S):(d=S,u=S)};for(let S=0;S<c.count;++S){let k=c.nextBitIsOne(),x=Math.pow(2,c.count-(S+1));k?g(x,Vt.BLACK):(g(x,Vt.BLACK),g(x,Vt.RED))}return d},o=new kp(n.length),a=s(o);return new St(r||e,a)};var up,Hi={},ts=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(Hi&&ge,"ChildrenNode.ts has not been loaded"),up=up||new n({".priority":Hi},{".priority":ge}),up}get(e){let t=Pn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof St?t:null}hasIndex(e){return yt(this.indexSet_,e.toString())}addIndex(e,t){O(e!==Yt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=Sc(r,e.getCompare()):a=Hi;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,u)}addToIndexes(e,t){let r=Os(this.indexes_,(i,s)=>{let o=Pn(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),i===Hi)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(te.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Sc(a,o.getCompare())}else return Hi;else{let a=t.get(e.name),c=i;return a&&(c=c.remove(new te(e.name,a))),c.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Os(this.indexes_,i=>{if(i===Hi)return i;{let s=t.get(e.name);return s?i.remove(new te(e.name,s)):i}});return new n(r,this.indexSet_)}};var Lo,J=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&AT(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Lo||(Lo=new n(new St(Sg),null,ts.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Lo}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?Lo:r}}getChild(t){let r=Z(t);return r===null?this:this.getImmediateChild(r).getChild(fe(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(O(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new te(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?Lo:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=Z(t);if(i===null)return r;{O(Z(t)!==".priority"||ir(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(fe(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(ge,(a,c)=>{r[a]=c.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let c in r)a[c]=r[c];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+IT(this.getPriority().val())+":"),this.forEachChild(ge,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":tT(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new te(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new te(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new te(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===aa?-1:0}withIndex(t){if(t===Yt||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Yt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(ge),s=r.getIterator(ge),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Yt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Np=class extends J{constructor(){super(new St(Sg),J.EMPTY_NODE,ts.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return J.EMPTY_NODE}isEmpty(){return!1}},aa=new Np;Object.defineProperties(te,{MIN:{value:new te(rr,J.EMPTY_NODE)},MAX:{value:new te(_n,aa)}});Ac.__EMPTY_NODE=J.EMPTY_NODE;es.__childrenNodeConstructor=J;sb(aa);ab(aa);var cb=!0;function Te(n,e=null){if(n===null)return J.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new es(t,Te(e))}if(!(n instanceof Array)&&cb){let t=[],r=!1;if(Ke(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=Te(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new te(o,c)))}}),t.length===0)return J.EMPTY_NODE;let s=Sc(t,ib,o=>o.name,Sg);if(r){let o=Sc(t,ge.getCompare());return new J(s,Te(e),new ts({".priority":o},{".priority":ge}))}else return new J(s,Te(e),ts.Default)}else{let t=J.EMPTY_NODE;return Ke(n,(r,i)=>{if(yt(n,r)&&r.substring(0,1)!=="."){let s=Te(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Te(e))}}ob(Te);var $o=class extends Zi{constructor(e){super(),this.indexPath_=e,O(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?$r(e.name,t.name):s}makePost(e,t){let r=Te(e),i=J.EMPTY_NODE.updateChild(this.indexPath_,r);return new te(t,i)}maxPost(){let e=J.EMPTY_NODE.updateChild(this.indexPath_,aa);return new te(_n,e)}toString(){return Wo(this.indexPath_,0).join("/")}};var xp=class extends Zi{compare(e,t){let r=e.node.compareTo(t.node);return r===0?$r(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let r=Te(e);return new te(t,r)}toString(){return".value"}},Cg=new xp;function bT(n){return{type:"value",snapshotNode:n}}function ns(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Qo(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ho(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function ub(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Yo=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Qo(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ns(t,r)):o.trackChildChange(Ho(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(ge,(i,s)=>{t.hasChild(i)||r.trackChildChange(Qo(i,s))}),t.isLeafNode()||t.forEachChild(ge,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Ho(i,s,o))}else r.trackChildChange(ns(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?J.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Cc=class n{constructor(e){this.indexedFilter_=new Yo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new te(t,r))||(r=J.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=J.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(J.EMPTY_NODE);let s=this;return t.forEachChild(ge,(o,a)=>{s.matches(new te(o,a))||(i=i.updateImmediateChild(o,J.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Dp=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Cc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new te(t,r))||(r=J.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=J.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=J.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(J.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,J.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let p=this.index_.getCompare();o=(g,y)=>p(y,g)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let c=new te(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let p=a.getImmediateChild(t),g=i.getChildAfterChild(this.index_,u,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let y=g==null?1:o(g,c);if(d&&!r.isEmpty()&&y>=0)return s?.trackChildChange(Ho(t,r,p)),a.updateImmediateChild(t,r);{s?.trackChildChange(Qo(t,p));let k=a.updateImmediateChild(t,J.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(s?.trackChildChange(ns(g.name,g.node)),k.updateImmediateChild(g.name,g.node)):k}}else return r.isEmpty()?e:d&&o(u,c)>=0?(s!=null&&(s.trackChildChange(Qo(u.name,u.node)),s.trackChildChange(ns(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,J.EMPTY_NODE)):e}};var Jo=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ge}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:rr}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:_n}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ge}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function hb(n){return n.loadsAllData()?new Yo(n.getIndex()):n.hasLimit()?new Dp(n):new Cc(n)}function db(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function fb(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Vp(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function pb(n,e,t){let r;return n.index_===Yt||t?r=Vp(n,e,t):r=Vp(n,e,_n),r.startAfterSet_=!0,r}function Op(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function gb(n,e,t){let r;return n.index_===Yt||t?r=Op(n,e,t):r=Op(n,e,rr),r.endBeforeSet_=!0,r}function zc(n,e){let t=n.copy();return t.index_=e,t}function FE(n){let e={};if(n.isDefault())return e;let t;if(n.index_===ge?t="$priority":n.index_===Cg?t="$value":n.index_===Yt?t="$key":(O(n.index_ instanceof $o,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ne(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=Ne(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Ne(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Ne(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Ne(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function LE(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ge&&(e.i=n.index_.toString()),e}var Mp=class n extends Ec{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=oa("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let c=FE(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let p=d;if(u===404&&(p=null,u=null),u===null&&this.onDataUpdate_(s,p,!1,r),Pn(this.listens_,o)===a){let g;u?u===401?g="permission_denied":g="rest_error:"+u:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=FE(e._queryParams),r=e._path.toString(),i=new je;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+v_(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Ua(a.responseText)}catch{Ze("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&Ze("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var Fp=class{constructor(){this.rootNode_=J.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function bc(){return{value:null,children:new Map}}function ls(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=Z(e);n.children.has(r)||n.children.set(r,bc());let i=n.children.get(r);e=fe(e),ls(i,e,t)}}function Lp(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(ge,(r,i)=>{ls(n,new ce(r),i)}),Lp(n,e)}}else if(n.children.size>0){let t=Z(e);return e=fe(e),n.children.has(t)&&Lp(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Up(n,e,t){n.value!==null?t(e,n.value):mb(n,(r,i)=>{let s=new ce(e.toString()+"/"+r);Up(i,s,t)})}function mb(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Bp=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ke(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var UE=10*1e3,_b=30*1e3,yb=5*60*1e3,qp=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Bp(e);let r=UE+(_b-UE)*Math.random();Bo(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;Ke(e,(i,s)=>{s>0&&yt(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Bo(this.reportStats_.bind(this),Math.floor(Math.random()*2*yb))}};var Ht=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ht||{});function bg(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Rg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Pg(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var jp=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Ht.ACK_USER_WRITE,this.source=bg()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ce(e));return new n(le(),t,this.revert)}}else return O(Z(this.path)===e,"operationForChild called for unrelated child."),new n(fe(this.path),this.affectedTree,this.revert)}};var Rc=class n{constructor(e,t){this.source=e,this.path=t,this.type=Ht.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,le()):new n(this.source,fe(this.path))}};var rs=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Ht.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,le(),this.snap.getImmediateChild(e)):new n(this.source,fe(this.path),this.snap)}};var Xo=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Ht.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new ce(e));return t.isEmpty()?null:t.value?new rs(this.source,le(),t.value):new n(this.source,le(),t)}else return O(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,fe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Xt=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Gp=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function vb(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(ub(o.childName,o.snapshotNode))}),Uo(n,i,"child_removed",e,r,t),Uo(n,i,"child_added",e,r,t),Uo(n,i,"child_moved",s,r,t),Uo(n,i,"child_changed",e,r,t),Uo(n,i,"value",e,r,t),i}function Uo(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,c)=>Eb(n,a,c)),o.forEach(a=>{let c=wb(n,a,s);i.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function wb(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Eb(n,e,t){if(e.childName==null||t.childName==null)throw si("Should only compare child_ events.");let r=new te(e.childName,e.snapshotNode),i=new te(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Wc(n,e){return{eventCache:n,serverCache:e}}function jo(n,e,t,r){return Wc(new Xt(e,t,r),n.serverCache)}function RT(n,e,t,r){return Wc(n.eventCache,new Xt(e,t,r))}function Pc(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Wr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var hp,Tb=()=>(hp||(hp=new St(wC)),hp),ot=class n{constructor(e,t=Tb()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return Ke(e,(r,i)=>{t=t.set(new ce(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:le(),value:this.value};if(ee(e))return null;{let r=Z(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(fe(e),t);return s!=null?{path:we(new ce(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),r=this.children.get(t);return r!==null?r.subtree(fe(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let r=Z(e),s=(this.children.get(r)||new n(null)).set(fe(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),r=this.children.get(t);if(r){let i=r.remove(fe(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),r=this.children.get(t);return r?r.get(fe(e)):null}}setTree(e,t){if(ee(e))return t;{let r=Z(e),s=(this.children.get(r)||new n(null)).setTree(fe(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(le(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(we(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,le(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(fe(e),we(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,le(),t)}foreachOnPath_(e,t,r){if(ee(e))return this;{this.value&&r(t,this.value);let i=Z(e),s=this.children.get(i);return s?s.foreachOnPath_(fe(e),we(t,i),r):new n(null)}}foreach(e){this.foreach_(le(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(we(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Ot=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new ot(null))}};function Go(n,e,t){if(ee(e))return new Ot(new ot(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=st(i,e);return s=s.updateChild(o,t),new Ot(n.writeTree_.set(i,s))}else{let i=new ot(t),s=n.writeTree_.setTree(e,i);return new Ot(s)}}}function Kp(n,e,t){let r=n;return Ke(t,(i,s)=>{r=Go(r,we(e,i),s)}),r}function BE(n,e){if(ee(e))return Ot.empty();{let t=n.writeTree_.setTree(e,new ot(null));return new Ot(t)}}function zp(n,e){return Qr(n,e)!=null}function Qr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(st(t.path,e)):null}function qE(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ge,(r,i)=>{e.push(new te(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new te(r,i.value))}),e}function tr(n,e){if(ee(e))return n;{let t=Qr(n,e);return t!=null?new Ot(new ot(t)):new Ot(n.writeTree_.subtree(e))}}function Wp(n){return n.writeTree_.isEmpty()}function is(n,e){return PT(le(),n.writeTree_,e)}function PT(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=PT(we(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(we(n,".priority"),r)),t}}function $c(n,e){return DT(e,n)}function Ib(n,e,t,r,i){O(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Go(n.visibleWrites,e,t)),n.lastWriteId=r}function Ab(n,e,t,r){O(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Kp(n.visibleWrites,e,t),n.lastWriteId=r}function Sb(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function Cb(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&bb(a,r.path)?i=!1:At(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return Rb(n),!0;if(r.snap)n.visibleWrites=BE(n.visibleWrites,r.path);else{let a=r.children;Ke(a,c=>{n.visibleWrites=BE(n.visibleWrites,we(r.path,c))})}return!0}else return!1}function bb(n,e){if(n.snap)return At(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&At(we(n.path,t),e))return!0;return!1}function Rb(n){n.visibleWrites=kT(n.allWrites,Pb,le()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Pb(n){return n.visible}function kT(n,e,t){let r=Ot.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)At(t,o)?(a=st(t,o),r=Go(r,a,s.snap)):At(o,t)&&(a=st(o,t),r=Go(r,le(),s.snap.getChild(a)));else if(s.children){if(At(t,o))a=st(t,o),r=Kp(r,a,s.children);else if(At(o,t))if(a=st(o,t),ee(a))r=Kp(r,le(),s.children);else{let c=Pn(s.children,Z(a));if(c){let u=c.getChild(fe(a));r=Go(r,le(),u)}}}else throw si("WriteRecord should have .snap or .children")}}return r}function NT(n,e,t,r,i){if(!r&&!i){let s=Qr(n.visibleWrites,e);if(s!=null)return s;{let o=tr(n.visibleWrites,e);if(Wp(o))return t;if(t==null&&!zp(o,le()))return null;{let a=t||J.EMPTY_NODE;return is(o,a)}}}else{let s=tr(n.visibleWrites,e);if(!i&&Wp(s))return t;if(!i&&t==null&&!zp(s,le()))return null;{let o=function(u){return(u.visible||i)&&(!r||!~r.indexOf(u.writeId))&&(At(u.path,e)||At(e,u.path))},a=kT(n.allWrites,o,e),c=t||J.EMPTY_NODE;return is(a,c)}}}function kb(n,e,t){let r=J.EMPTY_NODE,i=Qr(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(ge,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=tr(n.visibleWrites,e);return t.forEachChild(ge,(o,a)=>{let c=is(tr(s,new ce(o)),a);r=r.updateImmediateChild(o,c)}),qE(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=tr(n.visibleWrites,e);return qE(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Nb(n,e,t,r,i){O(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=we(e,t);if(zp(n.visibleWrites,s))return null;{let o=tr(n.visibleWrites,s);return Wp(o)?i.getChild(t):is(o,i.getChild(t))}}function xb(n,e,t,r){let i=we(e,t),s=Qr(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=tr(n.visibleWrites,i);return is(o,r.getNode().getImmediateChild(t))}else return null}function Db(n,e){return Qr(n.visibleWrites,e)}function Vb(n,e,t,r,i,s,o){let a,c=tr(n.visibleWrites,e),u=Qr(c,le());if(u!=null)a=u;else if(t!=null)a=is(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=o.getCompare(),g=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),y=g.getNext();for(;y&&d.length<i;)p(y,r)!==0&&d.push(y),y=g.getNext();return d}else return[]}function Ob(){return{visibleWrites:Ot.empty(),allWrites:[],lastWriteId:-1}}function kc(n,e,t,r){return NT(n.writeTree,n.treePath,e,t,r)}function kg(n,e){return kb(n.writeTree,n.treePath,e)}function jE(n,e,t,r){return Nb(n.writeTree,n.treePath,e,t,r)}function Nc(n,e){return Db(n.writeTree,we(n.treePath,e))}function Mb(n,e,t,r,i,s){return Vb(n.writeTree,n.treePath,e,t,r,i,s)}function Ng(n,e,t){return xb(n.writeTree,n.treePath,e,t)}function xT(n,e){return DT(we(n.treePath,e),n.writeTree)}function DT(n,e){return{treePath:n,writeTree:e}}var $p=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Ho(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Qo(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,ns(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Ho(r,e.snapshotNode,i.oldSnap));else throw si("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Qp=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},VT=new Qp,Zo=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Xt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ng(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Wr(this.viewCache_),s=Mb(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function Fb(n){return{filter:n}}function Lb(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Ub(n,e,t,r,i){let s=new $p,o,a;if(t.type===Ht.OVERWRITE){let u=t;u.source.fromUser?o=Hp(n,e,u.path,u.snap,r,i,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ee(u.path),o=xc(n,e,u.path,u.snap,r,i,a,s))}else if(t.type===Ht.MERGE){let u=t;u.source.fromUser?o=qb(n,e,u.path,u.children,r,i,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=Yp(n,e,u.path,u.children,r,i,a,s))}else if(t.type===Ht.ACK_USER_WRITE){let u=t;u.revert?o=Kb(n,e,u.path,r,i,s):o=jb(n,e,u.path,u.affectedTree,r,i,s)}else if(t.type===Ht.LISTEN_COMPLETE)o=Gb(n,e,t.path,r,s);else throw si("Unknown operation type: "+t.type);let c=s.getChanges();return Bb(e,o,c),{viewCache:o,changes:c}}function Bb(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Pc(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(bT(Pc(e)))}}function OT(n,e,t,r,i,s){let o=e.eventCache;if(Nc(r,t)!=null)return e;{let a,c;if(ee(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=Wr(e),d=u instanceof J?u:J.EMPTY_NODE,p=kg(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{let u=kc(r,Wr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=Z(t);if(u===".priority"){O(ir(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let p=jE(r,t,d,c);p!=null?a=n.filter.updatePriority(d,p):a=o.getNode()}else{let d=fe(t),p;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let g=jE(r,t,o.getNode(),c);g!=null?p=o.getNode().getImmediateChild(u).updateChild(d,g):p=o.getNode().getImmediateChild(u)}else p=Ng(r,u,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),u,p,d,i,s):a=o.getNode()}}return jo(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function xc(n,e,t,r,i,s,o,a){let c=e.serverCache,u,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))u=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,r);u=d.updateFullNode(c.getNode(),y,null)}else{let y=Z(t);if(!c.isCompleteForPath(t)&&ir(t)>1)return e;let S=fe(t),x=c.getNode().getImmediateChild(y).updateChild(S,r);y===".priority"?u=d.updatePriority(c.getNode(),x):u=d.updateChild(c.getNode(),y,x,S,VT,null)}let p=RT(e,u,c.isFullyInitialized()||ee(t),d.filtersNodes()),g=new Zo(i,p,s);return OT(n,p,t,i,g,a)}function Hp(n,e,t,r,i,s,o){let a=e.eventCache,c,u,d=new Zo(i,e,s);if(ee(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=jo(e,u,!0,n.filter.filtersNodes());else{let p=Z(t);if(p===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=jo(e,u,a.isFullyInitialized(),a.isFiltered());else{let g=fe(t),y=a.getNode().getImmediateChild(p),S;if(ee(g))S=r;else{let k=d.getCompleteChild(p);k!=null?Tg(g)===".priority"&&k.getChild(ET(g)).isEmpty()?S=k:S=k.updateChild(g,r):S=J.EMPTY_NODE}if(y.equals(S))c=e;else{let k=n.filter.updateChild(a.getNode(),p,S,g,d,o);c=jo(e,k,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function GE(n,e){return n.eventCache.isCompleteForChild(e)}function qb(n,e,t,r,i,s,o){let a=e;return r.foreach((c,u)=>{let d=we(t,c);GE(e,Z(d))&&(a=Hp(n,a,d,u,i,s,o))}),r.foreach((c,u)=>{let d=we(t,c);GE(e,Z(d))||(a=Hp(n,a,d,u,i,s,o))}),a}function KE(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Yp(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;ee(t)?u=r:u=new ot(null).setTree(t,r);let d=e.serverCache.getNode();return u.children.inorderTraversal((p,g)=>{if(d.hasChild(p)){let y=e.serverCache.getNode().getImmediateChild(p),S=KE(n,y,g);c=xc(n,c,new ce(p),S,i,s,o,a)}}),u.children.inorderTraversal((p,g)=>{let y=!e.serverCache.isCompleteForChild(p)&&g.value===null;if(!d.hasChild(p)&&!y){let S=e.serverCache.getNode().getImmediateChild(p),k=KE(n,S,g);c=xc(n,c,new ce(p),k,i,s,o,a)}}),c}function jb(n,e,t,r,i,s,o){if(Nc(i,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(ee(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return xc(n,e,t,c.getNode().getChild(t),i,s,a,o);if(ee(t)){let u=new ot(null);return c.getNode().forEachChild(Yt,(d,p)=>{u=u.set(new ce(d),p)}),Yp(n,e,t,u,i,s,a,o)}else return e}else{let u=new ot(null);return r.foreach((d,p)=>{let g=we(t,d);c.isCompleteForPath(g)&&(u=u.set(d,c.getNode().getChild(g)))}),Yp(n,e,t,u,i,s,a,o)}}function Gb(n,e,t,r,i){let s=e.serverCache,o=RT(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return OT(n,o,t,r,VT,i)}function Kb(n,e,t,r,i,s){let o;if(Nc(r,t)!=null)return e;{let a=new Zo(r,e,i),c=e.eventCache.getNode(),u;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=kc(r,Wr(e));else{let p=e.serverCache.getNode();O(p instanceof J,"serverChildren would be complete if leaf node"),d=kg(r,p)}d=d,u=n.filter.updateFullNode(c,d,s)}else{let d=Z(t),p=Ng(r,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?u=n.filter.updateChild(c,d,p,fe(t),a,s):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(c,d,J.EMPTY_NODE,fe(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=kc(r,Wr(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||Nc(r,le())!=null,jo(e,u,o,n.filter.filtersNodes())}}var Jp=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Yo(r.getIndex()),s=hb(r);this.processor_=Fb(s);let o=t.serverCache,a=t.eventCache,c=i.updateFullNode(J.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(J.EMPTY_NODE,a.getNode(),null),d=new Xt(c,o.isFullyInitialized(),i.filtersNodes()),p=new Xt(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Wc(p,d),this.eventGenerator_=new Gp(this.query_)}get query(){return this.query_}};function zb(n){return n.viewCache_.serverCache.getNode()}function Wb(n){return Pc(n.viewCache_)}function $b(n,e){let t=Wr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function zE(n){return n.eventRegistrations_.length===0}function Qb(n,e){n.eventRegistrations_.push(e)}function WE(n,e,t){let r=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function $E(n,e,t,r){e.type===Ht.MERGE&&e.source.queryId!==null&&(O(Wr(n.viewCache_),"We should always have a full cache before handling merges"),O(Pc(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=Ub(n.processor_,i,e,t,r);return Lb(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,MT(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Hb(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ge,(s,o)=>{r.push(ns(s,o))}),t.isFullyInitialized()&&r.push(bT(t.getNode())),MT(n,r,t.getNode(),e)}function MT(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return vb(n.eventGenerator_,e,t,i)}var Dc,Vc=class{constructor(){this.views=new Map}};function Yb(n){O(!Dc,"__referenceConstructor has already been defined"),Dc=n}function Jb(){return O(Dc,"Reference.ts has not been loaded"),Dc}function Xb(n){return n.views.size===0}function xg(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return O(s!=null,"SyncTree gave us an op for an invalid query."),$E(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat($E(o,e,t,r));return s}}function FT(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=kc(t,i?r:null),c=!1;a?c=!0:r instanceof J?(a=kg(t,r),c=!1):(a=J.EMPTY_NODE,c=!1);let u=Wc(new Xt(a,c,!1),new Xt(r,i,!1));return new Jp(e,u)}return o}function Zb(n,e,t,r,i,s){let o=FT(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Qb(o,t),Hb(o,t)}function eR(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=sr(n);if(i==="default")for(let[c,u]of n.views.entries())o=o.concat(WE(u,t,r)),zE(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{let c=n.views.get(i);c&&(o=o.concat(WE(c,t,r)),zE(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!sr(n)&&s.push(new(Jb())(e._repo,e._path)),{removed:s,events:o}}function LT(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function nr(n,e){let t=null;for(let r of n.views.values())t=t||$b(r,e);return t}function UT(n,e){if(e._queryParams.loadsAllData())return Qc(n);{let r=e._queryIdentifier;return n.views.get(r)}}function BT(n,e){return UT(n,e)!=null}function sr(n){return Qc(n)!=null}function Qc(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Oc;function tR(n){O(!Oc,"__referenceConstructor has already been defined"),Oc=n}function nR(){return O(Oc,"Reference.ts has not been loaded"),Oc}var rR=1,Mc=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ot(null),this.pendingWriteTree_=Ob(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Dg(n,e,t,r,i){return Ib(n.pendingWriteTree_,e,t,r,i),i?cs(n,new rs(bg(),e,t)):[]}function iR(n,e,t,r){Ab(n.pendingWriteTree_,e,t,r);let i=ot.fromObject(t);return cs(n,new Xo(bg(),e,i))}function er(n,e,t=!1){let r=Sb(n.pendingWriteTree_,e);if(Cb(n.pendingWriteTree_,e)){let s=new ot(null);return r.snap!=null?s=s.set(le(),!0):Ke(r.children,o=>{s=s.set(new ce(o),!0)}),cs(n,new jp(r.path,s,t))}else return[]}function la(n,e,t){return cs(n,new rs(Rg(),e,t))}function sR(n,e,t){let r=ot.fromObject(t);return cs(n,new Xo(Rg(),e,r))}function oR(n,e){return cs(n,new Rc(Rg(),e))}function aR(n,e,t){let r=Vg(n,t);if(r){let i=Og(r),s=i.path,o=i.queryId,a=st(s,e),c=new Rc(Pg(o),a);return Mg(n,s,c)}else return[]}function Fc(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||BT(o,e))){let c=eR(o,e,t,r);Xb(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=c.removed;if(a=c.events,!i){let d=u.findIndex(g=>g._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(s,(g,y)=>sr(y));if(d&&!p){let g=n.syncPointTree_.subtree(s);if(!g.isEmpty()){let y=uR(g);for(let S=0;S<y.length;++S){let k=y[S],x=k.query,q=KT(n,k);n.listenProvider_.startListening(Ko(x),ea(n,x),q.hashFn,q.onComplete)}}}!p&&u.length>0&&!r&&(d?n.listenProvider_.stopListening(Ko(e),null):u.forEach(g=>{let y=n.queryToTagMap.get(Yc(g));n.listenProvider_.stopListening(Ko(g),y)}))}hR(n,u)}return a}function qT(n,e,t,r){let i=Vg(n,r);if(i!=null){let s=Og(i),o=s.path,a=s.queryId,c=st(o,e),u=new rs(Pg(a),c,t);return Mg(n,o,u)}else return[]}function lR(n,e,t,r){let i=Vg(n,r);if(i){let s=Og(i),o=s.path,a=s.queryId,c=st(o,e),u=ot.fromObject(t),d=new Xo(Pg(a),c,u);return Mg(n,o,d)}else return[]}function Xp(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(g,y)=>{let S=st(g,i);s=s||nr(y,S),o=o||sr(y)});let a=n.syncPointTree_.get(i);a?(o=o||sr(a),s=s||nr(a,le())):(a=new Vc,n.syncPointTree_=n.syncPointTree_.set(i,a));let c;s!=null?c=!0:(c=!1,s=J.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((y,S)=>{let k=nr(S,le());k&&(s=s.updateImmediateChild(y,k))}));let u=BT(a,e);if(!u&&!e._queryParams.loadsAllData()){let g=Yc(e);O(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let y=dR();n.queryToTagMap.set(g,y),n.tagToQueryMap.set(y,g)}let d=$c(n.pendingWriteTree_,i),p=Zb(a,e,t,d,s,c);if(!u&&!o&&!r){let g=UT(a,e);p=p.concat(fR(n,e,g))}return p}function Hc(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=st(o,e),u=nr(a,c);if(u)return u});return NT(i,e,s,t,!0)}function cR(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(u,d)=>{let p=st(u,t);r=r||nr(d,p)});let i=n.syncPointTree_.get(t);i?r=r||nr(i,le()):(i=new Vc,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Xt(r,!0,!1):null,a=$c(n.pendingWriteTree_,e._path),c=FT(i,e,a,s?o.getNode():J.EMPTY_NODE,s);return Wb(c)}function cs(n,e){return jT(e,n.syncPointTree_,null,$c(n.pendingWriteTree_,le()))}function jT(n,e,t,r){if(ee(n.path))return GT(n,e,t,r);{let i=e.get(le());t==null&&i!=null&&(t=nr(i,le()));let s=[],o=Z(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=xT(r,o);s=s.concat(jT(a,c,u,d))}return i&&(s=s.concat(xg(i,n,r,t))),s}}function GT(n,e,t,r){let i=e.get(le());t==null&&i!=null&&(t=nr(i,le()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=xT(r,o),d=n.operationForChild(o);d&&(s=s.concat(GT(d,a,c,u)))}),i&&(s=s.concat(xg(i,n,r,t))),s}function KT(n,e){let t=e.query,r=ea(n,t);return{hashFn:()=>(zb(e)||J.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?aR(n,t._path,r):oR(n,t._path);{let s=IC(i,t);return Fc(n,t,null,s)}}}}function ea(n,e){let t=Yc(e);return n.queryToTagMap.get(t)}function Yc(n){return n._path.toString()+"$"+n._queryIdentifier}function Vg(n,e){return n.tagToQueryMap.get(e)}function Og(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ce(n.substr(0,e))}}function Mg(n,e,t){let r=n.syncPointTree_.get(e);O(r,"Missing sync point for query tag that we're tracking");let i=$c(n.pendingWriteTree_,e);return xg(r,t,i,null)}function uR(n){return n.fold((e,t,r)=>{if(t&&sr(t))return[Qc(t)];{let i=[];return t&&(i=LT(t)),Ke(r,(s,o)=>{i=i.concat(o)}),i}})}function Ko(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(nR())(n._repo,n._path):n}function hR(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Yc(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function dR(){return rR++}function fR(n,e,t){let r=e._path,i=ea(n,e),s=KT(n,t),o=n.listenProvider_.startListening(Ko(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)O(!sr(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,p)=>{if(!ee(u)&&d&&sr(d))return[Qc(d).query];{let g=[];return d&&(g=g.concat(LT(d).map(y=>y.query))),Ke(p,(y,S)=>{g=g.concat(S)}),g}});for(let u=0;u<c.length;++u){let d=c[u];n.listenProvider_.stopListening(Ko(d),ea(n,d))}}return o}var Zp=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},eg=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=we(this.path_,e);return new n(this.syncTree_,t)}node(){return Hc(this.syncTree_,this.path_)}},pR=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},QE=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return gR(n[".sv"],e,t);if(typeof n[".sv"]=="object")return mR(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},gR=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},mR=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&O(!1,"Unexpected increment value: "+r);let i=e.node();if(O(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},zT=function(n,e,t,r){return Lg(e,new eg(t,n),r)},Fg=function(n,e,t){return Lg(n,new Zp(e),t)};function Lg(n,e,t){let r=n.getPriority().val(),i=QE(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=QE(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new es(a,Te(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new es(i))),o.forEachChild(ge,(a,c)=>{let u=Lg(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}var ta=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Jc(n,e){let t=e instanceof ce?e:new ce(e),r=n,i=Z(t);for(;i!==null;){let s=Pn(r.node.children,i)||{children:{},childCount:0};r=new ta(i,r,s),t=fe(t),i=Z(t)}return r}function Hr(n){return n.node.value}function Ug(n,e){n.node.value=e,tg(n)}function WT(n){return n.node.childCount>0}function _R(n){return Hr(n)===void 0&&!WT(n)}function Xc(n,e){Ke(n.node.children,(t,r)=>{e(new ta(t,n,r))})}function $T(n,e,t,r){t&&!r&&e(n),Xc(n,i=>{$T(i,e,!0,r)}),t&&r&&e(n)}function yR(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function ca(n){return new ce(n.parent===null?n.name:ca(n.parent)+"/"+n.name)}function tg(n){n.parent!==null&&vR(n.parent,n.name,n)}function vR(n,e,t){let r=_R(t),i=yt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,tg(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,tg(n))}var wR=/[\[\].#$\/\u0000-\u001F\u007F]/,ER=/[\[\].#$\u0000-\u001F\u007F]/,dp=10*1024*1024,Zc=function(n){return typeof n=="string"&&n.length!==0&&!wR.test(n)},QT=function(n){return typeof n=="string"&&n.length!==0&&!ER.test(n)},TR=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),QT(n)},na=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Kc(n)||n&&typeof n=="object"&&yt(n,".sv")},Zt=function(n,e,t,r){r&&e===void 0||ua(lt(n,"value"),e,t)},ua=function(n,e,t){let r=t instanceof ce?new Sp(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Gr(r));if(typeof e=="function")throw new Error(n+"contains a function "+Gr(r)+" with contents = "+e.toString());if(Kc(e))throw new Error(n+"contains "+e.toString()+" "+Gr(r));if(typeof e=="string"&&e.length>dp/3&&Ms(e)>dp)throw new Error(n+"contains a string greater than "+dp+" utf8 bytes "+Gr(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ke(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Zc(o)))throw new Error(n+" contains an invalid key ("+o+") "+Gr(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);XC(r,o),ua(n,a,r),ZC(r)}),i&&s)throw new Error(n+' contains ".value" child '+Gr(r)+" in addition to actual children.")}},IR=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=Wo(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Zc(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(JC);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&At(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},HT=function(n,e,t,r){if(r&&e===void 0)return;let i=lt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];Ke(e,(o,a)=>{let c=new ce(o);if(ua(i,a,we(t,c)),Tg(c)===".priority"&&!na(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),IR(i,s)},Bg=function(n,e,t){if(!(t&&e===void 0)){if(Kc(e))throw new Error(lt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!na(e))throw new Error(lt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ha=function(n,e,t,r){if(!(r&&t===void 0)&&!Zc(t))throw new Error(lt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},us=function(n,e,t,r){if(!(r&&t===void 0)&&!QT(t))throw new Error(lt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},AR=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),us(n,e,t,r)},pt=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},YT=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Zc(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!TR(t))throw new Error(lt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var ng=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function eu(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!Ig(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function JT(n,e,t){eu(n,t),XT(n,r=>Ig(r,e))}function gt(n,e,t){eu(n,t),XT(n,r=>At(r,e)||At(e,r))}function XT(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(SR(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function SR(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();zr&&Ge("event: "+t.toString()),as(r)}}}var ZT="repo_interrupt",CR=25,rg=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ng,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=bc(),this.transactionQueueTree_=new ta,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function bR(n,e,t){if(n.stats_=Eg(n.repoInfo_),n.forceRestClient_||bC())n.server_=new Mp(n.repoInfo_,(r,i,s,o)=>{HE(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>YE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ne(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Ag(n.repoInfo_,e,(r,i,s,o)=>{HE(n,r,i,s,o)},r=>{YE(n,r)},r=>{RR(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=PC(n.repoInfo_,()=>new qp(n.stats_,n.server_)),n.infoData_=new Fp,n.infoSyncTree_=new Mc({startListening:(r,i,s,o)=>{let a=[],c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=la(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),qg(n,"connected",!1),n.serverSyncTree_=new Mc({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,c)=>{let u=o(a,c);gt(n.eventQueue_,r._path,u)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function eI(n){let t=n.infoData_.getNode(new ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function da(n){return pR({timestamp:eI(n)})}function HE(n,e,t,r,i){n.dataUpdateCount++;let s=new ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let c=Os(t,u=>Te(u));o=lR(n.serverSyncTree_,s,c,i)}else{let c=Te(t);o=qT(n.serverSyncTree_,s,c,i)}else if(r){let c=Os(t,u=>Te(u));o=sR(n.serverSyncTree_,s,c)}else{let c=Te(t);o=la(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=ss(n,s)),gt(n.eventQueue_,a,o)}function YE(n,e){qg(n,"connected",e),e===!1&&NR(n)}function RR(n,e){Ke(e,(t,r)=>{qg(n,t,r)})}function qg(n,e,t){let r=new ce("/.info/"+e),i=Te(t);n.infoData_.updateSnapshot(r,i);let s=la(n.infoSyncTree_,r,i);gt(n.eventQueue_,r,s)}function tu(n){return n.nextWriteId_++}function PR(n,e,t){let r=cR(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Te(i).withIndex(e._queryParams.getIndex());Xp(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=la(n.serverSyncTree_,e._path,s);else{let a=ea(n.serverSyncTree_,e);o=qT(n.serverSyncTree_,e._path,s,a)}return gt(n.eventQueue_,e._path,o),Fc(n.serverSyncTree_,e,t,null,!0),s},i=>(hs(n,"get for query "+Ne(e)+" failed: "+i),Promise.reject(new Error(i))))}function jg(n,e,t,r,i){hs(n,"set",{path:e.toString(),value:t,priority:r});let s=da(n),o=Te(t,r),a=Hc(n.serverSyncTree_,e),c=Fg(o,a,s),u=tu(n),d=Dg(n.serverSyncTree_,e,c,u,!0);eu(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(g,y)=>{let S=g==="ok";S||Ze("set at "+e+" failed: "+g);let k=er(n.serverSyncTree_,u,!S);gt(n.eventQueue_,e,k),or(n,i,g,y)});let p=Kg(n,e);ss(n,p),gt(n.eventQueue_,p,[])}function kR(n,e,t,r){hs(n,"update",{path:e.toString(),value:t});let i=!0,s=da(n),o={};if(Ke(t,(a,c)=>{i=!1,o[a]=zT(we(e,a),Te(c),n.serverSyncTree_,s)}),i)Ge("update() called with empty data.  Don't do anything."),or(n,r,"ok",void 0);else{let a=tu(n),c=iR(n.serverSyncTree_,e,o,a);eu(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,d)=>{let p=u==="ok";p||Ze("update at "+e+" failed: "+u);let g=er(n.serverSyncTree_,a,!p),y=g.length>0?ss(n,e):e;gt(n.eventQueue_,y,g),or(n,r,u,d)}),Ke(t,u=>{let d=Kg(n,we(e,u));ss(n,d)}),gt(n.eventQueue_,e,[])}}function NR(n){hs(n,"onDisconnectEvents");let e=da(n),t=bc();Up(n.onDisconnect_,le(),(i,s)=>{let o=zT(i,s,n.serverSyncTree_,e);ls(t,i,o)});let r=[];Up(t,le(),(i,s)=>{r=r.concat(la(n.serverSyncTree_,i,s));let o=Kg(n,i);ss(n,o)}),n.onDisconnect_=bc(),gt(n.eventQueue_,le(),r)}function xR(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Lp(n.onDisconnect_,e),or(n,t,r,i)})}function JE(n,e,t,r){let i=Te(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&ls(n.onDisconnect_,e,i),or(n,r,s,o)})}function DR(n,e,t,r,i){let s=Te(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&ls(n.onDisconnect_,e,s),or(n,i,o,a)})}function VR(n,e,t,r){if(Ba(t)){Ge("onDisconnect().update() called with empty data.  Don't do anything."),or(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&Ke(t,(o,a)=>{let c=Te(a);ls(n.onDisconnect_,we(e,o),c)}),or(n,r,i,s)})}function OR(n,e,t){let r;Z(e._path)===".info"?r=Xp(n.infoSyncTree_,e,t):r=Xp(n.serverSyncTree_,e,t),JT(n.eventQueue_,e._path,r)}function ig(n,e,t){let r;Z(e._path)===".info"?r=Fc(n.infoSyncTree_,e,t):r=Fc(n.serverSyncTree_,e,t),JT(n.eventQueue_,e._path,r)}function tI(n){n.persistentConnection_&&n.persistentConnection_.interrupt(ZT)}function MR(n){n.persistentConnection_&&n.persistentConnection_.resume(ZT)}function hs(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ge(t,...e)}function or(n,e,t,r){e&&as(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function FR(n,e,t,r,i,s){hs(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:eT(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Gg(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ua("transaction failed: Data returned ",c,o.path),o.status=0;let u=Jc(n.transactionQueueTree_,e),d=Hr(u)||[];d.push(o),Ug(u,d);let p;typeof c=="object"&&c!==null&&yt(c,".priority")?(p=Pn(c,".priority"),O(na(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(Hc(n.serverSyncTree_,e)||J.EMPTY_NODE).getPriority().val();let g=da(n),y=Te(c,p),S=Fg(y,a,g);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=S,o.currentWriteId=tu(n);let k=Dg(n.serverSyncTree_,e,S,o.currentWriteId,o.applyLocally);gt(n.eventQueue_,e,k),nu(n,n.transactionQueueTree_)}}function Gg(n,e,t){return Hc(n.serverSyncTree_,e,t)||J.EMPTY_NODE}function nu(n,e=n.transactionQueueTree_){if(e||ru(n,e),Hr(e)){let t=rI(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&LR(n,ca(e),t)}else WT(e)&&Xc(e,t=>{nu(n,t)})}function LR(n,e,t){let r=t.map(u=>u.currentWriteId),i=Gg(n,e,r),s=i,o=i.hash();for(let u=0;u<t.length;u++){let d=t[u];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=st(e,d.path);s=s.updateChild(p,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{hs(n,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let p=[];for(let g=0;g<t.length;g++)t[g].status=2,d=d.concat(er(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&p.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();ru(n,Jc(n.transactionQueueTree_,e)),nu(n,n.transactionQueueTree_),gt(n.eventQueue_,e,d);for(let g=0;g<p.length;g++)as(p[g])}else{if(u==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{Ze("transaction at "+c.toString()+" failed: "+u);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=u}ss(n,e)}},o)}function ss(n,e){let t=nI(n,e),r=ca(t),i=rI(n,t);return UR(n,i,r),r}function UR(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=st(t,c.path),d=!1,p;if(O(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,i=i.concat(er(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=CR)d=!0,p="maxretry",i=i.concat(er(n.serverSyncTree_,c.currentWriteId,!0));else{let g=Gg(n,c.path,o);c.currentInputSnapshot=g;let y=e[a].update(g.val());if(y!==void 0){ua("transaction failed: Data returned ",y,c.path);let S=Te(y);typeof y=="object"&&y!=null&&yt(y,".priority")||(S=S.updatePriority(g.getPriority()));let x=c.currentWriteId,q=da(n),j=Fg(S,g,q);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=j,c.currentWriteId=tu(n),o.splice(o.indexOf(x),1),i=i.concat(Dg(n.serverSyncTree_,c.path,j,c.currentWriteId,c.applyLocally)),i=i.concat(er(n.serverSyncTree_,x,!0))}else d=!0,p="nodata",i=i.concat(er(n.serverSyncTree_,c.currentWriteId,!0))}gt(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(p),!1,null))))}ru(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)as(r[a]);nu(n,n.transactionQueueTree_)}function nI(n,e){let t,r=n.transactionQueueTree_;for(t=Z(e);t!==null&&Hr(r)===void 0;)r=Jc(r,t),e=fe(e),t=Z(e);return r}function rI(n,e){let t=[];return iI(n,e,t),t.sort((r,i)=>r.order-i.order),t}function iI(n,e,t){let r=Hr(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Xc(e,i=>{iI(n,i,t)})}function ru(n,e){let t=Hr(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,Ug(e,t.length>0?t:void 0)}Xc(e,r=>{ru(n,r)})}function Kg(n,e){let t=ca(nI(n,e)),r=Jc(n.transactionQueueTree_,e);return yR(r,i=>{fp(n,i)}),fp(n,r),$T(r,i=>{fp(n,i)}),t}function fp(n,e){let t=Hr(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(er(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Ug(e,void 0):t.length=s+1,gt(n.eventQueue_,ca(e),i);for(let o=0;o<r.length;o++)as(r[o])}}function BR(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function qR(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Ze(`Invalid query segment '${t}' in query '${n}'`)}return e}var sg=function(n,e){let t=jR(n),r=t.namespace;t.domain==="firebase.com"&&Jt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Jt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||yC();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new vc(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new ce(t.pathString)}},jR=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(i=BR(n.substring(d,p)));let g=qR(n.substring(Math.min(n.length,p)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let S=e.indexOf(".");r=e.substring(0,S).toLowerCase(),t=e.substring(S+1),s=r}"ns"in g&&(s=g.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var XE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",GR=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=XE.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=XE.charAt(e[i]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var Lc=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ne(this.snapshot.exportVal())}},Uc=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var ra=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Bc=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new je;return xR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){pt("OnDisconnect.remove",this._path);let e=new je;return JE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){pt("OnDisconnect.set",this._path),Zt("OnDisconnect.set",e,this._path,!1);let t=new je;return JE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){pt("OnDisconnect.setWithPriority",this._path),Zt("OnDisconnect.setWithPriority",e,this._path,!1),Bg("OnDisconnect.setWithPriority",t,!1);let r=new je;return DR(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){pt("OnDisconnect.update",this._path),HT("OnDisconnect.update",e,this._path,!1);let t=new je;return VR(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var at=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ee(this._path)?null:Tg(this._path)}get ref(){return new mt(this._repo,this._path)}get _queryIdentifier(){let e=LE(this._queryParams),t=wg(e);return t==="{}"?"default":t}get _queryObject(){return LE(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=Ig(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+YC(this._path)}};function iu(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function lr(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Yt){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==rr)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==_n)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===ge){if(e!=null&&!na(e)||t!=null&&!na(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof $o||n.getIndex()===Cg,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function su(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var mt=class n extends at{constructor(e,t){super(e,t,new Jo,!1)}get parent(){let e=ET(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},os=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ce(e),r=ar(this.ref,e);return new n(this._node.getChild(t),r,ge)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,ar(this.ref,r),ge)))}hasChild(e){let t=new ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function zg(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?ar(n._root,e):n._root}function Wg(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=sg(e,n._repo.repoInfo_.nodeAdmin);YT("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Jt("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),zg(n,t.path.toString())}function ar(n,e){return n=ne(n),Z(n._path)===null?AR("child","path",e,!1):us("child","path",e,!1),new mt(n._repo,we(n._path,e))}function sI(n,e){n=ne(n),pt("push",n._path),Zt("push",e,n._path,!0);let t=eI(n._repo),r=GR(t),i=ar(n,r),s=ar(n,r),o;return e!=null?o=ou(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function oI(n){return pt("remove",n._path),ou(n,null)}function ou(n,e){n=ne(n),pt("set",n._path),Zt("set",e,n._path,!1);let t=new je;return jg(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function aI(n,e){n=ne(n),pt("setPriority",n._path),Bg("setPriority",e,!1);let t=new je;return jg(n._repo,we(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function lI(n,e,t){if(pt("setWithPriority",n._path),Zt("setWithPriority",e,n._path,!1),Bg("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new je;return jg(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function cI(n,e){HT("update",e,n._path,!1);let t=new je;return kR(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function uI(n){n=ne(n);let e=new ra(()=>{}),t=new ia(e);return PR(n._repo,n,t).then(r=>new os(r,new mt(n._repo,n._path),n._queryParams.getIndex()))}var ia=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new Lc("value",this,new os(e.snapshotNode,new mt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Uc(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},qc=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Uc(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let r=ar(new mt(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Lc(e.type,this,new os(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function fa(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let c=t,u=(d,p)=>{ig(n._repo,n,a),c(d,p)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new ra(t,s||void 0),a=e==="value"?new ia(o):new qc(e,o);return OR(n._repo,n,a),()=>ig(n._repo,n,a)}function au(n,e,t,r){return fa(n,"value",e,t,r)}function $g(n,e,t,r){return fa(n,"child_added",e,t,r)}function Qg(n,e,t,r){return fa(n,"child_changed",e,t,r)}function Hg(n,e,t,r){return fa(n,"child_moved",e,t,r)}function Yg(n,e,t,r){return fa(n,"child_removed",e,t,r)}function Jg(n,e,t){let r=null,i=t?new ra(t):null;e==="value"?r=new ia(i):e&&(r=new qc(e,i)),ig(n._repo,n,r)}var _t=class{},jc=class extends _t{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Zt("endAt",this._value,e._path,!0);let t=Op(e._queryParams,this._value,this._key);if(su(t),lr(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function hI(n,e){return ha("endAt","key",e,!0),new jc(n,e)}var og=class extends _t{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Zt("endBefore",this._value,e._path,!1);let t=gb(e._queryParams,this._value,this._key);if(su(t),lr(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function dI(n,e){return ha("endBefore","key",e,!0),new og(n,e)}var Gc=class extends _t{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Zt("startAt",this._value,e._path,!0);let t=Vp(e._queryParams,this._value,this._key);if(su(t),lr(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function fI(n=null,e){return ha("startAt","key",e,!0),new Gc(n,e)}var ag=class extends _t{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Zt("startAfter",this._value,e._path,!1);let t=pb(e._queryParams,this._value,this._key);if(su(t),lr(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function pI(n,e){return ha("startAfter","key",e,!0),new ag(n,e)}var lg=class extends _t{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new at(e._repo,e._path,db(e._queryParams,this._limit),e._orderByCalled)}};function gI(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new lg(n)}var cg=class extends _t{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new at(e._repo,e._path,fb(e._queryParams,this._limit),e._orderByCalled)}};function mI(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new cg(n)}var ug=class extends _t{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){iu(e,"orderByChild");let t=new ce(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new $o(t),i=zc(e._queryParams,r);return lr(i),new at(e._repo,e._path,i,!0)}};function _I(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return us("orderByChild","path",n,!1),new ug(n)}var hg=class extends _t{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){iu(e,"orderByKey");let t=zc(e._queryParams,Yt);return lr(t),new at(e._repo,e._path,t,!0)}};function yI(){return new hg}var dg=class extends _t{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){iu(e,"orderByPriority");let t=zc(e._queryParams,ge);return lr(t),new at(e._repo,e._path,t,!0)}};function vI(){return new dg}var fg=class extends _t{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){iu(e,"orderByValue");let t=zc(e._queryParams,Cg);return lr(t),new at(e._repo,e._path,t,!0)}};function wI(){return new fg}var pg=class extends _t{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Zt("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new jc(this._value,this._key)._apply(new Gc(this._value,this._key)._apply(e))}};function EI(n,e){return ha("equalTo","key",e,!0),new pg(n,e)}function Ct(n,...e){let t=ne(n);for(let r of e)t=r._apply(t);return t}Yb(mt);tR(mt);var KR="FIREBASE_DATABASE_EMULATOR_HOST",gg={},zR=!1;function WR(n,e,t,r){n.repoInfo_=new vc(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function Xg(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Jt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ge("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=sg(s,i),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[KR]),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=sg(s,i),a=o.repoInfo):c=!o.repoInfo.secure;let d=i&&c?new qo(qo.OWNER):new vp(n.name,n.options,e);YT("Invalid Firebase Database URL",o),ee(o.path)||Jt("Database URL must point to the root of a Firebase Database (not including a child path).");let p=QR(a,n,d,new yp(n.name,t));return new mg(p,n)}function $R(n,e){let t=gg[e];(!t||t[n.key]!==n)&&Jt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),tI(n),delete t[n.key]}function QR(n,e,t,r){let i=gg[e.name];i||(i={},gg[e.name]=i);let s=i[n.toURLString()];return s&&Jt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new rg(n,zR,t,r),i[n.toURLString()]=s,s}var mg=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(bR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new mt(this._repo,le())),this._rootInternal}_delete(){return this._rootInternal!==null&&($R(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Jt("Cannot call "+e+" on a deleted database.")}};function TI(){wT.IS_TRANSPORT_INITIALIZED&&Ze("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function II(){TI(),zo.forceDisallow()}function AI(){TI(),Yi.forceDisallow(),zo.forceAllow()}function SI(n,e,t,r={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Jt("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Jt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new qo(qo.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:Fa(r.mockUserToken,n.app.options.projectId);s=new qo(o)}WR(i,e,t,s)}function CI(n){n=ne(n),n._checkNotDeleted("goOffline"),tI(n._repo)}function bI(n){n=ne(n),n._checkNotDeleted("goOnline"),MR(n._repo)}function RI(n,e){nT(n,e)}function HR(n){vg(ja),gr(new ht("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Xg(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Rt(EE,TE,n),Rt(EE,TE,"esm2017")}var YR={".sv":"timestamp"};function PI(){return YR}function kI(n){return{".sv":{increment:n}}}var _g=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function NI(n,e,t){var r;if(n=ne(n),pt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new je,o=(c,u,d)=>{let p=null;c?s.reject(c):(p=new os(d,new mt(n._repo,n._path),ge),s.resolve(new _g(u,p)))},a=au(n,()=>{});return FR(n._repo,n._path,e,o,a,i),s.promise}Ag.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ag.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};HR();var JR="@firebase/database-compat",XR="1.0.8";var ZR=new kn("@firebase/database-compat"),xI=function(n){let e="FIREBASE WARNING: "+n;ZR.warn(e)};var eP=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(lt(n,e)+"must be a boolean.")},tP=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(lt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Zg=class{constructor(e){this._delegate=e}cancel(e){$("OnDisconnect.cancel",0,1,arguments.length),Fe("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){$("OnDisconnect.remove",0,1,arguments.length),Fe("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){$("OnDisconnect.set",1,2,arguments.length),Fe("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){$("OnDisconnect.setWithPriority",2,3,arguments.length),Fe("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if($("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,xI("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Fe("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var em=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return $("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Yr=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return $("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return $("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return $("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return $("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return $("DataSnapshot.child",0,1,arguments.length),e=String(e),us("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return $("DataSnapshot.hasChild",1,1,arguments.length),us("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return $("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return $("DataSnapshot.forEach",1,1,arguments.length),Fe("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return $("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return $("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return $("DataSnapshot.ref",0,0,arguments.length),new yn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},lu=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;$("Query.on",2,4,arguments.length),Fe("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(u,d)=>{t.call(o.context,new Yr(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return au(this._delegate,a,c),t;case"child_added":return $g(this._delegate,a,c),t;case"child_removed":return Yg(this._delegate,a,c),t;case"child_changed":return Qg(this._delegate,a,c),t;case"child_moved":return Hg(this._delegate,a,c),t;default:throw new Error(lt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if($("Query.off",0,3,arguments.length),tP("Query.off",e,!0),Fe("Query.off","callback",t,!0),qu("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,Jg(this._delegate,e,i)}else Jg(this._delegate,e)}get(){return uI(this._delegate).then(e=>new Yr(this.database,e))}once(e,t,r,i){$("Query.once",1,4,arguments.length),Fe("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new je,a=(u,d)=>{let p=new Yr(this.database,u);t&&t.call(s.context,p,d),o.resolve(p)};a.userCallback=t,a.context=s.context;let c=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":au(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":$g(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":Yg(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":Qg(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":Hg(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(lt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return $("Query.limitToFirst",1,1,arguments.length),new n(this.database,Ct(this._delegate,gI(e)))}limitToLast(e){return $("Query.limitToLast",1,1,arguments.length),new n(this.database,Ct(this._delegate,mI(e)))}orderByChild(e){return $("Query.orderByChild",1,1,arguments.length),new n(this.database,Ct(this._delegate,_I(e)))}orderByKey(){return $("Query.orderByKey",0,0,arguments.length),new n(this.database,Ct(this._delegate,yI()))}orderByPriority(){return $("Query.orderByPriority",0,0,arguments.length),new n(this.database,Ct(this._delegate,vI()))}orderByValue(){return $("Query.orderByValue",0,0,arguments.length),new n(this.database,Ct(this._delegate,wI()))}startAt(e=null,t){return $("Query.startAt",0,2,arguments.length),new n(this.database,Ct(this._delegate,fI(e,t)))}startAfter(e=null,t){return $("Query.startAfter",0,2,arguments.length),new n(this.database,Ct(this._delegate,pI(e,t)))}endAt(e=null,t){return $("Query.endAt",0,2,arguments.length),new n(this.database,Ct(this._delegate,hI(e,t)))}endBefore(e=null,t){return $("Query.endBefore",0,2,arguments.length),new n(this.database,Ct(this._delegate,dI(e,t)))}equalTo(e,t){return $("Query.equalTo",1,2,arguments.length),new n(this.database,Ct(this._delegate,EI(e,t)))}toString(){return $("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return $("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if($("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Fe(e,"cancel",i.cancel,!0),i.context=r,qu(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(lt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new yn(this.database,new mt(this._delegate._repo,this._delegate._path))}},yn=class n extends lu{constructor(e,t){super(e,new at(t._repo,t._path,new Jo,!1)),this.database=e,this._delegate=t}getKey(){return $("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return $("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,ar(this._delegate,e))}getParent(){$("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return $("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){$("Reference.set",1,2,arguments.length),Fe("Reference.set","onComplete",t,!0);let r=ou(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if($("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,xI("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}pt("Reference.update",this._delegate._path),Fe("Reference.update","onComplete",t,!0);let r=cI(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){$("Reference.setWithPriority",2,3,arguments.length),Fe("Reference.setWithPriority","onComplete",r,!0);let i=lI(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){$("Reference.remove",0,1,arguments.length),Fe("Reference.remove","onComplete",e,!0);let t=oI(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){$("Reference.transaction",1,3,arguments.length),Fe("Reference.transaction","transactionUpdate",e,!1),Fe("Reference.transaction","onComplete",t,!0),eP("Reference.transaction","applyLocally",r,!0);let i=NI(this._delegate,e,{applyLocally:r}).then(s=>new em(s.committed,new Yr(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){$("Reference.setPriority",1,2,arguments.length),Fe("Reference.setPriority","onComplete",t,!0);let r=aI(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){$("Reference.push",0,2,arguments.length),Fe("Reference.push","onComplete",t,!0);let r=sI(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return pt("Reference.onDisconnect",this._delegate._path),new Zg(new Bc(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Jr=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:II,forceLongPolling:AI}}useEmulator(e,t,r={}){SI(this._delegate,e,t,r)}ref(e){if($("database.ref",0,1,arguments.length),e instanceof yn){let t=Wg(this._delegate,e.toString());return new yn(this,t)}else{let t=zg(this._delegate,e);return new yn(this,t)}}refFromURL(e){$("database.refFromURL",1,1,arguments.length);let r=Wg(this._delegate,e);return new yn(this,r)}goOffline(){return $("database.goOffline",0,0,arguments.length),CI(this._delegate)}goOnline(){return $("database.goOnline",0,0,arguments.length),bI(this._delegate)}};Jr.ServerValue={TIMESTAMP:PI(),increment:n=>kI(n)};function nP({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){vg(t);let a=new ju("database-standalone"),c=new qa("auth-internal",a);c.setComponent(new ht("auth-internal",()=>r,"PRIVATE"));let u;return i&&(u=new qa("app-check-internal",a),u.setComponent(new ht("app-check-internal",()=>i,"PRIVATE"))),{instance:new Jr(Xg(n,c,u,e,o),n),namespace:s}}var rP=Object.freeze({__proto__:null,initStandalone:nP});var iP=Jr.ServerValue;function sP(n){n.INTERNAL.registerComponent(new ht("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Jr(i,r)},"PUBLIC").setServiceProps({Reference:yn,Query:lu,Database:Jr,DataSnapshot:Yr,enableLogging:RI,INTERNAL:rP,ServerValue:iP}).setMultipleInstances(!0)),n.registerVersion(JR,XR)}sP(Le);function pa(n,e,t="on",r=ri){return new In(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ae(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),s_())}function oP(n){return typeof n=="string"}function aP(n){return typeof n.exportVal=="function"}function FI(n){return n==null}function LI(n){return typeof n.set=="function"}function DI(n,e){return LI(e)?e:n.ref(e)}function UI(n,e){if(oP(n))return e.stringCase();if(LI(n))return e.firebaseCase();if(aP(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function BI(n){return(FI(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function qI(n,e,t){e=BI(e);let r=e.map(i=>pa(n,i,"on",t));return xs(...r)}function lP(n,e,t){let r=qI(n,e).pipe(pr((i,s)=>[...i,s],[]));return uP(n,r,t)}function cP(n,e){return pa(n,"value","on",e).pipe(Ae(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function uP(n,e,t){return cP(n,t).pipe(l_(e),Ae(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),o_(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Ae(i=>i.actions))}function VI(n,e){return function(r,i){return UI(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function hP(n){return function(t){return t?UI(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function dP(n,e,t){return pa(n,"value","once",t).pipe(rn(r=>{let i=[Mt(r)];return e.forEach(s=>i.push(pa(n,s,"on",t))),xs(...i).pipe(pr(pP,[]))}),xa())}function jI(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function fP(n,e){if(FI(e))return 0;{let t=jI(n,e);return t===-1?n.length:t+1}}function pP(n,e){let{payload:t,prevKey:r,key:i}=e,s=jI(n,i),o=fP(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function OI(n,e,t){return e=BI(e),dP(n,e,t)}function gP(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:VI(r,"update"),set:VI(r,"set"),push:i=>r.push(i),remove:hP(r),snapshotChanges(i){return OI(n,i,t).pipe(Ce)},stateChanges(i){return qI(n,i,t).pipe(Ce)},auditTrail(i){return lP(n,i,t).pipe(Ce)},valueChanges(i,s){return OI(n,i,t).pipe(Ae(a=>a.map(c=>s&&s.idField?Ns(ni({},c.payload.val()),{[s.idField]:c.key}):c.payload.val())),Ce)}}}function MI(n,e){return function(){return pa(n,"value","on",e)}}function mP(n,e){return{query:n,snapshotChanges(){return MI(n,e.schedulers.outsideAngular)().pipe(Ce)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return MI(n,e.schedulers.outsideAngular)().pipe(Ce,Ae(r=>r.payload.exists()?r.payload.val():null))}}}var _P=new qe("angularfire2.realtimeDatabaseURL"),yP=new qe("angularfire2.database.use-emulator"),vP=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,c,u,d,p,g,y,S,k,x){this.schedulers=a;let q=c,j=mr(t,o,r);u&&Ks(j,o,d,g,y,S,p,k),this.database=ai(`${j.name}.database.${i}`,"AngularFireDatabase",j.name,()=>{let M=o.runOutsideAngular(()=>j.database(i||void 0));return q&&M.useEmulator(...q),M},[q])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>DI(this.database,t)),s=i;return r&&(s=r(i)),gP(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>DI(this.database,t));return mP(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(W(Nn),W(xn,8),W(_P,8),W(Rn),W(Ft),W(oi),W(yP,8),W(zs,8),W(Ls,8),W(Us,8),W(Bs,8),W(qs,8),W(js,8),W(Gs,8),W(sn,8))};static \u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),DN=(()=>{class n{constructor(){Le.registerVersion("angularfire",on.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=bn({type:n});static \u0275inj=Cn({providers:[vP]})}return n})();var MN={production:!0,firebase:{apiKey:"***************************************",authDomain:"************************",projectId:"***********************************",storageBucket:"************************",messagingSenderId:"*********************",appId:"*******************************************",measurementId:"*********************"}};export{MP as a,zs as b,wk as c,iN as d,DN as e,MN as f};
